import{_ as Q,o as z,c as F,a as t,x as pe,r as m,h as p,p as re,w as G,n as A,k as ve,F as we,l as be,t as W,v as J,g as O,O as ye,E as xe,P as Se,I as Ce,J as ke,A as Ie,i as he,s as P,u as me,b as ge,j as Ue,K as $e,f as Le,e as h,y as E,d as V,C as Be,L as Te,M as Me}from"./index-BexsKry7.js";/* empty css                                                             */import{S as $}from"./Dialog-CSBHe7q0.js";const Ee={name:"MdiTarget"},Ge={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},Oe=t("path",{fill:"currentColor",d:"M11 2v2.07A8 8 0 0 0 4.07 11H2v2h2.07A8 8 0 0 0 11 19.93V22h2v-2.07A8 8 0 0 0 19.93 13H22v-2h-2.07A8 8 0 0 0 13 4.07V2m-2 4.08V8h2V6.09c2.5.41 4.5 2.41 4.92 4.91H16v2h1.91c-.41 2.5-2.41 4.5-4.91 4.92V16h-2v1.91C8.5 17.5 6.5 15.5 6.08 13H8v-2H6.09C6.5 8.5 8.5 6.5 11 6.08M12 11a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1"},null,-1),Re=[Oe];function He(i,x,d,u,r,c){return z(),F("svg",Ge,Re)}const Yt=Q(Ee,[["render",He]]),Ne={class:"menu_list"},De={class:"contents"},Ve=["onClick","title"],Pe={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(i,{emit:x}){const d=i,u=x,{getClientRect:r}=pe(),c=m(null),S=[{title:"セリフ",type:"dialog"},{title:"セリフ：主人公",type:"dialog_hero"},{title:"切り替え：UI",type:"scene_ui"},{title:"切り替え：背景",type:"scene_bg"},{title:"切り替え：BGM",type:"scene_bgm"},{title:"演出：CG",type:"perform_cg"},{title:"演出：CG終了",type:"perform_cg_end"},{title:"演出：暗転",type:"perform_black"},{title:"アナウンス",type:"dialog_announce",class:"!text-announce"},{title:"ナレーション",type:"dialog_system",class:"!text-announce"},{title:"コピー",type:"copy",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"編集",type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"削除",type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}],v=p(()=>{const{width:g,height:I}=r(document.documentElement),{width:f,height:w}=r(c.value),{x:T,y:b,width:L,height:M}=d.positions??{},y=(b??0)+(M??0)/2-(w??0)/2,U=(y<20?20:y)+"px",B=(I??0)-(w??0)-20+"px",j=`min(${U}, ${B})`,K=(T??0)+(f??0)>g,H=(T??0)+(L??0)+2,N=(T??0)-(f??0)-9-2,D=(K?N:H)+"px";return{top:j,left:D}}),C=p(()=>{const{width:g}=r(document.documentElement),{width:I}=r(c.value),{x:f,y:w,width:T,height:b}=d.positions??{},L=(w??0)+(b??0)/2,M=(f??0)+(I??0)>g,y=(f??0)+(T??0)+3,U=(f??0)-3.2,B=M?U:y;return{top:L+"px",left:B+"px",turn:M}}),k=g=>{g.target.matches(".menu, .menu *")||u("clear",null)},R=g=>{u("use",{type:g}),u("clear",null)};return(g,I)=>{const f=re("visible");return G((z(),F("div",{class:"menu_container",onClick:k},[t("div",{class:A(["menu_triangle",{"-scale-x-100":C.value.turn}]),style:ve(C.value)},null,6),t("div",{class:"menu scrollbar overflow-y-auto",style:ve(v.value),ref_key:"menu",ref:c},[t("ul",Ne,[(z(),F(we,null,be(S,w=>t("li",De,[G(t("button",{class:A(["menu_item",w.class]),onClick:T=>R(w.type),title:w.title},W(w.title),11,Ve),[[J,!(["copy","edit","delete"].includes(w.type)&&i.onlyAdd)]])])),64))])],4)])),[[f,i.positions]])}}},Zt=Q(Pe,[["__scopeId","data-v-e4cfe076"]]),Ae=["disabled","placeholder"],je={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(i,{emit:x}){const d=i,u=x,r=m(null),c=m(""),S=v=>{if(!v.ctrlKey)return;const{selectionStart:C,selectionEnd:k}=r.value;u("selected",{start:C,end:k})};return O(c,v=>u("update:value",v)),O(()=>d.value,v=>c.value=v,{immediate:!0}),(v,C)=>{const k=re("verify");return G((z(),F("textarea",{class:"scrollbar textarea","onUpdate:modelValue":C[0]||(C[0]=R=>c.value=R),disabled:i.disabled,placeholder:i.disabled?"":i.placeholder,onKeydown:xe(S,["q"]),ref_key:"textarea",ref:r},null,40,Ae)),[[ye,c.value,void 0,{lazy:!0,trim:!0}],[k,void 0,void 0,{check:!0}]])}}},_e=Q(je,[["__scopeId","data-v-c1e57f9a"]]),Ke=["disabled"],ze={class:"whitespace-nowrap"},Fe={__name:"Checkbox",props:{value:{type:[Number],default:0},disabled:{type:[Boolean],default:!1},title:{type:[String],default:""},box:{type:[String],default:""}},emits:["update:value"],setup(i,{emit:x}){const d=i,u=x,r=m(0);return O(r,c=>u("update:value",c)),O(()=>d.value,c=>r.value=c,{immediate:!0}),(c,S)=>(z(),F("label",{class:A(["inline-flex items-center",i.disabled?"cursor-auto":"cursor-pointer"])},[G(t("input",{class:A(["checkbox",i.box]),"onUpdate:modelValue":S[0]||(S[0]=v=>r.value=v),disabled:i.disabled,"true-value":1,"false-value":0,type:"checkbox"},null,10,Ke),[[Se,r.value]]),t("span",ze,W(i.title),1),Ce(c.$slots,"default",{},void 0,!0)],2))}},qe=Q(Fe,[["__scopeId","data-v-b7a95cdd"]]),Je=ke("log",()=>{const i=Ie(),x=he(),{convertChapter:d}=x,{chapterData:u}=P(x),r=me(),{characterHero:c,characterUnknown:S}=P(r),v=ge(),{getUI:C,getHistoryList:k}=v,{defaultUI:R,defaultUIForCG:g}=P(v),{findData:I,findIndex:f,getRandomInt:w}=pe(),{newId:T}=Ue(),b=m(0),L=m(0),M=p(()=>I(u.value,b.value)??{}),y=p(()=>u.value.filter(o=>!o.is_delete)),U=p(()=>y.value.filter(o=>{const n=!o.is_showtime,e=o.is_perform&&o.show_time==="暗場";return o.is_perform&&o.show_time,n||e})),B=p(()=>{const o=f(y.value,b.value)+1,n=y.value.slice(0,o),e=y.value.slice(o);return e.every(a=>a.is_showtime&&a.show_time!=="暗場")&&n.push(...e),n});O(b,o=>{const n=I(u.value,o)??{};n.is_scene||(L.value=f(U.value,n.id))}),O(L,o=>{var n;return b.value=((n=U.value[o])==null?void 0:n.id)??0}),O(u,()=>{var o;return b.value=((o=U.value[0])==null?void 0:o.id)??0}),$e(()=>{var o;return b.value=((o=U.value[0])==null?void 0:o.id)??0});const j=p(()=>{const o=k(B.value,"CG");return((o==null?void 0:o.show_name)??"")!==""&&(o==null?void 0:o.show_name)!=="結束"}),K=p(()=>{const o=k(B.value,"UI"),n=(o==null?void 0:o.show_name)??R.value??"",e=g.value;return j.value&&e!==""?e:n}),H=p(()=>C(K.value)),N=p(()=>{const o=H.value,n=M.value,e=c.value.name,_=n.人物,a=o.name_tag_number===2,te=n.is_monolog&&o.name_tag_solo_show,se=_===e&&o.name_tag_hero_right,oe=_===n.顯示角色&&o.name_tag_sprite_1_right,fe=_===n.立ち絵2&&o.name_tag_sprite_2_right&&o.sprite_number===2;return a&&(te||se||oe||fe)}),D=p(()=>{const o=M.value,n=o.is_system||o.is_announce||o.is_monolog,e=o.is_monolog&&H.value.name_tag_solo_show;return!n||e}),X=p(()=>!N.value&&D.value),Y=p(()=>N.value&&D.value),s=m(!1),ne=m(!1),Z=m(!1),ae=m(!1),le=m(!1),ie=m(!1),ce=p(()=>({"":s.value})),q=()=>{s.value=!1,Z.value=!1};O(()=>i.name,()=>s.value=!1);const ee=()=>T(u.value);return{logId:b,logIndex:L,logData:M,logShowing:y,logContents:U,logHistory:B,logCGMode:j,logUIId:K,logUI:H,isNameRight:N,isNameShow:D,nameTag1Show:X,nameTag2Show:Y,logPlay:s,logPause:ne,logTyping:Z,logBlack:ae,logVoicing:le,logAnimating:ie,playEase:ce,newLogId:ee,newLog:(o,n=!1)=>{var te,se,oe;let e={name:"",content:""};o==="scene_ui"&&(e={name:"場景(切換)",content:"UI"}),o==="scene_bg"&&(e={name:"場景(切換)",content:"BG"}),o==="scene_bgm"&&(e={name:"場景(切換)",content:"BGM"}),o==="perform_cg"&&(e={name:"演出",content:"CG"}),o==="perform_cg_end"&&(e={name:"演出",content:"CG/結束"}),o==="perform_anime"&&(e={name:"演出",content:"動畫"}),o==="perform_black"&&(e={name:"演出",content:"暗場"}),o==="dialog"&&(e={name:((te=S.value)==null?void 0:te.name)??"",content:""}),o==="dialog_hero"&&(e={name:((se=c.value)==null?void 0:se.name)??"",content:""}),o==="dialog_announce"&&(e={name:"廣播",content:""}),o==="dialog_system"&&(e={name:"系統",content:""});const _={id:ee(),人物:e.name??"",顯示角色:"",角色差分:"",差分特效:"",立ち絵2:n?((oe=c.value)==null?void 0:oe.name)??"":"",十六夜差分:"",和訳:e.content??"",SE:"",ボイス:"",備註:""},a=d(_);return{..._,...a}},stopPlaying:q,changeLog:o=>{const n=L.value+o;n<0||n>U.value.length-1||(L.value=n,q())}}}),l=i=>(Te("data-v-606da7d2"),i=i(),Me(),i),We={class:"popup_window"},Qe={class:"contents"},Xe={class:"contents"},Ye={class:"popup_label"},Ze=l(()=>t("div",{class:"-col-2"},null,-1)),et={class:"contents"},tt=l(()=>t("span",{class:"popup_label"},"内容",-1)),st={value:""},ot={class:"contents"},nt={class:"contents"},at=l(()=>t("span",{class:"popup_label"},"話し手",-1)),lt={class:"popup_input"},it={class:"contents"},ct=l(()=>t("span",{class:"popup_label"},"話し手",-1)),ut={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},pt={class:"popup_group"},rt=l(()=>t("span",{class:"popup_group_title"},"・立ち絵1",-1)),dt={class:"contents"},vt=l(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),_t=l(()=>t("option",{value:""},"無指定",-1)),ht={class:"contents"},mt=l(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),gt=l(()=>t("option",{value:""},"引き継ぎ",-1)),ft={class:"contents"},wt=l(()=>t("span",{class:"popup_label"},"エフェクト",-1)),bt=l(()=>t("option",{value:""},"なし",-1)),yt={class:"popup_group"},xt={class:"popup_group_title"},St=l(()=>t("span",null,"・立ち絵2",-1)),Ct={class:"popup_group_checkbox"},kt=l(()=>t("span",null,"デフォルトで主人公",-1)),It={class:"contents"},Ut=l(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),$t=l(()=>t("option",{value:""},"無指定",-1)),Lt={class:"contents"},Bt=l(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),Tt=l(()=>t("option",{value:""},"引き継ぎ",-1)),Mt={class:"contents"},Et=l(()=>t("span",{class:"popup_label"},"エフェクト",-1)),Gt=l(()=>t("option",{value:""},"なし",-1)),Ot={class:"contents"},Rt=l(()=>t("span",{class:"popup_label"},"SE",-1)),Ht=l(()=>t("option",{value:""},"なし",-1)),Nt={class:"contents"},Dt=l(()=>t("span",{class:"popup_label"},"ボイス",-1)),Vt=l(()=>t("option",{value:""},"なし",-1)),Pt={class:"contents"},At=l(()=>t("span",{class:"popup_label"},"セリフ",-1)),jt={class:"-col-3 grid gap-1"},Kt=l(()=>t("span",{class:"text-right text-xs opacity-50"},"セリフにキーワードを指定したい場合は、文字を[ ]で囲んでください。",-1)),zt={class:"contents"},Ft=l(()=>t("span",{class:"popup_label"},"備考",-1)),qt=l(()=>t("button",{class:"popup_submit -cancel",title:"キャンセル"},"キャンセル",-1)),Jt={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(i,{emit:x}){const d=i,u=x,r=Le(),{defaultHero:c}=P(r),S=me(),{getCharacter:v}=S,{characterList:C,characterReals:k}=P(S),R=he(),{chapterData:g}=P(R),I=ge(),{blackList:f,getEffect:w,getBackground:T,getCg:b,getBgm:L,getSe:M,getShowList:y}=I,{uiList:U,effectList:B,seList:j,voiceList:K}=P(I),H=Je(),{newLog:N}=H,{isDev:D,findData:X}=pe(),Y=m(null),s=m({}),ne=p(()=>{var n;return(n=v(s.value.人物))==null?void 0:n.name}),Z=p(()=>[{id:"UI",show:s.value.is_scene},{id:"BG",show:s.value.is_scene},{id:"BGM",show:s.value.is_scene},{id:"CG",show:s.value.is_perform},{id:"暗場",show:s.value.is_perform}]),ae=p(()=>y(s.value.show_time)),le=p(()=>C.value.filter(n=>!n.disabled||n.unknown)),ie=p(()=>q(s.value.顯示角色)),ce=p(()=>q(s.value.立ち絵2)),q=n=>{var e;return((e=v(n))==null?void 0:e.sprite)??[]},ee=()=>{s.value.show_time==="CG"&&s.value.show_name==="結束"||(s.value.show_name="")},ue=n=>s.value[n]="",de=()=>{const n={...s.value};if(d.id==="add")u("add",n);else{const _=X(g.value,d.id);Object.assign(_,n)}u("update:open",!1),(!n.is_showtime||n.show_time==="暗場")&&u("target",n.id)},o=n=>{const e=n.target.matches(".popup_window, .popup_window *"),_=n.target.matches(".-cancel");(!e||_)&&u("update:open",!1)};return O(()=>d.open,n=>{n&&(d.id==="add"?s.value=N(d.type,c.value):s.value={...X(g.value,d.id)},D&&console.log({...s.value}),Y.value.scrollTo({top:0,left:0}))}),(n,e)=>{const _=re("visible");return G((z(),F("section",{class:"popup",onClick:o},[t("div",We,[t("div",{class:"popup_container scrollbar",ref_key:"container",ref:Y},[G(t("div",Qe,[t("div",Xe,[t("span",Ye,W(s.value.人物),1),h($,{class:"popup_select",value:s.value.show_time,"onUpdate:value":e[0]||(e[0]=a=>s.value.show_time=a),options:Z.value,onChange:ee},null,8,["value","options"])]),Ze,t("div",et,[tt,h($,{class:"popup_select -col-3",value:s.value.show_name,"onUpdate:value":e[1]||(e[1]=a=>s.value.show_name=a),options:ae.value},{default:E(()=>[t("option",st,W(s.value.show_time==="暗場"?"フェード":"なし"),1)]),_:1},8,["value","options"])])],512),[[J,s.value.is_showtime]]),G(t("div",ot,[G(t("div",nt,[at,t("span",lt,W(ne.value),1)],512),[[J,s.value.is_announce||s.value.is_system]]),G(t("div",it,[ct,h($,{class:"popup_select",value:s.value.人物,"onUpdate:value":e[2]||(e[2]=a=>s.value.人物=a),options:le.value},null,8,["value","options"])],512),[[J,!(s.value.is_announce||s.value.is_system)]]),t("div",ut,[t("button",{class:A(["popup_switch text-replay",{"-active bg-replay":s.value.is_replay}]),onClick:e[3]||(e[3]=a=>s.value.is_replay=!s.value.is_replay),title:"再放送"},"再放送",2),t("button",{class:A(["popup_switch text-unknown",{"-active bg-unknown":s.value.is_unknown}]),onClick:e[4]||(e[4]=a=>s.value.is_unknown=!s.value.is_unknown),title:"未解明"},"未解明",2),t("button",{class:A(["popup_switch -monolog",{"-active":s.value.is_monolog}]),onClick:e[5]||(e[5]=a=>s.value.is_monolog=!s.value.is_monolog),title:"独り言"},"独り言",2)]),t("div",pt,[rt,t("div",dt,[vt,h($,{class:"popup_select",value:s.value.顯示角色,"onUpdate:value":e[6]||(e[6]=a=>s.value.顯示角色=a),options:V(k),onChange:e[7]||(e[7]=a=>ue("角色差分"))},{default:E(()=>[_t]),_:1},8,["value","options"])]),t("div",ht,[mt,h($,{class:"popup_select",value:s.value.角色差分,"onUpdate:value":e[8]||(e[8]=a=>s.value.角色差分=a),options:ie.value},{default:E(()=>[gt]),_:1},8,["value","options"])]),t("div",ft,[wt,h($,{class:"popup_select",value:s.value.差分特效,"onUpdate:value":e[9]||(e[9]=a=>s.value.差分特效=a),options:V(B)},{default:E(()=>[bt]),_:1},8,["value","options"])])]),t("div",yt,[t("div",xt,[St,t("label",Ct,[h(qe,{value:V(c),"onUpdate:value":e[10]||(e[10]=a=>Be(c)?c.value=a:null)},null,8,["value"]),kt])]),t("div",It,[Ut,h($,{class:"popup_select",value:s.value.立ち絵2,"onUpdate:value":e[11]||(e[11]=a=>s.value.立ち絵2=a),options:V(k),onChange:e[12]||(e[12]=a=>ue("十六夜差分"))},{default:E(()=>[$t]),_:1},8,["value","options"])]),t("div",Lt,[Bt,h($,{class:"popup_select",value:s.value.十六夜差分,"onUpdate:value":e[13]||(e[13]=a=>s.value.十六夜差分=a),options:ce.value},{default:E(()=>[Tt]),_:1},8,["value","options"])]),t("div",Mt,[Et,h($,{class:"popup_select",value:s.value.主角特效,"onUpdate:value":e[14]||(e[14]=a=>s.value.主角特效=a),options:V(B)},{default:E(()=>[Gt]),_:1},8,["value","options"])])]),t("div",Ot,[Rt,h($,{class:"popup_select",value:s.value.SE,"onUpdate:value":e[15]||(e[15]=a=>s.value.SE=a),options:V(j)},{default:E(()=>[Ht]),_:1},8,["value","options"])]),t("div",Nt,[Dt,h($,{class:"popup_select",value:s.value.ボイス,"onUpdate:value":e[16]||(e[16]=a=>s.value.ボイス=a),options:V(K)},{default:E(()=>[Vt]),_:1},8,["value","options"])]),t("div",Pt,[At,t("div",jt,[h(_e,{class:"popup_input -textarea",value:s.value.和訳,"onUpdate:value":e[17]||(e[17]=a=>s.value.和訳=a)},null,8,["value"]),Kt])])],512),[[J,!s.value.is_showtime]]),t("div",zt,[Ft,h(_e,{class:"popup_input -textarea -col-3",value:s.value.備註,"onUpdate:value":e[18]||(e[18]=a=>s.value.備註=a)},null,8,["value"])])],512),t("footer",{class:"popup_footer"},[t("button",{class:"popup_submit",onClick:de,title:"保存"},"保存"),qt])])])),[[_,i.open]])}}},es=Q(Jt,[["__scopeId","data-v-606da7d2"]]);export{qe as C,es as E,Yt as I,Zt as M,Je as u};
