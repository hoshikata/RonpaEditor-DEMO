import{_ as X,o as F,c as q,a as e,x as ue,r as g,h as r,p as pe,w as G,n as j,k as re,F as ge,l as fe,t as Q,v as W,g as O,O as we,E as be,P as ye,I as xe,J as Se,A as Ce,i as ve,s as P,u as _e,b as he,j as ke,K as Ie,f as Ue,e as h,y as E,d as A,C as $e,L as Le,M as Be}from"./index-BdrE33-M.js";/* empty css                                                             */import{S as $}from"./Dialog-B_vyKawb.js";const Te={name:"MdiTarget"},Me={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},Ee=e("path",{fill:"currentColor",d:"M11 2v2.07A8 8 0 0 0 4.07 11H2v2h2.07A8 8 0 0 0 11 19.93V22h2v-2.07A8 8 0 0 0 19.93 13H22v-2h-2.07A8 8 0 0 0 13 4.07V2m-2 4.08V8h2V6.09c2.5.41 4.5 2.41 4.92 4.91H16v2h1.91c-.41 2.5-2.41 4.5-4.91 4.92V16h-2v1.91C8.5 17.5 6.5 15.5 6.08 13H8v-2H6.09C6.5 8.5 8.5 6.5 11 6.08M12 11a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1"},null,-1),Ge=[Ee];function Oe(i,S,v,p,d,c){return F(),q("svg",Me,Ge)}const Xt=X(Te,[["render",Oe]]),Re={class:"menu_list"},Ve={class:"contents"},He=["onClick","title"],Ne={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(i,{emit:S}){const v=i,p=S,{getClientRect:d}=ue(),c=g(null),C=[{title:"セリフ",type:"dialog"},{title:"セリフ：主人公",type:"dialog_hero"},{title:"切り替え：UI",type:"scene_ui"},{title:"切り替え：背景",type:"scene_bg"},{title:"切り替え：BGM",type:"scene_bgm"},{title:"演出：CG",type:"perform_cg"},{title:"演出：CG終了",type:"perform_cg_end"},{title:"演出：暗転",type:"perform_black"},{title:"アナウンス",type:"dialog_announce",class:"!text-announce"},{title:"ナレーション",type:"dialog_system",class:"!text-announce"},{title:"コピー",type:"copy",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"編集",type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"削除",type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}],_=r(()=>{const{width:m,height:U}=d(document.documentElement),{width:f,height:w}=d(c.value),{x:T,y:b,width:R,height:M}=v.positions??{},y=(b??0)+(M??0)/2-(w??0)/2,L=(y<20?20:y)+"px",B=(U??0)-(w??0)-20+"px",K=`min(${L}, ${B})`,z=(T??0)+(f??0)>m,H=(T??0)+(R??0)+2,N=(T??0)-(f??0)-9-2,D=(z?N:H)+"px";return{top:K,left:D}}),k=r(()=>{const{width:m}=d(document.documentElement),{width:U}=d(c.value),{x:f,y:w,width:T,height:b}=v.positions??{},R=(w??0)+(b??0)/2,M=(f??0)+(U??0)>m,y=(f??0)+(T??0)+3,L=(f??0)-3.2,B=M?L:y;return{top:R+"px",left:B+"px",turn:M}}),I=m=>{m.target.matches(".menu, .menu *")||p("clear",null)},V=m=>{p("use",{type:m}),p("clear",null)};return(m,U)=>{const f=pe("visible");return G((F(),q("div",{class:"menu_container",onClick:I},[e("div",{class:j(["menu_triangle",{"-scale-x-100":k.value.turn}]),style:re(k.value)},null,6),e("div",{class:"menu scrollbar overflow-y-auto",style:re(_.value),ref_key:"menu",ref:c},[e("ul",Re,[(F(),q(ge,null,fe(C,w=>e("li",Ve,[G(e("button",{class:j(["menu_item",w.class]),onClick:T=>V(w.type),title:w.title},Q(w.title),11,He),[[W,!(["copy","edit","delete"].includes(w.type)&&i.onlyAdd)]])])),64))])],4)])),[[f,i.positions]])}}},Yt=X(Ne,[["__scopeId","data-v-e4cfe076"]]),De=["disabled","placeholder"],Ae={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(i,{emit:S}){const v=i,p=S,d=g(null),c=g(""),C=_=>{if(!_.ctrlKey)return;const{selectionStart:k,selectionEnd:I}=d.value;p("selected",{start:k,end:I})};return O(c,_=>p("update:value",_)),O(()=>v.value,_=>c.value=_,{immediate:!0}),(_,k)=>{const I=pe("verify");return G((F(),q("textarea",{class:"scrollbar textarea","onUpdate:modelValue":k[0]||(k[0]=V=>c.value=V),disabled:i.disabled,placeholder:i.disabled?"":i.placeholder,onKeydown:be(C,["q"]),ref_key:"textarea",ref:d},null,40,De)),[[we,c.value,void 0,{lazy:!0,trim:!0}],[I,void 0,void 0,{check:!0}]])}}},de=X(Ae,[["__scopeId","data-v-c1e57f9a"]]),Pe=["disabled"],je={class:"whitespace-nowrap"},Ke={__name:"Checkbox",props:{value:{type:[Number],default:0},disabled:{type:[Boolean],default:!1},title:{type:[String],default:""},box:{type:[String],default:""}},emits:["update:value"],setup(i,{emit:S}){const v=i,p=S,d=g(0);return O(d,c=>p("update:value",c)),O(()=>v.value,c=>d.value=c,{immediate:!0}),(c,C)=>(F(),q("label",{class:j(["inline-flex items-center",i.disabled?"cursor-auto":"cursor-pointer"])},[G(e("input",{class:j(["checkbox",i.box]),"onUpdate:modelValue":C[0]||(C[0]=_=>d.value=_),disabled:i.disabled,"true-value":1,"false-value":0,type:"checkbox"},null,10,Pe),[[ye,d.value]]),e("span",je,Q(i.title),1),xe(c.$slots,"default",{},void 0,!0)],2))}},ze=X(Ke,[["__scopeId","data-v-b7a95cdd"]]),Fe=Se("log",()=>{const i=Ce(),S=ve(),{convertChapter:v}=S,{chapterData:p}=P(S),d=_e(),{characterHero:c,characterUnknown:C}=P(d),_=he(),{getUI:k,getHistoryList:I}=_,{defaultUI:V,defaultUIForCG:m}=P(_),{findData:U,findIndex:f,getRandomInt:w}=ue(),{newId:T}=ke(),b=g(0),R=g(0),M=r(()=>U(p.value,b.value)??{}),y=r(()=>p.value.filter(s=>!s.is_delete)),L=r(()=>y.value.filter(s=>{const u=!s.is_showtime,n=s.is_perform&&s.show_time==="暗場";return s.is_perform&&s.show_time,u||n})),B=r(()=>{const s=f(y.value,b.value)+1,u=y.value.slice(0,s),n=y.value.slice(s);return n.every(x=>x.is_showtime&&x.show_time!=="暗場")&&u.push(...n),u});O(b,s=>{const u=U(p.value,s)??{};u.is_scene||(R.value=f(L.value,u.id))}),O(R,s=>{var u;return b.value=((u=L.value[s])==null?void 0:u.id)??0}),O(p,()=>{var s;return b.value=((s=L.value[0])==null?void 0:s.id)??0}),Ie(()=>{var s;return b.value=((s=L.value[0])==null?void 0:s.id)??0});const K=r(()=>{const s=I(B.value,"CG");return((s==null?void 0:s.show_name)??"")!==""&&(s==null?void 0:s.show_name)!=="結束"}),z=r(()=>{const s=I(B.value,"UI"),u=(s==null?void 0:s.show_name)??V.value??"",n=m.value;return K.value&&n!==""?n:u}),H=r(()=>k(z.value)),N=r(()=>{const s=H.value,u=M.value,n=c.value.name,o=u.人物,x=s.name_tag_number===2,a=u.is_monolog&&s.name_tag_solo_show,te=o===n&&s.name_tag_hero_right,se=o===u.顯示角色&&s.name_tag_sprite_1_right,me=o===u.立ち絵2&&s.name_tag_sprite_2_right&&s.sprite_number===2;return x&&(a||te||se||me)}),D=r(()=>{const s=M.value,u=s.is_system||s.is_announce||s.is_monolog,n=s.is_monolog&&H.value.name_tag_solo_show;return!u||n}),Y=r(()=>!N.value&&D.value),t=r(()=>N.value&&D.value),J=g(!1),oe=g(!1),ne=g(!1),ae=g(!1),le=g(!1),ie=g(!1),Z=r(()=>({"":J.value}));O(()=>i.name,()=>J.value=!1);const ee=()=>T(p.value);return{logId:b,logIndex:R,logData:M,logShowing:y,logContents:L,logHistory:B,logCGMode:K,logUIId:z,logUI:H,isNameRight:N,isNameShow:D,nameTag1Show:Y,nameTag2Show:t,logPlay:J,logPause:oe,logTyping:ne,logBlack:ae,logVoicing:le,logAnimating:ie,playEase:Z,newLogId:ee,newLog:(s,u=!1)=>{var a,te,se;let n={name:"",content:""};s==="scene_ui"&&(n={name:"場景(切換)",content:"UI"}),s==="scene_bg"&&(n={name:"場景(切換)",content:"BG"}),s==="scene_bgm"&&(n={name:"場景(切換)",content:"BGM"}),s==="perform_cg"&&(n={name:"演出",content:"CG"}),s==="perform_cg_end"&&(n={name:"演出",content:"CG/結束"}),s==="perform_anime"&&(n={name:"演出",content:"動畫"}),s==="perform_black"&&(n={name:"演出",content:"暗場"}),s==="dialog"&&(n={name:((a=C.value)==null?void 0:a.name)??"",content:""}),s==="dialog_hero"&&(n={name:((te=c.value)==null?void 0:te.name)??"",content:""}),s==="dialog_announce"&&(n={name:"廣播",content:""}),s==="dialog_system"&&(n={name:"系統",content:""});const o={id:ee(),人物:n.name??"",顯示角色:"",角色差分:"",差分特效:"",立ち絵2:u?((se=c.value)==null?void 0:se.name)??"":"",十六夜差分:"",和訳:n.content??"",SE:"",Voice:"",備註:""},x=v(o);return{...o,...x}}}}),l=i=>(Le("data-v-9762a114"),i=i(),Be(),i),qe={class:"popup_window"},Je={class:"popup_container scrollbar"},We={class:"contents"},Qe={class:"contents"},Xe={class:"popup_label"},Ye=l(()=>e("div",{class:"-col-2"},null,-1)),Ze={class:"contents"},et=l(()=>e("span",{class:"popup_label"},"内容",-1)),tt={value:""},st={class:"contents"},ot={class:"contents"},nt=l(()=>e("span",{class:"popup_label"},"話し手",-1)),at={class:"popup_input"},lt={class:"contents"},it=l(()=>e("span",{class:"popup_label"},"話し手",-1)),ct={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},ut={class:"popup_group"},pt=l(()=>e("span",{class:"popup_group_title"},"・立ち絵1",-1)),rt={class:"contents"},dt=l(()=>e("span",{class:"popup_label"},"キャラ指定",-1)),vt=l(()=>e("option",{value:""},"無指定",-1)),_t={class:"contents"},ht=l(()=>e("span",{class:"popup_label"},"キャラ差分",-1)),mt=l(()=>e("option",{value:""},"引き継ぎ",-1)),gt={class:"contents"},ft=l(()=>e("span",{class:"popup_label"},"エフェクト",-1)),wt=l(()=>e("option",{value:""},"なし",-1)),bt={class:"popup_group"},yt={class:"popup_group_title"},xt=l(()=>e("span",null,"・立ち絵2",-1)),St={class:"popup_group_checkbox"},Ct=l(()=>e("span",null,"デフォルトで主人公",-1)),kt={class:"contents"},It=l(()=>e("span",{class:"popup_label"},"キャラ指定",-1)),Ut=l(()=>e("option",{value:""},"無指定",-1)),$t={class:"contents"},Lt=l(()=>e("span",{class:"popup_label"},"キャラ差分",-1)),Bt=l(()=>e("option",{value:""},"引き継ぎ",-1)),Tt={class:"contents"},Mt=l(()=>e("span",{class:"popup_label"},"エフェクト",-1)),Et=l(()=>e("option",{value:""},"なし",-1)),Gt={class:"contents"},Ot=l(()=>e("span",{class:"popup_label"},"SE",-1)),Rt=l(()=>e("option",{value:""},"なし",-1)),Vt={class:"contents"},Ht=l(()=>e("span",{class:"popup_label"},"ボイス",-1)),Nt=l(()=>e("option",{value:""},"なし",-1)),Dt={class:"contents"},At=l(()=>e("span",{class:"popup_label"},"セリフ",-1)),Pt={class:"-col-3 grid gap-1"},jt=l(()=>e("span",{class:"text-right text-xs opacity-50"},"セリフにキーワードを指定したい場合は、文字を[ ]で囲んでください。",-1)),Kt={class:"contents"},zt=l(()=>e("span",{class:"popup_label"},"備考",-1)),Ft=l(()=>e("button",{class:"popup_submit -cancel",title:"キャンセル"},"キャンセル",-1)),qt={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(i,{emit:S}){const v=i,p=S,d=Ue(),{defaultHero:c}=P(d),C=_e(),{getCharacter:_}=C,{characterList:k,characterReals:I}=P(C),V=ve(),{chapterData:m}=P(V),U=he(),{blackList:f,getEffect:w,getBackground:T,getCg:b,getBgm:R,getSe:M,getShowList:y}=U,{uiList:L,effectList:B,seList:K,voiceList:z}=P(U),H=Fe(),{newLog:N}=H,{isDev:D,findData:Y}=ue(),t=g({}),J=r(()=>{var n;return(n=_(t.value.人物))==null?void 0:n.name}),oe=r(()=>[{id:"UI",show:t.value.is_scene},{id:"BG",show:t.value.is_scene},{id:"BGM",show:t.value.is_scene},{id:"CG",show:t.value.is_perform},{id:"暗場",show:t.value.is_perform}]),ne=r(()=>y(t.value.show_time)),ae=r(()=>k.value.filter(n=>!n.disabled||n.unknown)),le=r(()=>Z(t.value.顯示角色)),ie=r(()=>Z(t.value.立ち絵2)),Z=n=>{var o;return((o=_(n))==null?void 0:o.sprite)??[]},ee=()=>{t.value.show_time==="CG"&&t.value.show_name==="結束"||(t.value.show_name="")},ce=n=>t.value[n]="",s=()=>{const n={...t.value};if(v.id==="add")p("add",n);else{const x=Y(m.value,v.id);Object.assign(x,n)}p("update:open",!1),(!n.is_showtime||n.show_time==="暗場")&&p("target",n.id)},u=n=>{const o=n.target.matches(".popup_window, .popup_window *"),x=n.target.matches(".-cancel");(!o||x)&&p("update:open",!1)};return O(()=>v.open,n=>{n&&(v.id==="add"?t.value=N(v.type,c.value):t.value={...Y(m.value,v.id)},D&&console.log({...t.value}))}),(n,o)=>{const x=pe("visible");return G((F(),q("section",{class:"popup",onClick:u},[e("div",qe,[e("div",Je,[G(e("div",We,[e("div",Qe,[e("span",Xe,Q(t.value.人物),1),h($,{class:"popup_select",value:t.value.show_time,"onUpdate:value":o[0]||(o[0]=a=>t.value.show_time=a),options:oe.value,onChange:ee},null,8,["value","options"])]),Ye,e("div",Ze,[et,h($,{class:"popup_select -col-3",value:t.value.show_name,"onUpdate:value":o[1]||(o[1]=a=>t.value.show_name=a),options:ne.value},{default:E(()=>[e("option",tt,Q(t.value.show_time==="暗場"?"フェード":"なし"),1)]),_:1},8,["value","options"])])],512),[[W,t.value.is_showtime]]),G(e("div",st,[G(e("div",ot,[nt,e("span",at,Q(J.value),1)],512),[[W,t.value.is_announce||t.value.is_system]]),G(e("div",lt,[it,h($,{class:"popup_select",value:t.value.人物,"onUpdate:value":o[2]||(o[2]=a=>t.value.人物=a),options:ae.value},null,8,["value","options"])],512),[[W,!(t.value.is_announce||t.value.is_system)]]),e("div",ct,[e("button",{class:j(["popup_switch text-replay",{"-active bg-replay":t.value.is_replay}]),onClick:o[3]||(o[3]=a=>t.value.is_replay=!t.value.is_replay),title:"再放送"},"再放送",2),e("button",{class:j(["popup_switch text-unknown",{"-active bg-unknown":t.value.is_unknown}]),onClick:o[4]||(o[4]=a=>t.value.is_unknown=!t.value.is_unknown),title:"未解明"},"未解明",2),e("button",{class:j(["popup_switch -monolog",{"-active":t.value.is_monolog}]),onClick:o[5]||(o[5]=a=>t.value.is_monolog=!t.value.is_monolog),title:"独り言"},"独り言",2)]),e("div",ut,[pt,e("div",rt,[dt,h($,{class:"popup_select",value:t.value.顯示角色,"onUpdate:value":o[6]||(o[6]=a=>t.value.顯示角色=a),options:A(I),onChange:o[7]||(o[7]=a=>ce("角色差分"))},{default:E(()=>[vt]),_:1},8,["value","options"])]),e("div",_t,[ht,h($,{class:"popup_select",value:t.value.角色差分,"onUpdate:value":o[8]||(o[8]=a=>t.value.角色差分=a),options:le.value},{default:E(()=>[mt]),_:1},8,["value","options"])]),e("div",gt,[ft,h($,{class:"popup_select",value:t.value.差分特效,"onUpdate:value":o[9]||(o[9]=a=>t.value.差分特效=a),options:A(B)},{default:E(()=>[wt]),_:1},8,["value","options"])])]),e("div",bt,[e("div",yt,[xt,e("label",St,[h(ze,{value:A(c),"onUpdate:value":o[10]||(o[10]=a=>$e(c)?c.value=a:null)},null,8,["value"]),Ct])]),e("div",kt,[It,h($,{class:"popup_select",value:t.value.立ち絵2,"onUpdate:value":o[11]||(o[11]=a=>t.value.立ち絵2=a),options:A(I),onChange:o[12]||(o[12]=a=>ce("十六夜差分"))},{default:E(()=>[Ut]),_:1},8,["value","options"])]),e("div",$t,[Lt,h($,{class:"popup_select",value:t.value.十六夜差分,"onUpdate:value":o[13]||(o[13]=a=>t.value.十六夜差分=a),options:ie.value},{default:E(()=>[Bt]),_:1},8,["value","options"])]),e("div",Tt,[Mt,h($,{class:"popup_select",value:t.value.主角特效,"onUpdate:value":o[14]||(o[14]=a=>t.value.主角特效=a),options:A(B)},{default:E(()=>[Et]),_:1},8,["value","options"])])]),e("div",Gt,[Ot,h($,{class:"popup_select",value:t.value.SE,"onUpdate:value":o[15]||(o[15]=a=>t.value.SE=a),options:A(K)},{default:E(()=>[Rt]),_:1},8,["value","options"])]),e("div",Vt,[Ht,h($,{class:"popup_select",value:t.value.Voice,"onUpdate:value":o[16]||(o[16]=a=>t.value.Voice=a),options:A(z)},{default:E(()=>[Nt]),_:1},8,["value","options"])]),e("div",Dt,[At,e("div",Pt,[h(de,{class:"popup_input -textarea",value:t.value.和訳,"onUpdate:value":o[17]||(o[17]=a=>t.value.和訳=a)},null,8,["value"]),jt])])],512),[[W,!t.value.is_showtime]]),e("div",Kt,[zt,h(de,{class:"popup_input -textarea -col-3",value:t.value.備註,"onUpdate:value":o[18]||(o[18]=a=>t.value.備註=a)},null,8,["value"])])]),e("footer",{class:"popup_footer"},[e("button",{class:"popup_submit",onClick:s,title:"保存"},"保存"),Ft])])])),[[x,i.open]])}}},Zt=X(qt,[["__scopeId","data-v-9762a114"]]);export{ze as C,Zt as E,Xt as I,Yt as M,Fe as u};
