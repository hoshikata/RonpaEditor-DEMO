import{o as w,c as I,a as t,_ as z,J as je,n as V,K as He,j as he,s as j,u as $e,b as _e,B as Se,i as oe,h as B,C as Me,r as ee,L as Pe,q as Ue,w as D,d as e,e as u,t as h,v as W,y as T,F as se,m as we,M as ye,N as ke,p as G,z as me,A as Ne,O as Fe,g as Te,E as Le,I as We,H as ze}from"./index-C_Ek1gBZ.js";import{I as Je,a as qe,D as Ee}from"./IconDelete-50ryJHyP.js";import{W as Ke}from"./Wrap-BS-klX6W.js";import{C as Ce}from"./Control-Di8ix8iZ.js";import{C as Ve,I as Ge,u as Qe,M as Xe,E as Ye}from"./EditPopup-Bdgeyc4l.js";import{M as Ze}from"./Mark-BQ6MkwrW.js";import{R as et,_ as be}from"./Radio-D1i1gDhP.js";import{S as K,D as tt}from"./Dialog-BXEgvnYS.js";import{A as st}from"./Avatar-dLNiOsKi.js";import"./round-drag-indicator-Cj_XD6Rj.js";/* empty css                                                             */import"./Image-C9k9Aib3.js";const ot={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},lt=t("path",{fill:"currentColor",d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"},null,-1),at=[lt];function nt(o,f){return w(),I("svg",ot,[...at])}const it={name:"ic-round-close",render:nt},ct={__name:"Switch",props:{active:{type:[Boolean],default:!1}},setup(o){return(f,_)=>(w(),I("button",{class:V(["switch",{"bg-current":o.active}])},[t("span",{class:V(["-mt-0.1em",{"text-white":o.active}])},[je(f.$slots,"default",{},void 0,!0)],2)],2))}},de=z(ct,[["__scopeId","data-v-8bd1e4e9"]]),rt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ut=t("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1),dt=[ut];function pt(o,f){return w(),I("svg",rt,[...dt])}const pe={name:"ic-round-search",render:pt},ht={name:"MaterialSymbolsFindReplaceRounded"},_t={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},vt=t("path",{fill:"currentColor",d:"M11 6q-1.575 0-2.838.863T6.35 9.125q-.15.375-.487.563t-.738.112t-.638-.387t-.112-.663q.675-2.1 2.475-3.425T11 4q1.475 0 2.763.562T16 6.1V5q0-.425.288-.712T17 4t.713.288T18 5v4q0 .425-.288.713T17 10h-4q-.425 0-.712-.288T12 9t.288-.712T13 8h2q-.725-.9-1.737-1.45T11 6m0 12q-1.475 0-2.762-.562T6 15.9V17q0 .425-.288.713T5 18t-.712-.288T4 17v-4q0-.425.288-.712T5 12h4q.425 0 .713.288T10 13t-.288.713T9 14H7q.725.9 1.738 1.45T11 16q1.55 0 2.788-.825T15.6 13q.175-.4.513-.638t.762-.162q.425.1.625.45t.075.75q-.175.5-.413.938t-.562.862l3.7 3.7q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-3.7-3.7q-.9.675-1.962 1.038T11 18"},null,-1),gt=[vt];function mt(o,f,_,$,C,y){return w(),I("svg",_t,gt)}const fe=z(ht,[["render",mt]]),xe=He("search",()=>{const o=he(),{initSelected:f}=o,{chapterData:_}=j(o),$=$e(),{getCharacter:C,getSprite:y}=$,{characterList:R}=j($),g=_e(),{getShowList:b}=g,{effectList:L,seList:r}=j(g),{copyObject:l,findData:S}=Se(),{t:x}=oe("lang"),N=B(()=>{let i=_.value;const{type:c,result:s}=X.value;return c===0&&(i=te(s)),c===1&&(i=F(s)),c===2&&(i=ie(s)),i}),Q=B(()=>N.value.map(i=>i.id)),M=Me({type:0,keyword:{value:"",rep:""},show:{parent:"",child:"",rep:""},items:[{parent:"",child:""}],itemsRep:{parent:"",child:"",rep:""},open:!1}),X=ee({}),k=B(()=>{const i=[];return R.value.forEach(c=>{const s=(c.sprite??[]).map(a=>({id:c.id+"_"+a.id,name:c.name+"："+a.name}));i.push(...s)}),i}),p=i=>{let c=[];const s=["speaker","char_1","char_2"].includes(i),a=["char_1_sprite","char_2_sprite"].includes(i),n=["char_1_effect","char_2_effect"].includes(i);return s&&(c=R.value.map(v=>({...v,name:x(`showtime.${v.name}`)??v.name}))),a&&(c=k.value),n&&(c=L.value),i==="se"&&(c=r.value),c},U=()=>{M.keyword={value:"",rep:""},M.show={parent:"",child:"",rep:""},M.items=[{parent:"",child:""}],M.itemsRep={parent:"",child:"",value:""},M.type=0,A()},d=()=>{const{type:i,keyword:c,show:s,items:a,itemsRep:n}=M;let v={};return i===0&&(v={result:c.value,rep:c.rep}),i===1&&(v={result:l(s),rep:s.rep}),i===2&&(v={result:l(a),rep:l(n)}),{type:i,...v}},A=()=>{X.value=d(),f(_.value),M.open=!1},H=()=>{const i=d();i.value=i;const{type:c,result:s,rep:a}=i;c===0&&ve(s,a),c===1&&re(s,a),c===2&&ue(s,a),f(_.value),U(),M.open=!1};Pe(A);const Y=(i,c)=>{const s=b(i)??[],a=S(s,c);return s.length?c!==""&&!a:c!==""},le=(i,c)=>{const s=p(i)??[],a=S(s,c);return s.length?c!==""&&!a:c!==""},Z=(i,c)=>{const s={char_1_sprite:"char_1",char_2_sprite:"char_2"},a=i[s[c]],n=i[c],v=C(a).sprite??[],m=y(a,n),E=v.length?n!==""&&m.id===void 0:n!=="";return{name:s[c],group:a,value:n,isErr:E}},ae=i=>i.some(c=>!(c.parent===""&&c.child==="")),ne=i=>{let[c,s]=i.split("_");return[c*1,s*1]},J=(i,c,s,a)=>i===""?c:i==="err"?s:a,te=i=>(i=i??"",i===""?_.value:_.value.filter(c=>c.content.match(i))),F=({parent:i,child:c})=>i===""&&c===""?_.value:_.value.filter(s=>{const{is_showtime:a,show_time:n,show_name:v}=s;if(!a||!(i===""?!0:n===i))return!1;const E=Y(n,v);return J(c,!0,E,v===c)}),ie=i=>ae(i)?_.value.filter(s=>s.is_showtime?!1:i.every(a=>{const{parent:n,child:v}=a;if(["char_1_sprite","char_2_sprite"].includes(n)){const[E,q]=ne(v),{group:P,value:ce,isErr:ge}=Z(s,n);return J(v,ce!=="",ge,P===E&&ce===q)}else{const E=s[n],q=le(n,E);return J(v,E!=="",q,E===v)}})):_.value,ve=(i,c)=>{i=i??"",i!==""&&Q.value.forEach(s=>{const a=S(_.value,s);a.content=a.content.replace(i,c)})},re=({parent:i,child:c},s)=>{if(i===""&&c==="")return _.value;Q.value.forEach(a=>{const n=S(_.value,a),{is_showtime:v,show_time:m,show_name:E}=n;if(!v)return;const q=Y(m,E);J(c,!0,q,m===i&&E===c)&&(n.show_name=s)})},ue=(i,{parent:c,child:s,rep:a})=>{ae(i)&&Q.value.forEach(v=>{const m=S(_.value,v);if(m.is_showtime)return;if(["char_1_sprite","char_2_sprite"].includes(c)){const[q,P]=ne(s),[ce,ge]=ne(a),{name:Ie,group:Ae,value:Re,isErr:Oe}=Z(m,c);J(s,Re!=="",Oe,Ae===q&&Re===P)&&(m[Ie]=ce,m[c]=ge)}else{const q=m[c],P=le(c,q);J(s,q!=="",P,q===s)&&(m[c]=a)}})};return{chapterFilter:N,search:M,searchResult:X,getSpriteEmpty:ae,getChildOptions:p,initSearch:U,submitSearch:A,submitReplace:H,keywordSearch:te,showSearch:F,itemsSearch:ie}}),Be=o=>(ye("data-v-029af3c5"),o=o(),ke(),o),ft={class:"popup_window"},wt={class:"popup_container scrollbar"},bt={class:"mb-8 flex justify-center"},$t={class:"popup_keyword_group"},St=Be(()=>t("span",null,null,-1)),yt=["disabled","title"],kt=["disabled","title"],Ct={class:"popup_show_group"},xt=Be(()=>t("span",null,null,-1)),It={value:""},Rt={value:""},Tt={class:"-error",value:"err"},Lt=["disabled","title"],qt={value:""},Et={class:"-error",value:"err"},Dt={class:"col-span-2"},Mt=["disabled","title"],Ut={class:"contents"},Vt={class:"popup_items_group"},Bt={class:"popup_search_group"},At=["title"],Ot={value:""},jt={value:""},Ht=["onClick","title"],Pt={class:"popup_search"},Nt=["disabled","title"],Ft={class:"popup_replace"},Wt={value:""},zt={value:""},Jt={value:""},Kt=["disabled","title"],Gt={class:"popup_footer"},Qt=["title"],Xt={__name:"Search",emits:["goTop"],setup(o,{emit:f}){const _=_e(),{getShowList:$}=_,C=xe(),{getSpriteEmpty:y,getChildOptions:R,initSearch:g,submitSearch:b,submitReplace:L}=C,{search:r}=j(C),{t:l}=oe("lang"),S=B(()=>y(r.value.items)),x=B(()=>[{id:"ui",title:l("showtime.ui")},{id:"bg",title:l("showtime.bg")},{id:"bgm",title:l("showtime.bgm")},{id:"cg",title:l("showtime.cg")},{id:"black",title:l("showtime.black")}]),N=B(()=>[{id:"speaker",title:l("data.speaker")},{id:"char_1",title:l("data.char_1")},{id:"char_1_sprite",title:l("data.char_1_sprite")},{id:"char_1_effect",title:l("data.char_1_effect")},{id:"char_2",title:l("data.char_2")},{id:"char_2_sprite",title:l("data.char_2_sprite")},{id:"char_2_effect",title:l("data.char_2_effect")},{id:"se",title:l("data.se")},{id:"voice",title:l("data.voice")}]),Q=()=>r.value.items.push({parent:"",child:""}),M=k=>r.value.items.splice(k,1),X=k=>{const p=k.target.matches(".popup_window, .popup_window *"),U=k.target.matches(".popup_close");!k.target.matches(".popup_remove")&&(!p||U)&&(r.value.open=!1)};return(k,p)=>{const U=Ue("visible");return D((w(),I("section",{class:"popup",onClick:X},[t("div",ft,[t("div",wt,[t("div",bt,[u(et,{class:"popup_radio",value:e(r).type,"onUpdate:value":p[0]||(p[0]=d=>e(r).type=d),list:[{id:0,title:e(l)("edit.serif")},{id:1,title:e(l)("showtime.scene")+"＆"+e(l)("showtime.perform")},{id:2,title:e(l)("search.item")}],name:"type"},null,8,["value","list"])]),D(t("div",$t,[St,u(be,{class:"popup_input col-span-2",value:e(r).keyword.value,"onUpdate:value":p[1]||(p[1]=d=>e(r).keyword.value=d),placeholder:e(l)("search.keyword")},null,8,["value","placeholder"]),t("button",{class:"popup_submit",onClick:p[2]||(p[2]=(...d)=>e(b)&&e(b)(...d)),disabled:e(r).keyword.value==="",title:e(l)("search.search")},[u(e(pe))],8,yt),t("span",null,h(e(l)("search.replace-from")),1),u(be,{class:"popup_input",value:e(r).keyword.rep,"onUpdate:value":p[3]||(p[3]=d=>e(r).keyword.rep=d)},null,8,["value"]),t("span",null,h(e(l)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:p[4]||(p[4]=(...d)=>e(L)&&e(L)(...d)),disabled:e(r).keyword.value==="",title:e(l)("search.replace")},[u(fe,{class:"text-[1.2em]"})],8,kt)],512),[[W,e(r).type===0]]),D(t("div",Ct,[xt,u(K,{class:"popup_select",value:e(r).show.parent,"onUpdate:value":p[5]||(p[5]=d=>e(r).show.parent=d),options:x.value,onChange:p[6]||(p[6]=d=>{e(r).show.child="",e(r).show.rep=""})},{default:T(()=>[t("option",It,h(e(l)("search.all")),1)]),_:1},8,["value","options"]),t("span",null,h(e(l)("search.is")),1),u(K,{class:"popup_select",value:e(r).show.child,"onUpdate:value":p[7]||(p[7]=d=>e(r).show.child=d),options:e($)(e(r).show.parent)},{default:T(()=>[t("option",Rt,h(e(l)("search.all")),1),t("option",Tt,h(e(l)("search.err")),1)]),_:1},8,["value","options"]),t("button",{class:"popup_submit",onClick:p[8]||(p[8]=(...d)=>e(b)&&e(b)(...d)),disabled:e(r).show.parent===""&&e(r).show.child==="",title:e(l)("search.search")},[u(e(pe))],8,Lt),t("span",null,h(e(l)("search.replace-from")),1),u(K,{class:"popup_select",value:e(r).show.rep,"onUpdate:value":p[9]||(p[9]=d=>e(r).show.rep=d),options:e($)(e(r).show.parent)},{default:T(()=>[t("option",qt,h(e(l)("search.all")),1),t("option",Et,h(e(l)("search.err")),1)]),_:1},8,["value","options"]),t("span",Dt,h(e(l)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:p[10]||(p[10]=(...d)=>e(L)&&e(L)(...d)),disabled:e(r).show.rep==="",title:e(l)("search.replace")},[u(fe,{class:"text-[1.2em]"})],8,Mt)],512),[[W,e(r).type===1]]),D(t("div",Ut,[t("div",Vt,[(w(!0),I(se,null,we(e(r).items,(d,A)=>(w(),I("div",Bt,[D(t("button",{class:"popup_submit",onClick:Q,title:e(l)("search.add")},h(e(l)("search.add")),9,At),[[W,!A]]),D(t("span",{class:"text-right"},h(e(l)("search.and")),513),[[W,A]]),u(K,{class:"popup_select",value:d.parent,"onUpdate:value":H=>d.parent=H,options:N.value,onChange:H=>d.child=""},{default:T(()=>[t("option",Ot,h(e(l)("search.all")),1)]),_:2},1032,["value","onUpdate:value","options","onChange"]),t("span",null,h(e(l)("search.is")),1),u(K,{class:"popup_select",value:d.child,"onUpdate:value":H=>d.child=H,options:e(R)(d.parent)},{default:T(()=>[t("option",jt,h(e(l)("search.all")),1),D(t("option",{class:"-error",value:"err"},h(e(l)("search.err")),513),[[W,d.parent!==""]])]),_:2},1032,["value","onUpdate:value","options"]),D((w(),I("button",{class:"popup_remove",onClick:H=>M(A),title:e(l)("button.del")},[u(e(it))],8,Ht)),[[U,A]])]))),256)),t("div",Pt,[t("button",{class:"popup_submit",onClick:p[11]||(p[11]=(...d)=>e(b)&&e(b)(...d)),disabled:!S.value,title:e(l)("search.search")},[u(e(pe))],8,Nt)])]),t("div",Ft,[u(K,{class:"popup_select",value:e(r).itemsRep.parent,"onUpdate:value":p[12]||(p[12]=d=>e(r).itemsRep.parent=d),options:N.value,onChange:p[13]||(p[13]=d=>{e(r).itemsRep.child="",e(r).itemsRep.rep=""})},{default:T(()=>[t("option",Wt,h(e(l)("search.all")),1)]),_:1},8,["value","options"]),t("span",null,h(e(l)("search.is")),1),u(K,{class:"popup_select",value:e(r).itemsRep.child,"onUpdate:value":p[14]||(p[14]=d=>e(r).itemsRep.child=d),options:e(R)(e(r).itemsRep.parent)},{default:T(()=>[t("option",zt,h(e(l)("search.all")),1),D(t("option",{class:"-error",value:"err"},h(e(l)("search.err")),513),[[W,e(r).itemsRep.parent!==""]])]),_:1},8,["value","options"]),t("span",null,h(e(l)("search.replace-from")),1),u(K,{class:"popup_select",value:e(r).itemsRep.rep,"onUpdate:value":p[15]||(p[15]=d=>e(r).itemsRep.rep=d),options:e(R)(e(r).itemsRep.parent)},{default:T(()=>[t("option",Jt,h(e(l)("edit.name")),1)]),_:1},8,["value","options"]),t("span",null,h(e(l)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:p[16]||(p[16]=(...d)=>e(L)&&e(L)(...d)),disabled:e(r).itemsRep.parent===""&&e(r).itemsRep.child===""||e(r).itemsRep.rep==="",title:e(l)("search.replace")},[u(fe,{class:"text-[1.2em]"})],8,Kt)])],512),[[W,e(r).type===2]])]),t("footer",Gt,[t("button",{class:"popup_submit -cancel",onClick:p[17]||(p[17]=(...d)=>e(g)&&e(g)(...d)),title:e(l)("search.cancel")},h(e(l)("search.cancel")),9,Qt)])])])),[[U,e(r).open]])}}},Yt=z(Xt,[["__scopeId","data-v-029af3c5"]]),Zt={name:"MaterialSymbolsArrowWarmUpRounded"},es={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},ts=t("path",{fill:"currentColor",d:"M12 13q-.425 0-.712-.288T11 12V5.825L7.1 9.7q-.275.275-.687.288T5.7 9.7q-.275-.275-.275-.7t.275-.7l5.6-5.6q.15-.15.325-.212T12 2.425t.375.063t.325.212l5.6 5.6q.275.275.275.688T18.3 9.7q-.3.3-.712.3t-.713-.3L13 5.825V12q0 .425-.288.713T12 13m0 5q-.425 0-.712-.288T11 17v-1q0-.425.288-.712T12 15t.713.288T13 16v1q0 .425-.288.713T12 18m0 4q-.425 0-.712-.288T11 21t.288-.712T12 20t.713.288T13 21t-.288.713T12 22"},null,-1),ss=[ts];function os(o,f,_,$,C,y){return w(),I("svg",es,ss)}const De=z(Zt,[["render",os]]),ls={class:"chapter_head"},as=["title"],ns=["disabled","title"],is=["disabled","title"],cs=["title"],rs={__name:"Head",setup(o){const f=he(),{deleteChapter:_,moveChapter:$}=f,{chapterIndex:C,chapterLength:y,chapterTarget:R}=j(f),g=xe(),{search:b,searchResult:L}=j(g),{t:r}=oe("lang");return(l,S)=>(w(),I("header",ls,[u(be,{class:"chapter_head_title",value:e(R).title,"onUpdate:value":S[0]||(S[0]=x=>e(R).title=x),placeholder:e(r)("edit.title-input")},null,8,["value","placeholder"]),t("button",{class:V(["chapter_head_button",{"-active":e(L).result}]),onClick:S[1]||(S[1]=x=>e(b).open=!0),title:e(r)("search.search")},[u(e(pe),{class:"!text-xl"})],10,as),t("button",{class:"chapter_head_button",onClick:S[2]||(S[2]=x=>e($)(-1)),disabled:!e(C),title:e(r)("button.up")},[u(De)],8,ns),t("button",{class:"chapter_head_button",onClick:S[3]||(S[3]=x=>e($)(1)),disabled:!e(y)||e(C)===e(y)-1,title:e(r)("button.down")},[u(De,{class:"-scale-y-100"})],8,is),t("button",{class:"chapter_head_button",onClick:S[4]||(S[4]=(...x)=>e(_)&&e(_)(...x)),title:e(r)("button.del")},[u(Je)],8,cs)]))}},us=z(rs,[["__scopeId","data-v-88d7b690"]]),ds={__name:"Inner",props:{value:{type:[Number,String],default:void 0},list:{type:[Array,Boolean],default:!1},type:{type:[String],default:""}},setup(o){const f=o,{findData:_}=Se(),$=B(()=>_(f.list||[],f.value)),C=B(()=>f.list===!1?!1:f.value!==""&&!$.value),y=B(()=>({"-showtime":f.type==="showtime","!bg-red-500/50":C.value}));return(R,g)=>{var b;return w(),I("div",{class:V(["inner",y.value])},h(((b=$.value)==null?void 0:b.name)??o.value),3)}}},O=z(ds,[["__scopeId","data-v-8cdb2df2"]]),ps=o=>(ye("data-v-569f67ca"),o=o(),ke(),o),hs={class:"chapter log_scene"},_s=ps(()=>t("div",{class:"chapter log_switches xl:!hidden"},null,-1)),vs={__name:"logShowHead",props:{log:{type:[Object],default:()=>({})}},emits:["more"],setup(o,{emit:f}){const _=f,$=_e(),{getShowList:C}=$,{t:y}=oe("lang");return(R,g)=>(w(),I(se,null,[t("div",{class:V(["chapter log_td -first",{"bg-secondary/60":o.log.is_selected}])},[u(Ve,{class:"chapter log_check",value:o.log.is_selected,"onUpdate:value":g[0]||(g[0]=b=>o.log.is_selected=b)},null,8,["value"]),u(Ce,{class:"chapter log_control",onMore:g[1]||(g[1]=b=>_("more",b)),hasDel:!1,hasAdd:!1}),t("div",hs,[t("span",null,h(e(y)(`showtime.${o.log.speaker}`)),1),t("span",null,h(e(y)(`showtime.${o.log.show_time}`)??o.log.show_time),1),u(O,{value:o.log.show_name,list:e(C)(o.log.show_time),type:"showtime"},null,8,["value","list"])])],2),_s],64))}},gs=z(vs,[["__scopeId","data-v-569f67ca"]]),ms={class:"chapter log_tr_2"},fs=t("div",{class:"chapter log_td -col"},null,-1),ws=t("div",{class:"chapter log_td -col"},null,-1),bs=t("div",{class:"chapter log_td -col"},null,-1),$s={class:"chapter log_td -col"},Ss={__name:"logShowBody",props:{log:{type:[Object],default:()=>({})}},setup(o){return(f,_)=>(w(),I("div",ms,[fs,ws,bs,t("div",$s,[u(O,{value:o.log.remark},null,8,["value"])])]))}},ys=["title"],ks={class:"chapter log_comment"},Cs={class:"chapter log_switches"},xs={__name:"logCommentHead",props:{log:{type:[Object],default:()=>({})}},emits:["more","target"],setup(o,{emit:f}){const _=o,$=f,C=$e(),{getCharacter:y}=C,R=he(),{dialogType:g}=R,{t:b}=oe("lang"),L=B(()=>y(_.log.speaker));return(r,l)=>{const S=Ue("visible");return w(),I(se,null,[t("div",{class:V(["chapter log_td -first",{"bg-secondary/60":o.log.is_selected}])},[u(Ve,{class:"chapter log_check",value:o.log.is_selected,"onUpdate:value":l[0]||(l[0]=x=>o.log.is_selected=x)},null,8,["value"]),u(Ce,{class:"chapter log_control",onMore:l[2]||(l[2]=x=>$("more",x)),onDel:l[3]||(l[3]=x=>o.log.is_delete=!0),hasAdd:!1},{top:T(()=>[t("button",{class:"control_button",onClick:l[1]||(l[1]=x=>$("target")),title:e(b)("button.target-chapter")},[u(Ge,{class:"text-xl"})],8,ys)]),_:1}),t("div",{class:V(["chapter log_info",{"flex-row-reverse":L.value.is_hero,"-replay":o.log.is_replay}])},[u(st,{class:"chapter log_avatar",name:L.value.name??o.log.speaker},null,8,["name"]),t("div",ks,[u(tt,{class:"chapter log_dialog",value:o.log.content,type:e(g)(o.log)},null,8,["value","type"])])],2)],2),t("div",Cs,[D((w(),G(de,{class:V(["chapter log_switch",{"text-replay":o.log.is_replay}]),active:o.log.is_replay,title:e(b)("data.replay")},{default:T(()=>[me("R")]),_:1},8,["active","class","title"])),[[S,o.log.is_replay]]),D((w(),G(de,{class:V(["chapter log_switch",{"text-unknown":o.log.is_unknown}]),active:o.log.is_unknown,title:e(b)("data.unknown")},{default:T(()=>[me("U")]),_:1},8,["active","class","title"])),[[S,o.log.is_unknown]]),D((w(),G(de,{class:V(["chapter log_switch",{"-monolog":o.log.is_monolog}]),active:o.log.is_monolog,title:e(b)("data.monolog")},{default:T(()=>[me("S")]),_:1},8,["active","class","title"])),[[S,o.log.is_monolog]])])],64)}}},Is=z(xs,[["__scopeId","data-v-620df50d"]]),Rs={class:"chapter log_tr_2"},Ts={class:"chapter log_td -col"},Ls={class:"chapter log_td -col"},qs={class:"chapter log_td -col"},Es={class:"chapter log_td -col"},Ds={__name:"logCommentBody",props:{log:{type:[Object],default:()=>({})}},setup(o){const f=$e(),{getCharacter:_}=f,{characterList:$}=j(f),C=_e(),{effectList:y,seList:R,voiceList:g}=j(C);return(b,L)=>(w(),I("div",Rs,[t("div",Ts,[u(O,{class:"col-span-2",value:o.log.char_1,list:e($)},null,8,["value","list"]),u(O,{value:o.log.char_1_sprite,list:e(_)(o.log.char_1).sprite},null,8,["value","list"]),u(O,{value:o.log.char_1_effect,list:e(y)},null,8,["value","list"])]),t("div",Ls,[u(O,{class:"col-span-2",value:o.log.char_2,list:e($)},null,8,["value","list"]),u(O,{value:o.log.char_2_sprite,list:e(_)(o.log.char_2).sprite},null,8,["value","list"]),u(O,{value:o.log.char_2_effect,list:e(y)},null,8,["value","list"])]),t("div",qs,[u(O,{value:o.log.se,list:e(R)},null,8,["value","list"]),u(O,{value:o.log.voice,list:e(g)},null,8,["value","list"])]),t("div",Es,[u(O,{value:o.log.remark},null,8,["value"])])]))}},Ms=o=>(ye("data-v-64bac1d1"),o=o(),ke(),o),Us=["title"],Vs={class:"side_list"},Bs={class:"flex"},As=["onClick","title"],Os={class:"chapter log"},js={class:"chapter log_tr -lock"},Hs={class:"mx-1 w-14 self-center"},Ps={class:"chapter log_th xl:ml-0"},Ns=Ms(()=>t("div",{class:"ml-3 w-7 shrink-0 xl:hidden"},null,-1)),Fs={class:"chapter log_tr_2 -lock"},Ws={class:"chapter log_th -col"},zs={class:"chapter log_th -col"},Js={class:"chapter log_th -col"},Ks={class:"chapter log_th -col"},Gs={class:"contents"},Qs=["onDragstart","onDragend"],Xs={__name:"index",setup(o){const f=Ne(),_=Fe(),$=he(),{newChapter:C}=$,{chapterIndex:y,chapterNames:R,chapterData:g}=j($),b=Qe(),{newLogId:L}=b,{logId:r}=j(b),l=xe(),{chapterFilter:S}=j(l),{findData:x,findIndex:N,getClientRect:Q}=Se(),{dragMove:M,dropMove:X}=We(),{t:k}=oe("lang"),p=B(()=>g.value.some(s=>s.dragging)),U=B(()=>g.value.filter(s=>s.is_selected&&!s.is_delete).map(s=>s.id)),d=(s,a,n)=>{const v=x(g.value,a),m=g.value.indexOf(v);n&&M(s,{index:m}),U.value.some(q=>q===a)||(v.is_selected=1),U.value.forEach(q=>{const P=x(g.value,q);P.dragging=n,n||(P.is_selected=0)})},A=(s,a)=>{const n=a===null?0:N(g.value,a)+1;U.value.forEach(v=>{const m=N(g.value,v);X(g.value,m,n)})},H=ee(!1),Y=ee(0),le=ee(null),Z=(s,a)=>{const n=N(g.value,a);Y.value=a!==void 0&&n===-1?null:n,le.value=s,H.value=a===null},ae=({type:s})=>{const a=Y.value,n=g.value[a];s==="delete"?J(n):s==="edit"?ie(n.id,{}):s==="copy"?ne(n,a+1):ie("add",{type:s})},ne=(s,a)=>{g.value.splice(a+1,0,{...s,id:L()})},J=s=>{s.is_delete=!0,U.value.forEach(a=>a.is_delete=!0)},te=ee(!1),F=Me({id:0,type:"",index:0}),ie=(s,{type:a})=>{F.id=s,F.type=a??"",F.index=Y.value,te.value=!0},ve=s=>{const a=Y.value===null?g.value.length:F.index+1;g.value.splice(a,0,s)},re=ee(null),ue=ee({}),i=()=>{ze(()=>{const s=ue.value[r.value];if(!s)return;const{height:a,top:n}=Q(s);re.value.mainScroll({top:n-a*2,left:0})})},c=s=>{r.value=s,_.push({name:"Preview"})};return Te(y,i),Te(()=>f.name,s=>{s==="Chapters"&&i()}),(s,a)=>(w(),G(Ke,{ref_key:"wrap",ref:re},{side_foot:T(()=>[t("button",{class:"chapter_add",onClick:a[0]||(a[0]=(...n)=>e(C)&&e(C)(...n)),title:e(k)("button.new")},[u(e(qe))],8,Us)]),side:T(()=>[t("ul",Vs,[(w(!0),I(se,null,we(e(R),(n,v)=>(w(),I("li",Bs,[u(Ze,{class:"chapter_mark",active:v===e(y)},null,8,["active"]),t("button",{class:V(["side_item",{"side_item-active":v===e(y)}]),onClick:m=>y.value=v,title:n},h(n),11,As)]))),256))])]),main_head:T(()=>[u(us)]),default:T(()=>[t("div",Os,[t("div",js,[t("div",Hs,[u(de,{class:"chapter_plus",title:e(k)("button.new")},{default:T(()=>[u(e(qe),{class:"mt-0.1em"}),u(Ce,{class:"absolute left-0 top-0 opacity-0",onMore:a[1]||(a[1]=n=>Z(n,null)),hasDel:!1,hasAdd:!1})]),_:1},8,["title"])]),t("div",Ps,h(e(k)("edit.serif"))+"＆"+h(e(k)("showtime.scene"))+"＆"+h(e(k)("showtime.perform")),1),Ns]),t("div",Fs,[t("div",Ws,h(e(k)("data.char_1"))+"．"+h(e(k)("edit.sprite-ign"))+"＆"+h(e(k)("edit.effect")),1),t("div",zs,h(e(k)("data.char_2"))+"．"+h(e(k)("edit.sprite-ign"))+"＆"+h(e(k)("edit.effect")),1),t("div",Js,h(e(k)("data.se"))+"＆"+h(e(k)("data.voice")),1),t("div",Ks,h(e(k)("data.remark")),1)]),u(Ee,{class:"chapter log_dragline",onDrop:a[2]||(a[2]=n=>A(n,null)),dragging:p.value},null,8,["dragging"]),(w(!0),I(se,null,we(e(S),(n,v)=>(w(),I(se,{key:n.id},[D(t("section",Gs,[t("div",{class:V(["chapter log_tr",{"-dragging":n.dragging}]),draggable:!0,onDragstart:m=>d(m,n.id,!0),onDragend:m=>d(m,n.id,!1),onDrag:a[3]||(a[3]=Le(()=>{},["prevent"])),onDrop:a[4]||(a[4]=Le(()=>{},["prevent"])),ref_for:!0,ref:m=>ue.value[n.id]=m},[n.is_showtime?(w(),G(gs,{key:0,log:n,onMore:m=>Z(m,n.id)},null,8,["log","onMore"])):(w(),G(Is,{key:1,log:n,onMore:m=>Z(m,n.id),onTarget:m=>c(n.id)},null,8,["log","onMore","onTarget"]))],42,Qs),n.is_showtime?(w(),G(Ss,{key:0,log:n},null,8,["log"])):(w(),G(Ds,{key:1,log:n},null,8,["log"]))],512),[[W,!n.is_delete]]),D(u(Ee,{class:"chapter log_dragline",onDrop:m=>A(m,n.id),dragging:p.value},null,8,["onDrop","dragging"]),[[W,!n.is_delete]])],64))),128))]),u(Xe,{positions:le.value,onClear:Z,onUse:ae,onlyAdd:H.value},null,8,["positions","onlyAdd"]),u(Yt),u(Ye,{open:te.value,"onUpdate:open":a[5]||(a[5]=n=>te.value=n),id:F.id,type:F.type,onAdd:ve},null,8,["open","id","type"])]),_:1},512))}},ho=z(Xs,[["__scopeId","data-v-64bac1d1"]]);export{ho as default};
