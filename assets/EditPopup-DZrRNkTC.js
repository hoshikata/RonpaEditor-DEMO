import{_ as X,o as z,c as G,a as t,y as pe,i as re,r as b,h as d,q as de,w as R,n as K,l as ve,F as be,m as ye,t as u,v as Q,g as H,P as ke,G as xe,Q as Se,J as Ce,K as $e,B as Ie,j as me,s as j,u as ge,b as fe,k as Ue,L as Le,f as Te,d as l,e as w,z as D,D as Be,M as Me,N as Re}from"./index-eIGxLf3c.js";/* empty css                                                             */import{S as U}from"./Dialog-DRo44WDt.js";const Ne={name:"MdiTarget"},Oe={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},De=t("path",{fill:"currentColor",d:"M11 2v2.07A8 8 0 0 0 4.07 11H2v2h2.07A8 8 0 0 0 11 19.93V22h2v-2.07A8 8 0 0 0 19.93 13H22v-2h-2.07A8 8 0 0 0 13 4.07V2m-2 4.08V8h2V6.09c2.5.41 4.5 2.41 4.92 4.91H16v2h1.91c-.41 2.5-2.41 4.5-4.91 4.92V16h-2v1.91C8.5 17.5 6.5 15.5 6.08 13H8v-2H6.09C6.5 8.5 8.5 6.5 11 6.08M12 11a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1"},null,-1),He=[De];function Ee(r,$,h,_,v,i){return z(),G("svg",Oe,He)}const ss=X(Ne,[["render",Ee]]),Ve={class:"menu_list"},Pe={class:"contents"},Ae=["onClick","title"],je={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(r,{emit:$}){const h=r,_=$,{getClientRect:v}=pe(),{t:i}=re("lang"),y=b(null),m=d(()=>[{title:i("edit.serif"),type:"dialog"},{title:i("edit.serif")+"："+i("edit.hero"),type:"dialog_hero"},{title:i("showtime.scene")+"："+i("showtime.ui"),type:"scene_ui"},{title:i("showtime.scene")+"："+i("showtime.bg"),type:"scene_bg"},{title:i("showtime.scene")+"："+i("showtime.bgm"),type:"scene_bgm"},{title:i("showtime.perform")+"："+i("showtime.cg"),type:"perform_cg"},{title:i("showtime.perform")+"："+i("showtime.cg")+i("showtime.end"),type:"perform_cg_end"},{title:i("showtime.perform")+"："+i("showtime.black"),type:"perform_black"},{title:i("showtime.announce"),type:"dialog_announce",class:"!text-announce"},{title:i("showtime.system"),type:"dialog_system",class:"!text-announce"},{title:i("button.copy"),type:"copy",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:i("button.edit"),type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:i("button.del"),type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}]),L=d(()=>{const{width:g,height:N}=v(document.documentElement),{width:T,height:k}=v(y.value),{x:p,y:C,width:B,height:M}=h.positions??{},I=(C??0)+(M??0)/2-(k??0)/2,x=(I<20?20:I)+"px",O=(N??0)-(k??0)-20+"px",q=`min(${x}, ${O})`,J=(p??0)+(T??0)>g,P=(p??0)+(B??0)+2,A=(p??0)-(T??0)-9-2,E=(J?A:P)+"px";return{top:q,left:E}}),S=d(()=>{const{width:g}=v(document.documentElement),{width:N}=v(y.value),{x:T,y:k,width:p,height:C}=h.positions??{},B=(k??0)+(C??0)/2,M=(T??0)+(N??0)>g,I=(T??0)+(p??0)+3,x=(T??0)-3.2,O=M?x:I;return{top:B+"px",left:O+"px",turn:M}}),V=g=>{g.target.matches(".menu, .menu *")||_("clear",null)},F=g=>{_("use",{type:g}),_("clear",null)};return(g,N)=>{const T=de("visible");return R((z(),G("div",{class:"menu_container",onClick:V},[t("div",{class:K(["menu_triangle",{"-scale-x-100":S.value.turn}]),style:ve(S.value)},null,6),t("div",{class:"menu scrollbar overflow-y-auto",style:ve(L.value),ref_key:"menu",ref:y},[t("ul",Ve,[(z(!0),G(be,null,ye(m.value,k=>(z(),G("li",Pe,[R(t("button",{class:K(["menu_item",k.class]),onClick:p=>F(k.type),title:k.title},u(k.title),11,Ae),[[Q,!(["copy","edit","delete"].includes(k.type)&&r.onlyAdd)]])]))),256))])],4)])),[[T,r.positions]])}}},os=X(je,[["__scopeId","data-v-cbf49607"]]),ze=["disabled","placeholder"],Ge={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(r,{emit:$}){const h=r,_=$,v=b(null),i=b(""),y=m=>{if(!m.ctrlKey)return;const{selectionStart:L,selectionEnd:S}=v.value;_("selected",{start:L,end:S})};return H(i,m=>_("update:value",m)),H(()=>h.value,m=>i.value=m,{immediate:!0}),(m,L)=>{const S=de("verify");return R((z(),G("textarea",{class:"scrollbar textarea","onUpdate:modelValue":L[0]||(L[0]=V=>i.value=V),disabled:r.disabled,placeholder:r.disabled?"":r.placeholder,onKeydown:xe(y,["q"]),ref_key:"textarea",ref:v},null,40,ze)),[[ke,i.value,void 0,{lazy:!0,trim:!0}],[S,void 0,void 0,{check:!0}]])}}},he=X(Ge,[["__scopeId","data-v-c1e57f9a"]]),Ke=["disabled"],Fe={class:"whitespace-nowrap"},qe={__name:"Checkbox",props:{value:{type:[Number],default:0},disabled:{type:[Boolean],default:!1},title:{type:[String],default:""},box:{type:[String],default:""}},emits:["update:value"],setup(r,{emit:$}){const h=r,_=$,v=b(0);return H(v,i=>_("update:value",i)),H(()=>h.value,i=>v.value=i,{immediate:!0}),(i,y)=>(z(),G("label",{class:K(["inline-flex items-center",r.disabled?"cursor-auto":"cursor-pointer"])},[R(t("input",{class:K(["checkbox",r.box]),"onUpdate:modelValue":y[0]||(y[0]=m=>v.value=m),disabled:r.disabled,"true-value":1,"false-value":0,type:"checkbox"},null,10,Ke),[[Se,v.value]]),t("span",Fe,u(r.title),1),Ce(i.$slots,"default",{},void 0,!0)],2))}},Je=X(qe,[["__scopeId","data-v-b7a95cdd"]]),Qe=$e("log",()=>{const r=Ie(),$=me(),{convertChapter:h}=$,{chapterData:_}=j($),v=ge(),{characterHero:i,characterUnknown:y}=j(v),m=fe(),{getUI:L,getHistoryList:S}=m,{defaultUI:V,defaultUIForCG:F}=j(m),{findData:g,findIndex:N,getRandomInt:T}=pe(),{newId:k}=Ue(),{t:p}=re("lang"),C=b(0),B=b(0),M=d(()=>g(_.value,C.value)??{}),I=d(()=>_.value.filter(o=>!o.is_delete)),x=d(()=>I.value.filter(o=>{const n=!o.is_showtime,e=o.is_perform&&o.show_time==="black";return o.is_perform&&o.show_time,n||e})),O=d(()=>{const o=N(I.value,C.value)+1,n=I.value.slice(0,o),e=I.value.slice(o);return e.every(c=>c.is_showtime&&c.show_time!=="black")&&n.push(...e),n});H(C,o=>{const n=g(_.value,o)??{};n.is_scene||(B.value=N(x.value,n.id))}),H(B,o=>{var n;return C.value=((n=x.value[o])==null?void 0:n.id)??0}),H(_,()=>{var o;return C.value=((o=x.value[0])==null?void 0:o.id)??0}),Le(()=>{var o;return C.value=((o=x.value[0])==null?void 0:o.id)??0});const q=d(()=>{const o=S(O.value,"cg");return((o==null?void 0:o.show_name)??"")!==""&&(o==null?void 0:o.show_name)!=="end"}),J=d(()=>{const o=S(O.value,"ui"),n=(o==null?void 0:o.show_name)??V.value??"",e=F.value;return q.value&&e!==""?e:n}),P=d(()=>L(J.value)),A=d(()=>{const o=P.value,n=M.value,e=i.value.name,f=n.speaker,c=o.name_tag_number===2,te=n.is_monolog&&o.name_tag_solo_show,se=f===e&&o.name_tag_hero_right,oe=f===n.char_1&&o.name_tag_sprite_1_right,we=f===n.char_2&&o.name_tag_sprite_2_right&&o.sprite_number===2;return c&&(te||se||oe||we)}),E=d(()=>{const o=M.value,n=o.is_system||o.is_announce||o.is_monolog,e=o.is_monolog&&P.value.name_tag_solo_show;return!n||e}),a=d(()=>!A.value&&E.value),Y=d(()=>A.value&&E.value),s=b(!1),ne=b(!1),Z=b(!1),ae=b(!1),le=b(!1),ie=b(!1),ce=d(()=>({"":s.value})),W=()=>{s.value=!1,Z.value=!1};H(()=>r.name,()=>s.value=!1);const ee=()=>k(_.value);return{logId:C,logIndex:B,logData:M,logShowing:I,logContents:x,logHistory:O,logCGMode:q,logUIId:J,logUI:P,isNameRight:A,isNameShow:E,nameTag1Show:a,nameTag2Show:Y,logPlay:s,logPause:ne,logTyping:Z,logBlack:ae,logVoicing:le,logAnimating:ie,playEase:ce,newLogId:ee,newLog:(o,n=!1)=>{var te,se,oe;let e={name:"",content:""};o==="scene_ui"&&(e={name:p("showtime.scene"),content:p("showtime.ui")}),o==="scene_bg"&&(e={name:p("showtime.scene"),content:p("showtime.bg")}),o==="scene_bgm"&&(e={name:p("showtime.scene"),content:p("showtime.bgm")}),o==="perform_cg"&&(e={name:p("showtime.perform"),content:p("showtime.cg")}),o==="perform_cg_end"&&(e={name:p("showtime.perform"),content:p("showtime.cg")+"/"+p("showtime.end")}),o==="perform_black"&&(e={name:p("showtime.perform"),content:p("showtime.black")+"/"+p("black.fade")}),o==="perform_anime"&&(e={name:p("showtime.perform"),content:p("showtime.anime")}),o==="dialog"&&(e={name:((te=y.value)==null?void 0:te.name)??"",content:""}),o==="dialog_hero"&&(e={name:((se=i.value)==null?void 0:se.name)??"",content:""}),o==="dialog_announce"&&(e={name:p("showtime.announce"),content:""}),o==="dialog_system"&&(e={name:p("showtime.system"),content:""});const f={id:ee(),speaker:e.name??"",char_1:"",char_1_sprite:"",char_1_effect:"",char_2:n?((oe=i.value)==null?void 0:oe.name)??"":"",char_2_sprite:"",char_2_effect:"",content:e.content??"",se:"",voice:"",remark:""},c=h(f);return{...f,...c}},stopPlaying:W,changeLog:o=>{const n=B.value+o;n<0||n>x.value.length-1||(B.value=n,W())}}}),We=r=>(Me("data-v-f02329e0"),r=r(),Re(),r),Xe={class:"popup_window"},Ye={class:"contents"},Ze={class:"contents"},et={class:"popup_label"},tt=We(()=>t("div",{class:"-col-2"},null,-1)),st={class:"contents"},ot={class:"popup_label"},nt={class:"contents"},at={class:"contents"},lt={class:"popup_label"},it={class:"popup_input"},ct={class:"contents"},ut={class:"popup_label"},pt={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},rt=["title"],dt=["title"],_t=["title"],vt={class:"popup_group"},ht={class:"popup_group_title"},mt={class:"contents"},gt={class:"popup_label"},ft={value:""},wt={class:"contents"},bt={class:"popup_label"},yt={value:""},kt={class:"contents"},xt={class:"popup_label"},St={value:""},Ct={class:"popup_group"},$t={class:"popup_group_title"},It={class:"popup_group_checkbox"},Ut={class:"contents"},Lt={class:"popup_label"},Tt={value:""},Bt={class:"contents"},Mt={class:"popup_label"},Rt={value:""},Nt={class:"contents"},Ot={class:"popup_label"},Dt={value:""},Ht={class:"contents"},Et={class:"popup_label"},Vt={value:""},Pt={class:"contents"},At={class:"popup_label"},jt={value:""},zt={class:"contents"},Gt={class:"popup_label"},Kt={class:"-col-3 grid gap-1"},Ft={class:"text-right text-xs opacity-50"},qt={class:"contents"},Jt={class:"popup_label"},Qt={class:"popup_footer"},Wt=["title"],Xt=["title"],Yt={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(r,{emit:$}){const h=r,_=$,v=Te(),{defaultHero:i}=j(v),y=ge(),{getCharacter:m}=y,{characterList:L,characterReals:S}=j(y),V=me(),{chapterData:F}=j(V),g=fe(),{blackList:N,getEffect:T,getBackground:k,getCg:p,getBgm:C,getSe:B,getShowList:M}=g,{uiList:I,effectList:x,seList:O,voiceList:q}=j(g),J=Qe(),{newLog:P}=J,{isDev:A,findData:E}=pe(),{t:a}=re("lang"),Y=b(null),s=b({}),ne=d(()=>{var n;return(n=m(s.value.speaker))==null?void 0:n.name}),Z=d(()=>[{id:"ui",title:a("showtime.ui"),show:s.value.is_scene},{id:"bg",title:a("showtime.bg"),show:s.value.is_scene},{id:"bgm",title:a("showtime.bgm"),show:s.value.is_scene},{id:"cg",title:a("showtime.cg"),show:s.value.is_perform},{id:"black",title:a("showtime.black"),show:s.value.is_perform}]),ae=d(()=>M(s.value.show_time)),le=d(()=>L.value.filter(n=>!n.disabled||n.unknown)),ie=d(()=>W(s.value.char_1)),ce=d(()=>W(s.value.char_2)),W=n=>{var e;return((e=m(n))==null?void 0:e.sprite)??[]},ee=()=>{s.value.show_time==="cg"&&s.value.show_name==="end"||(s.value.show_name="")},ue=n=>s.value[n]="",_e=()=>{const n={...s.value};if(h.id==="add")_("add",n);else{const f=E(F.value,h.id);Object.assign(f,n)}_("update:open",!1),(!n.is_showtime||n.show_time==="black")&&_("target",n.id)},o=n=>{const e=n.target.matches(".popup_window, .popup_window *"),f=n.target.matches(".-cancel");(!e||f)&&_("update:open",!1)};return H(()=>h.open,n=>{n&&(h.id==="add"?s.value=P(h.type,i.value):s.value={...E(F.value,h.id)},A&&console.log({...s.value}),Y.value.scrollTo({top:0,left:0}))}),(n,e)=>{const f=de("visible");return R((z(),G("section",{class:"popup",onClick:o},[t("div",Xe,[t("div",{class:"popup_container scrollbar",ref_key:"container",ref:Y},[R(t("div",Ye,[t("div",Ze,[t("span",et,u(l(a)(`showtime.${s.value.speaker}`)),1),w(U,{class:"popup_select",value:s.value.show_time,"onUpdate:value":e[0]||(e[0]=c=>s.value.show_time=c),options:Z.value,onChange:ee},null,8,["value","options"])]),tt,t("div",st,[t("span",ot,u(l(a)("edit.content")),1),w(U,{class:"popup_select -col-3",value:s.value.show_name,"onUpdate:value":e[1]||(e[1]=c=>s.value.show_name=c),options:ae.value},{default:D(()=>[R(t("option",{value:""},u(l(a)("edit.none")),513),[[Q,s.value.show_time!=="black"]])]),_:1},8,["value","options"])])],512),[[Q,s.value.is_showtime]]),R(t("div",nt,[R(t("div",at,[t("span",lt,u(l(a)("data.speaker")),1),t("span",it,u(l(a)(`showtime.${ne.value}`)),1)],512),[[Q,s.value.is_announce||s.value.is_system]]),R(t("div",ct,[t("span",ut,u(l(a)("data.speaker")),1),w(U,{class:"popup_select",value:s.value.speaker,"onUpdate:value":e[2]||(e[2]=c=>s.value.speaker=c),options:le.value},null,8,["value","options"])],512),[[Q,!(s.value.is_announce||s.value.is_system)]]),t("div",pt,[t("button",{class:K(["popup_switch text-replay",{"-active bg-replay":s.value.is_replay}]),onClick:e[3]||(e[3]=c=>s.value.is_replay=!s.value.is_replay),title:l(a)("data.replay")},u(l(a)("data.replay")),11,rt),t("button",{class:K(["popup_switch text-unknown",{"-active bg-unknown":s.value.is_unknown}]),onClick:e[4]||(e[4]=c=>s.value.is_unknown=!s.value.is_unknown),title:l(a)("data.unknown")},u(l(a)("data.unknown")),11,dt),t("button",{class:K(["popup_switch -monolog",{"-active":s.value.is_monolog}]),onClick:e[5]||(e[5]=c=>s.value.is_monolog=!s.value.is_monolog),title:l(a)("data.monolog")},u(l(a)("data.monolog")),11,_t)]),t("div",vt,[t("span",ht,"・"+u(l(a)("data.char_1")),1),t("div",mt,[t("span",gt,u(l(a)("edit.assign")),1),w(U,{class:"popup_select",value:s.value.char_1,"onUpdate:value":e[6]||(e[6]=c=>s.value.char_1=c),options:l(S),onChange:e[7]||(e[7]=c=>ue("char_1_sprite"))},{default:D(()=>[t("option",ft,u(l(a)("edit.assign-none")),1)]),_:1},8,["value","options"])]),t("div",wt,[t("span",bt,u(l(a)("edit.sprite")),1),w(U,{class:"popup_select",value:s.value.char_1_sprite,"onUpdate:value":e[8]||(e[8]=c=>s.value.char_1_sprite=c),options:ie.value},{default:D(()=>[t("option",yt,u(l(a)("edit.sprite-inherit")),1)]),_:1},8,["value","options"])]),t("div",kt,[t("span",xt,u(l(a)("edit.effect")),1),w(U,{class:"popup_select",value:s.value.char_1_effect,"onUpdate:value":e[9]||(e[9]=c=>s.value.char_1_effect=c),options:l(x)},{default:D(()=>[t("option",St,u(l(a)("edit.none")),1)]),_:1},8,["value","options"])])]),t("div",Ct,[t("div",$t,[t("span",null,"・"+u(l(a)("data.char_2")),1),t("label",It,[w(Je,{value:l(i),"onUpdate:value":e[10]||(e[10]=c=>Be(i)?i.value=c:null)},null,8,["value"]),t("span",null,u(l(a)("edit.default-hero")),1)])]),t("div",Ut,[t("span",Lt,u(l(a)("edit.assign")),1),w(U,{class:"popup_select",value:s.value.char_2,"onUpdate:value":e[11]||(e[11]=c=>s.value.char_2=c),options:l(S),onChange:e[12]||(e[12]=c=>ue("char_2_sprite"))},{default:D(()=>[t("option",Tt,u(l(a)("edit.assign-none")),1)]),_:1},8,["value","options"])]),t("div",Bt,[t("span",Mt,u(l(a)("edit.sprite")),1),w(U,{class:"popup_select",value:s.value.char_2_sprite,"onUpdate:value":e[13]||(e[13]=c=>s.value.char_2_sprite=c),options:ce.value},{default:D(()=>[t("option",Rt,u(l(a)("edit.sprite-inherit")),1)]),_:1},8,["value","options"])]),t("div",Nt,[t("span",Ot,u(l(a)("edit.effect")),1),w(U,{class:"popup_select",value:s.value.char_2_effect,"onUpdate:value":e[14]||(e[14]=c=>s.value.char_2_effect=c),options:l(x)},{default:D(()=>[t("option",Dt,u(l(a)("edit.none")),1)]),_:1},8,["value","options"])])]),t("div",Ht,[t("span",Et,u(l(a)("data.se")),1),w(U,{class:"popup_select",value:s.value.se,"onUpdate:value":e[15]||(e[15]=c=>s.value.se=c),options:l(O)},{default:D(()=>[t("option",Vt,u(l(a)("edit.none")),1)]),_:1},8,["value","options"])]),t("div",Pt,[t("span",At,u(l(a)("data.voice")),1),w(U,{class:"popup_select",value:s.value.voice,"onUpdate:value":e[16]||(e[16]=c=>s.value.voice=c),options:l(q)},{default:D(()=>[t("option",jt,u(l(a)("edit.none")),1)]),_:1},8,["value","options"])]),t("div",zt,[t("span",Gt,u(l(a)("edit.serif")),1),t("div",Kt,[w(he,{class:"popup_input -textarea",value:s.value.content,"onUpdate:value":e[17]||(e[17]=c=>s.value.content=c)},null,8,["value"]),t("span",Ft,u(l(a)("edit.serif-notice")),1)])])],512),[[Q,!s.value.is_showtime]]),t("div",qt,[t("span",Jt,u(l(a)("data.remark")),1),w(he,{class:"popup_input -textarea -col-3",value:s.value.remark,"onUpdate:value":e[18]||(e[18]=c=>s.value.remark=c)},null,8,["value"])])],512),t("footer",Qt,[t("button",{class:"popup_submit",onClick:_e,title:l(a)("button.save")},u(l(a)("button.save")),9,Wt),t("button",{class:"popup_submit -cancel",title:l(a)("button.cancel")},u(l(a)("button.cancel")),9,Xt)])])])),[[f,r.open]])}}},ns=X(Yt,[["__scopeId","data-v-f02329e0"]]);export{Je as C,ns as E,ss as I,os as M,Qe as u};
