import{_ as H,k as F,r as I,g as V,m as L,w as h,o as g,c as y,a as t,n as E,h as j,F as N,p as z,t as D,v as k,e as T,ec as K,ed as W,u as S,ee as q,e7 as ee,ea as te,ef as se,M as oe,s as R,f as le,b as m,e6 as P,e2 as ae,e3 as ne,d as ie}from"./index-DXMknspr.js";import{a as ue}from"./round-close-yRZ1m-84.js";const ce={class:"menu_list"},pe={class:"contents"},de=["onClick"],re={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(l,{emit:f}){const u=l,d=f,{getClientRect:n}=F(),a=I(null),c=[{title:"セリフ",type:"dialog"},{title:"セリフ：主人公",type:"dialog_hero"},{title:"切り替え：UI",type:"scene_ui"},{title:"切り替え：背景",type:"scene_bg"},{title:"切り替え：BGM",type:"scene_bgm"},{title:"演出：CG",type:"perform_cg"},{title:"演出：CG終了",type:"perform_cg_end"},{title:"演出：暗転",type:"perform_black"},{title:"アナウンス",type:"dialog_announce",class:"!text-announce"},{title:"ナレーション",type:"dialog_system",class:"!text-announce"},{title:"編集",type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"削除",type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}],v=V(()=>{const{width:e,height:$}=n(document.documentElement),{width:b,height:w}=n(a.value),{x:U,y:O,width:G,height:i}=u.positions??{},s=(O??0)+(i??0)/2-(w??0)/2,C=(s<20?20:s)+"px",o=($??0)-(w??0)-20+"px",J=`min(${C}, ${o})`,Q=(U??0)+(b??0)>e,X=(U??0)+(G??0)+2,Y=(U??0)-(b??0)-9-2,Z=(Q?Y:X)+"px";return{top:J,left:Z}}),_=V(()=>{const{width:e}=n(document.documentElement),{width:$}=n(a.value),{x:b,y:w,width:U,height:O}=u.positions??{},G=(w??0)+(O??0)/2,i=(b??0)+($??0)>e,s=(b??0)+(U??0)+3,C=(b??0)-3.2,o=i?C:s;return{top:G+"px",left:o+"px",turn:i}}),p=e=>{e.target.matches(".menu, .menu *")||d("clear",null)},x=e=>{d("use",{type:e}),d("clear",null)};return(e,$)=>{const b=L("visible");return h((g(),y("div",{class:"menu_container",onClick:p},[t("div",{class:E(["menu_triangle",{"-scale-x-100":_.value.turn}]),style:j(_.value)},null,6),t("div",{class:"menu scrollbar overflow-y-auto",style:j(v.value),ref_key:"menu",ref:a},[t("ul",ce,[(g(),y(N,null,z(c,w=>t("li",pe,[h(t("button",{class:E(["menu_item",w.class]),onClick:U=>x(w.type)},D(w.title),11,de),[[k,!(["edit","delete"].includes(w.type)&&l.onlyAdd)]])])),64))])],4)])),[[b,l.positions]])}}},wt=H(re,[["__scopeId","data-v-eb926b4f"]]),ve=["disabled","placeholder"],B={__name:"Input",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value"],setup(l,{emit:f}){const u=l,d=f,n=I("");return T(n,a=>d("update:value",a)),T(()=>u.value,a=>n.value=a,{immediate:!0}),(a,c)=>{const v=L("verify");return h((g(),y("input",{"onUpdate:modelValue":c[0]||(c[0]=_=>n.value=_),disabled:l.disabled,placeholder:l.disabled?"":l.placeholder},null,8,ve)),[[K,n.value,void 0,{lazy:!0,trim:!0}],[v,void 0,void 0,{check:!0}]])}}},_e=["disabled","placeholder"],he=["value"],me={__name:"Select",props:{value:{type:[String,Number],default:""},options:{type:[Array],default:()=>[]},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value"],setup(l,{emit:f}){W(c=>({"4ad1a84a":S(n).light.text}));const u=l,d=f,{colors:n}=q(),a=I("");return T(a,c=>d("update:value",c)),T(()=>u.value,c=>a.value=c,{immediate:!0}),(c,v)=>{const _=L("verify");return h((g(),y("select",{class:"select","onUpdate:modelValue":v[0]||(v[0]=p=>a.value=p),disabled:l.disabled,placeholder:l.disabled?"":l.placeholder},[te(c.$slots,"default",{},void 0,!0),(g(!0),y(N,null,z(l.options,p=>h((g(),y("option",{value:p.id??p},D(p.title??p.id??p),9,he)),[[k,p.show??!0]])),256))],8,_e)),[[ee,a.value,void 0,{lazy:!0,trim:!0}],[_,void 0,void 0,{check:!0}]])}}},M=H(me,[["__scopeId","data-v-1b98bee5"]]),fe=["disabled","placeholder"],ge={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(l,{emit:f}){const u=l,d=f,n=I(null),a=I(""),c=v=>{if(!v.ctrlKey)return;const{selectionStart:_,selectionEnd:p}=n.value;d("selected",{start:_,end:p})};return T(a,v=>d("update:value",v)),T(()=>u.value,v=>a.value=v,{immediate:!0}),(v,_)=>{const p=L("verify");return h((g(),y("textarea",{class:"scrollbar textarea","onUpdate:modelValue":_[0]||(_[0]=x=>a.value=x),disabled:l.disabled,placeholder:l.disabled?"":l.placeholder,onKeydown:se(c,["q"]),ref_key:"textarea",ref:n},null,40,fe)),[[K,a.value,void 0,{lazy:!0,trim:!0}],[p,void 0,void 0,{check:!0}]])}}},A=H(ge,[["__scopeId","data-v-c1e57f9a"]]),r=l=>(ae("data-v-d9aea555"),l=l(),ne(),l),ye={class:"popup_window"},we={class:"popup_header"},be={class:"popup_close",title:"キャンセル"},xe={class:"popup_container scrollbar"},ke={class:"contents"},Se={class:"contents"},$e={class:"popup_label"},Ce=r(()=>t("div",{class:"-col-2"},null,-1)),Ue={class:"contents"},Te=r(()=>t("span",{class:"popup_label"},"内容",-1)),Ee={class:"contents"},Ie={class:"contents"},Be=r(()=>t("span",{class:"popup_label"},"話し手",-1)),Me={class:"popup_input"},De={class:"contents"},Le=r(()=>t("span",{class:"popup_label"},"話し手",-1)),Oe={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},Ge={class:"popup_group"},Ve=r(()=>t("span",{class:"popup_group_title"},"・立ち絵1",-1)),He={class:"contents"},Ne=r(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),ze=r(()=>t("option",{value:""},"非表示",-1)),Pe=["value"],Re={class:"contents"},je=r(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),Ae={class:"contents"},Fe=r(()=>t("span",{class:"popup_label"},"エフェクト",-1)),Ke=r(()=>t("option",{value:""},"なし",-1)),We={class:"popup_group"},qe=r(()=>t("span",{class:"popup_group_title"},"・立ち絵2",-1)),Je={class:"contents"},Qe=r(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),Xe=r(()=>t("option",{value:""},"非表示",-1)),Ye=["value"],Ze={class:"contents"},et=r(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),tt={class:"contents"},st=r(()=>t("span",{class:"popup_label"},"エフェクト",-1)),ot={class:"contents"},lt=r(()=>t("span",{class:"popup_label"},"SE",-1)),at={class:"contents"},nt=r(()=>t("span",{class:"popup_label"},"ボイス",-1)),it={class:"contents"},ut=r(()=>t("span",{class:"popup_label"},"セリフ",-1)),ct={class:"-col-3 grid gap-1"},pt=r(()=>t("span",{class:"text-right text-xs opacity-50"},"セリフにキーワードを指定したい場合は、文字を[ ]で囲んでください。",-1)),dt={class:"contents"},rt=r(()=>t("span",{class:"popup_label"},"備考",-1)),vt={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(l,{emit:f}){const u=l,d=f,n=oe(),{characterList:a}=R(n),c=le(),{newChapter:v}=c,{chapterData:_}=R(c),{isDev:p,findData:x}=F(),e=I({}),$=V(()=>[{id:"UI",show:e.value.is_scene},{id:"BG",show:e.value.is_scene},{id:"BGM",show:e.value.is_scene},{id:"CG",show:e.value.is_perform},{id:"暗場",show:e.value.is_perform}]),b=[{id:"",title:"全"},{id:"前"},{id:"後"},{id:"續"}],w=V(()=>a.value.map(i=>({id:i.name,unknown:i.unknown,disabled:i.disabled})).filter(i=>!i.disabled||i.unknown)),U=()=>{e.value.show_time==="CG"&&e.value.show_name==="結束"||(e.value.show_name="")},O=()=>{const i={...e.value};if(u.id==="add")d("add",i);else{const C=x(_.value,u.id);Object.assign(C,i)}d("update:open",!1),(!i.is_showtime||i.show_time==="暗場")&&d("target",i.id)},G=i=>{const s=i.target.matches(".popup_window, .popup_window *"),C=i.target.matches(".popup_close");(!s||C)&&d("update:open",!1)};return T(()=>u.open,i=>{i&&(u.id==="add"?e.value=v(u.type):e.value={...x(_.value,u.id)},p&&console.log({...e.value}))}),(i,s)=>{const C=L("visible");return h((g(),y("div",{class:"popup",onClick:G},[t("section",ye,[t("header",we,[t("button",be,[m(S(ue),{class:"pointer-events-none"})])]),t("div",xe,[h(t("div",ke,[t("div",Se,[t("span",$e,D(e.value.人物),1),m(M,{class:"popup_select",value:e.value.show_time,"onUpdate:value":s[0]||(s[0]=o=>e.value.show_time=o),options:$.value,onChange:U},null,8,["value","options"])]),Ce,t("div",Ue,[Te,h(m(B,{class:"popup_input -col-3",value:e.value.show_name,"onUpdate:value":s[1]||(s[1]=o=>e.value.show_name=o)},null,8,["value"]),[[k,e.value.show_time!=="暗場"]]),h(m(M,{class:"popup_select -col-3",value:e.value.show_name,"onUpdate:value":s[2]||(s[2]=o=>e.value.show_name=o),options:b},null,8,["value"]),[[k,e.value.show_time==="暗場"]])])],512),[[k,e.value.is_showtime]]),h(t("div",Ee,[h(t("div",Ie,[Be,t("span",Me,D(e.value.人物),1)],512),[[k,e.value.is_announce||e.value.is_system]]),h(t("div",De,[Le,m(M,{class:"popup_select",value:e.value.人物,"onUpdate:value":s[3]||(s[3]=o=>e.value.人物=o),options:w.value},null,8,["value","options"])],512),[[k,!(e.value.is_announce||e.value.is_system)]]),t("div",Oe,[t("button",{class:E(["popup_switch text-replay",{"-active bg-replay":e.value.is_replay}]),onClick:s[4]||(s[4]=o=>e.value.is_replay=!e.value.is_replay),title:"再放送"},"再放送",2),t("button",{class:E(["popup_switch text-unknown",{"-active bg-unknown":e.value.is_unknown}]),onClick:s[5]||(s[5]=o=>e.value.is_unknown=!e.value.is_unknown),title:"未解明"},"未解明",2),t("button",{class:E(["popup_switch -monolog",{"-active":e.value.is_monolog}]),onClick:s[6]||(s[6]=o=>e.value.is_monolog=!e.value.is_monolog),title:"独り言"},"独り言",2)]),t("div",Ge,[Ve,t("div",He,[Ne,m(M,{class:"popup_select",value:e.value.立ち絵1,"onUpdate:value":s[7]||(s[7]=o=>e.value.立ち絵1=o)},{default:P(()=>[ze,(g(!0),y(N,null,z(w.value,o=>h((g(),y("option",{value:o.id},D(o.id),9,Pe)),[[k,!o.unknown]])),256))]),_:1},8,["value"])]),t("div",Re,[je,m(B,{class:"popup_input",value:e.value.十六夜差分,"onUpdate:value":s[8]||(s[8]=o=>e.value.十六夜差分=o)},null,8,["value"])]),t("div",Ae,[Fe,m(M,{class:"popup_select",value:e.value.主角特效,"onUpdate:value":s[9]||(s[9]=o=>e.value.主角特效=o)},{default:P(()=>[Ke]),_:1},8,["value"])])]),t("div",We,[qe,t("div",Je,[Qe,m(M,{class:"popup_select",value:e.value.顯示角色,"onUpdate:value":s[10]||(s[10]=o=>e.value.顯示角色=o)},{default:P(()=>[Xe,(g(!0),y(N,null,z(w.value,o=>h((g(),y("option",{value:o.id},D(o.id),9,Ye)),[[k,!o.unknown]])),256))]),_:1},8,["value"])]),t("div",Ze,[et,m(B,{class:"popup_input",value:e.value.角色差分,"onUpdate:value":s[11]||(s[11]=o=>e.value.角色差分=o)},null,8,["value"])]),t("div",tt,[st,m(B,{class:"popup_input",value:e.value.差分特效,"onUpdate:value":s[12]||(s[12]=o=>e.value.差分特效=o)},null,8,["value"])])]),t("div",ot,[lt,m(B,{class:"popup_input",value:e.value.SE,"onUpdate:value":s[13]||(s[13]=o=>e.value.SE=o)},null,8,["value"])]),t("div",at,[nt,m(B,{class:"popup_input",value:e.value.Voice,"onUpdate:value":s[14]||(s[14]=o=>e.value.Voice=o)},null,8,["value"])]),t("div",it,[ut,t("div",ct,[m(A,{class:"popup_input -textarea",value:e.value.和訳,"onUpdate:value":s[15]||(s[15]=o=>e.value.和訳=o)},null,8,["value"]),pt])])],512),[[k,!e.value.is_showtime]]),t("div",dt,[rt,m(A,{class:"popup_input -textarea -col-3",value:e.value.備註,"onUpdate:value":s[16]||(s[16]=o=>e.value.備註=o)},null,8,["value"])])]),t("footer",{class:"popup_footer"},[t("button",{class:"popup_submit",onClick:O,title:"保存"},"保存")])])])),[[C,l.open]])}}},bt=H(vt,[["__scopeId","data-v-d9aea555"]]),_t={class:"dialog_wrap"},ht=["data-content","innerHTML"],mt={__name:"Dialog",props:{value:{type:[String],default:""},type:{type:[String],default:""}},setup(l){W(p=>({"35896f63":S(a).lineHeight,"4d5ca058":S(a).letterSpace,"15be853d":S(a).fontLength,f66c4386:S(c).keyword.dark,"729921a5":S(c).monolog.dark,"0085a039":S(c).announce.dark}));const f=l,u=ie(),{fontFamily:d,fontWeight:n,fontStyle:a}=R(u),{colors:c}=q(),v=V(()=>{const p=new RegExp("((\\[.*?\\])|(\\[.+))","gs"),x=_("keyword"),$=f.value.replace(p,`<span class="${x}" data-content="$1">$1</span>`).replace(/\[|\]/g,"");return{value:f.value.replace(/\[|\]/g,""),html:$}}),_=p=>({keyword:"text-keyword stroke",monolog:"text-monolog stroke",announce:"text-announce stroke"})[p]??"text-white";return(p,x)=>(g(),y("div",{class:E(["dialog",[S(d).dialog,S(n).dialog]])},[t("div",_t,[t("pre",{class:E(_(l.type)),"data-content":v.value.value,innerHTML:v.value.html},null,10,ht)])],2))}},xt=H(mt,[["__scopeId","data-v-0b46230a"]]),ft=["src"],kt={__name:"Image",props:{src:{type:[String],default:""}},setup(l){const f=l,u=I(!0);return T(()=>f.src,d=>u.value=d,{immediate:!0}),(d,n)=>{const a=L("visible");return h((g(),y("img",{src:l.src,onError:n[0]||(n[0]=c=>u.value=!1),onLoad:n[1]||(n[1]=c=>u.value=!0)},null,40,ft)),[[a,u.value]])}}};export{xt as D,bt as E,wt as M,kt as _};
