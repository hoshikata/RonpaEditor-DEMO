import{o as w,c as R,a as t,_ as z,J as Oe,n as V,K as je,j as pe,s as H,u as be,b as he,B as $e,h as B,C as De,r as ee,L as He,i as ne,q as Me,w as E,d as e,e as u,t as _,v as W,y as L,F as se,m as fe,M as Se,N as ye,p as X,z as ge,A as Pe,O as Ne,g as Re,E as Te,I as Fe,H as We}from"./index-KCNCY3mu.js";import{I as ze,a as Le,D as qe}from"./IconDelete-D526KsXi.js";import{W as Je}from"./Wrap-df6E-SL-.js";import{C as ke}from"./Control-KF390FK2.js";import{C as Ue,I as Ke,u as Ge,M as Qe,E as Xe}from"./EditPopup-DEzCRSbl.js";import{M as Ye}from"./Mark-Cy4QBGJs.js";import{R as Ze,_ as we}from"./Radio-e9aoZtmB.js";import{S as Q,D as et}from"./Dialog-Cp7nHCzm.js";import{A as tt}from"./Avatar-DU3b8uOW.js";import"./round-drag-indicator-DyUHpdXD.js";/* empty css                                                             */import"./Image-qa4RBVjT.js";const st={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ot=t("path",{fill:"currentColor",d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"},null,-1),lt=[ot];function at(s,f){return w(),R("svg",st,[...lt])}const nt={name:"ic-round-close",render:at},it={__name:"Switch",props:{active:{type:[Boolean],default:!1}},setup(s){return(f,v)=>(w(),R("button",{class:V(["switch",{"bg-current":s.active}])},[t("span",{class:V(["-mt-0.1em",{"text-white":s.active}])},[Oe(f.$slots,"default",{},void 0,!0)],2)],2))}},ue=z(it,[["__scopeId","data-v-8bd1e4e9"]]),ct={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},rt=t("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1),ut=[rt];function dt(s,f){return w(),R("svg",ct,[...ut])}const de={name:"ic-round-search",render:dt},pt={name:"MaterialSymbolsFindReplaceRounded"},ht={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},_t=t("path",{fill:"currentColor",d:"M11 6q-1.575 0-2.838.863T6.35 9.125q-.15.375-.487.563t-.738.112t-.638-.387t-.112-.663q.675-2.1 2.475-3.425T11 4q1.475 0 2.763.562T16 6.1V5q0-.425.288-.712T17 4t.713.288T18 5v4q0 .425-.288.713T17 10h-4q-.425 0-.712-.288T12 9t.288-.712T13 8h2q-.725-.9-1.737-1.45T11 6m0 12q-1.475 0-2.762-.562T6 15.9V17q0 .425-.288.713T5 18t-.712-.288T4 17v-4q0-.425.288-.712T5 12h4q.425 0 .713.288T10 13t-.288.713T9 14H7q.725.9 1.738 1.45T11 16q1.55 0 2.788-.825T15.6 13q.175-.4.513-.638t.762-.162q.425.1.625.45t.075.75q-.175.5-.413.938t-.562.862l3.7 3.7q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-3.7-3.7q-.9.675-1.962 1.038T11 18"},null,-1),vt=[_t];function gt(s,f,v,$,x,k){return w(),R("svg",ht,vt)}const me=z(pt,[["render",gt]]),Ce=je("search",()=>{const s=pe(),{initSelected:f}=s,{chapterData:v}=H(s),$=be(),{getCharacter:x,getSprite:k}=$,{characterList:T}=H($),g=he(),{getShowList:b}=g,{effectList:q,seList:r}=H(g),{copyObject:o,findData:S}=$e(),I=B(()=>{let a=v.value;const{type:n,result:h}=Y.value;return n===0&&(a=ie(h)),n===1&&(a=te(h)),n===2&&(a=F(h)),a}),P=B(()=>I.value.map(a=>a.id)),D=De({type:0,keyword:{value:"",rep:""},show:{parent:"",child:"",rep:""},items:[{parent:"",child:""}],itemsRep:{parent:"",child:"",rep:""},open:!1}),Y=ee({}),oe=B(()=>{const a=[];return T.value.forEach(n=>{const h=(n.sprite??[]).map(l=>({id:n.id+"_"+l.id,name:n.name+"："+l.name}));a.push(...h)}),a}),y=a=>{let n=[];const h=["speaker","char_1","char_2"].includes(a),l=["char_1_sprite","char_2_sprite"].includes(a),c=["char_1_effect","char_2_effect"].includes(a);return h&&(n=T.value),l&&(n=oe.value),c&&(n=q.value),a==="se"&&(n=r.value),n},p=()=>{D.keyword={value:"",rep:""},D.show={parent:"",child:"",rep:""},D.items=[{parent:"",child:""}],D.itemsRep={parent:"",child:"",value:""},D.type=0,d()},U=()=>{const{type:a,keyword:n,show:h,items:l,itemsRep:c}=D;let i={};return a===0&&(i={result:n.value,rep:n.rep}),a===1&&(i={result:o(h),rep:h.rep}),a===2&&(i={result:o(l),rep:o(c)}),{type:a,...i}},d=()=>{Y.value=U(),f(v.value),D.open=!1},N=()=>{const a=U();a.value=a;const{type:n,result:h,rep:l}=a;n===0&&ce(h,l),n===1&&_e(h,l),n===2&&re(h,l),f(v.value),p(),D.open=!1};He(d);const A=(a,n)=>{const h=b(a)??[],l=S(h,n);return h.length?n!==""&&!l:n!==""},Z=(a,n)=>{const h=y(a)??[],l=S(h,n);return h.length?n!==""&&!l:n!==""},le=(a,n)=>{const h={char_1_sprite:"char_1",char_2_sprite:"char_2"},l=a[h[n]],c=a[n],i=x(l).sprite??[],C=k(l,c),m=i.length?c!==""&&C.id===void 0:c!=="";return{name:h[n],group:l,value:c,isErr:m}},J=a=>a.some(n=>!(n.parent===""&&n.child==="")),ae=a=>{let[n,h]=a.split("_");return[n*1,h*1]},K=(a,n,h,l)=>a===""?n:a==="err"?h:l,ie=a=>(a=a??"",a===""?v.value:v.value.filter(n=>n.content.match(a))),te=({parent:a,child:n})=>a===""&&n===""?v.value:v.value.filter(h=>{const{is_showtime:l,show_time:c,show_name:i}=h;if(!l||!(a===""?!0:c===a))return!1;const m=A(c,i);return K(n,!0,m,i===n)}),F=a=>J(a)?v.value.filter(h=>h.is_showtime?!1:a.every(l=>{const{parent:c,child:i}=l;if(["char_1_sprite","char_2_sprite"].includes(c)){const[m,M]=ae(i),{group:O,value:G,isErr:ve}=le(h,c);return K(i,G!=="",ve,O===m&&G===M)}else{const m=h[c],M=Z(c,m);return K(i,m!=="",M,m===i)}})):v.value,ce=(a,n)=>{a=a??"",a!==""&&P.value.forEach(h=>{const l=S(v.value,h);l.content=l.content.replace(a,n)})},_e=({parent:a,child:n},h)=>{if(a===""&&n==="")return v.value;P.value.forEach(l=>{const c=S(v.value,l),{is_showtime:i,show_time:C,show_name:m}=c;if(!i)return;const M=A(C,m);K(n,!0,M,C===a&&m===n)&&(c.show_name=h)})},re=(a,{parent:n,child:h,rep:l})=>{J(a)&&P.value.forEach(i=>{const C=S(v.value,i);if(C.is_showtime)return;if(["char_1_sprite","char_2_sprite"].includes(n)){const[M,O]=ae(h),[G,ve]=ae(l),{name:xe,group:Be,value:Ie,isErr:Ae}=le(C,n);K(h,Ie!=="",Ae,Be===M&&Ie===O)&&(C[xe]=G,C[n]=ve)}else{const M=C[n],O=Z(n,M);K(h,M!=="",O,M===h)&&(C[n]=l)}})};return{chapterFilter:I,search:D,searchResult:Y,getSpriteEmpty:J,getChildOptions:y,initSearch:p,submitSearch:d,submitReplace:N,keywordSearch:ie,showSearch:te,itemsSearch:F}}),Ve=s=>(Se("data-v-029af3c5"),s=s(),ye(),s),mt={class:"popup_window"},ft={class:"popup_container scrollbar"},wt={class:"mb-8 flex justify-center"},bt={class:"popup_keyword_group"},$t=Ve(()=>t("span",null,null,-1)),St=["disabled","title"],yt=["disabled","title"],kt={class:"popup_show_group"},Ct=Ve(()=>t("span",null,null,-1)),xt={value:""},It={value:""},Rt={class:"-error",value:"err"},Tt=["disabled","title"],Lt={value:""},qt={class:"-error",value:"err"},Et={class:"col-span-2"},Dt=["disabled","title"],Mt={class:"contents"},Ut={class:"popup_items_group"},Vt={class:"popup_search_group"},Bt=["title"],At={value:""},Ot={value:""},jt=["onClick","title"],Ht={class:"popup_search"},Pt=["disabled","title"],Nt={class:"popup_replace"},Ft={value:""},Wt={value:""},zt={value:""},Jt=["disabled","title"],Kt={class:"popup_footer"},Gt=["title"],Qt={__name:"Search",emits:["goTop"],setup(s,{emit:f}){const v=he(),{getShowList:$}=v,x=Ce(),{getSpriteEmpty:k,getChildOptions:T,initSearch:g,submitSearch:b,submitReplace:q}=x,{search:r}=H(x),{t:o}=ne("lang"),S=B(()=>k(r.value.items)),I=B(()=>[{id:"ui",title:o("showtime.ui")},{id:"bg",title:o("showtime.bg")},{id:"bgm",title:o("showtime.bgm")},{id:"cg",title:o("showtime.cg")},{id:"black",title:o("showtime.black")}]),P=B(()=>[{id:"speaker",title:o("data.speaker")},{id:"char_1",title:o("data.char_1")},{id:"char_1_sprite",title:o("data.char_1_sprite")},{id:"char_1_effect",title:o("data.char_1_effect")},{id:"char_2",title:o("data.char_2")},{id:"char_2_sprite",title:o("data.char_2_sprite")},{id:"char_2_effect",title:o("data.char_2_effect")},{id:"se",title:o("data.se")},{id:"voice",title:o("data.voice")}]),D=()=>r.value.items.push({parent:"",child:""}),Y=y=>r.value.items.splice(y,1),oe=y=>{const p=y.target.matches(".popup_window, .popup_window *"),U=y.target.matches(".popup_close");!y.target.matches(".popup_remove")&&(!p||U)&&(r.value.open=!1)};return(y,p)=>{const U=Me("visible");return E((w(),R("section",{class:"popup",onClick:oe},[t("div",mt,[t("div",ft,[t("div",wt,[u(Ze,{class:"popup_radio",value:e(r).type,"onUpdate:value":p[0]||(p[0]=d=>e(r).type=d),list:[{id:0,title:e(o)("edit.serif")},{id:1,title:e(o)("showtime.scene")+"＆"+e(o)("showtime.perform")},{id:2,title:e(o)("search.item")}],name:"type"},null,8,["value","list"])]),E(t("div",bt,[$t,u(we,{class:"popup_input col-span-2",value:e(r).keyword.value,"onUpdate:value":p[1]||(p[1]=d=>e(r).keyword.value=d),placeholder:e(o)("search.keyword")},null,8,["value","placeholder"]),t("button",{class:"popup_submit",onClick:p[2]||(p[2]=(...d)=>e(b)&&e(b)(...d)),disabled:e(r).keyword.value==="",title:e(o)("search.search")},[u(e(de))],8,St),t("span",null,_(e(o)("search.replace-from")),1),u(we,{class:"popup_input",value:e(r).keyword.rep,"onUpdate:value":p[3]||(p[3]=d=>e(r).keyword.rep=d)},null,8,["value"]),t("span",null,_(e(o)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:p[4]||(p[4]=(...d)=>e(q)&&e(q)(...d)),disabled:e(r).keyword.value==="",title:e(o)("search.replace")},[u(me,{class:"text-[1.2em]"})],8,yt)],512),[[W,e(r).type===0]]),E(t("div",kt,[Ct,u(Q,{class:"popup_select",value:e(r).show.parent,"onUpdate:value":p[5]||(p[5]=d=>e(r).show.parent=d),options:I.value,onChange:p[6]||(p[6]=d=>{e(r).show.child="",e(r).show.rep=""})},{default:L(()=>[t("option",xt,_(e(o)("search.all")),1)]),_:1},8,["value","options"]),t("span",null,_(e(o)("search.is")),1),u(Q,{class:"popup_select",value:e(r).show.child,"onUpdate:value":p[7]||(p[7]=d=>e(r).show.child=d),options:e($)(e(r).show.parent)},{default:L(()=>[t("option",It,_(e(o)("search.all")),1),t("option",Rt,_(e(o)("search.err")),1)]),_:1},8,["value","options"]),t("button",{class:"popup_submit",onClick:p[8]||(p[8]=(...d)=>e(b)&&e(b)(...d)),disabled:e(r).show.parent===""&&e(r).show.child==="",title:e(o)("search.search")},[u(e(de))],8,Tt),t("span",null,_(e(o)("search.replace-from")),1),u(Q,{class:"popup_select",value:e(r).show.rep,"onUpdate:value":p[9]||(p[9]=d=>e(r).show.rep=d),options:e($)(e(r).show.parent)},{default:L(()=>[t("option",Lt,_(e(o)("search.all")),1),t("option",qt,_(e(o)("search.err")),1)]),_:1},8,["value","options"]),t("span",Et,_(e(o)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:p[10]||(p[10]=(...d)=>e(q)&&e(q)(...d)),disabled:e(r).show.rep==="",title:e(o)("search.replace")},[u(me,{class:"text-[1.2em]"})],8,Dt)],512),[[W,e(r).type===1]]),E(t("div",Mt,[t("div",Ut,[(w(!0),R(se,null,fe(e(r).items,(d,N)=>(w(),R("div",Vt,[E(t("button",{class:"popup_submit",onClick:D,title:e(o)("search.add")},_(e(o)("search.add")),9,Bt),[[W,!N]]),E(t("span",{class:"text-right"},_(e(o)("search.and")),513),[[W,N]]),u(Q,{class:"popup_select",value:d.parent,"onUpdate:value":A=>d.parent=A,options:P.value,onChange:A=>d.child=""},{default:L(()=>[t("option",At,_(e(o)("search.all")),1)]),_:2},1032,["value","onUpdate:value","options","onChange"]),t("span",null,_(e(o)("search.is")),1),u(Q,{class:"popup_select",value:d.child,"onUpdate:value":A=>d.child=A,options:e(T)(d.parent)},{default:L(()=>[t("option",Ot,_(e(o)("search.all")),1),E(t("option",{class:"-error",value:"err"},_(e(o)("search.err")),513),[[W,d.parent!==""]])]),_:2},1032,["value","onUpdate:value","options"]),E((w(),R("button",{class:"popup_remove",onClick:A=>Y(N),title:e(o)("button.del")},[u(e(nt))],8,jt)),[[U,N]])]))),256)),t("div",Ht,[t("button",{class:"popup_submit",onClick:p[11]||(p[11]=(...d)=>e(b)&&e(b)(...d)),disabled:!S.value,title:e(o)("search.search")},[u(e(de))],8,Pt)])]),t("div",Nt,[u(Q,{class:"popup_select",value:e(r).itemsRep.parent,"onUpdate:value":p[12]||(p[12]=d=>e(r).itemsRep.parent=d),options:P.value,onChange:p[13]||(p[13]=d=>{e(r).itemsRep.child="",e(r).itemsRep.rep=""})},{default:L(()=>[t("option",Ft,_(e(o)("search.all")),1)]),_:1},8,["value","options"]),t("span",null,_(e(o)("search.is")),1),u(Q,{class:"popup_select",value:e(r).itemsRep.child,"onUpdate:value":p[14]||(p[14]=d=>e(r).itemsRep.child=d),options:e(T)(e(r).itemsRep.parent)},{default:L(()=>[t("option",Wt,_(e(o)("search.all")),1),E(t("option",{class:"-error",value:"err"},_(e(o)("search.err")),513),[[W,e(r).itemsRep.parent!==""]])]),_:1},8,["value","options"]),t("span",null,_(e(o)("search.replace-from")),1),u(Q,{class:"popup_select",value:e(r).itemsRep.rep,"onUpdate:value":p[15]||(p[15]=d=>e(r).itemsRep.rep=d),options:e(T)(e(r).itemsRep.parent)},{default:L(()=>[t("option",zt,_(e(o)("edit.name")),1)]),_:1},8,["value","options"]),t("span",null,_(e(o)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:p[16]||(p[16]=(...d)=>e(q)&&e(q)(...d)),disabled:e(r).itemsRep.parent===""&&e(r).itemsRep.child===""||e(r).itemsRep.rep==="",title:e(o)("search.replace")},[u(me,{class:"text-[1.2em]"})],8,Jt)])],512),[[W,e(r).type===2]])]),t("footer",Kt,[t("button",{class:"popup_submit -cancel",onClick:p[17]||(p[17]=(...d)=>e(g)&&e(g)(...d)),title:e(o)("search.cancel")},_(e(o)("search.cancel")),9,Gt)])])])),[[U,e(r).open]])}}},Xt=z(Qt,[["__scopeId","data-v-029af3c5"]]),Yt={name:"MaterialSymbolsArrowWarmUpRounded"},Zt={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},es=t("path",{fill:"currentColor",d:"M12 13q-.425 0-.712-.288T11 12V5.825L7.1 9.7q-.275.275-.687.288T5.7 9.7q-.275-.275-.275-.7t.275-.7l5.6-5.6q.15-.15.325-.212T12 2.425t.375.063t.325.212l5.6 5.6q.275.275.275.688T18.3 9.7q-.3.3-.712.3t-.713-.3L13 5.825V12q0 .425-.288.713T12 13m0 5q-.425 0-.712-.288T11 17v-1q0-.425.288-.712T12 15t.713.288T13 16v1q0 .425-.288.713T12 18m0 4q-.425 0-.712-.288T11 21t.288-.712T12 20t.713.288T13 21t-.288.713T12 22"},null,-1),ts=[es];function ss(s,f,v,$,x,k){return w(),R("svg",Zt,ts)}const Ee=z(Yt,[["render",ss]]),os={class:"chapter_head"},ls=["title"],as=["disabled","title"],ns=["disabled","title"],is=["title"],cs={__name:"Head",setup(s){const f=pe(),{deleteChapter:v,moveChapter:$}=f,{chapterIndex:x,chapterLength:k,chapterTarget:T}=H(f),g=Ce(),{search:b,searchResult:q}=H(g),{t:r}=ne("lang");return(o,S)=>(w(),R("header",os,[u(we,{class:"chapter_head_title",value:e(T).title,"onUpdate:value":S[0]||(S[0]=I=>e(T).title=I),placeholder:e(r)("edit.title-input")},null,8,["value","placeholder"]),t("button",{class:V(["chapter_head_button",{"-active":e(q).result}]),onClick:S[1]||(S[1]=I=>e(b).open=!0),title:e(r)("search.search")},[u(e(de),{class:"!text-xl"})],10,ls),t("button",{class:"chapter_head_button",onClick:S[2]||(S[2]=I=>e($)(-1)),disabled:!e(x),title:e(r)("button.up")},[u(Ee)],8,as),t("button",{class:"chapter_head_button",onClick:S[3]||(S[3]=I=>e($)(1)),disabled:!e(k)||e(x)===e(k)-1,title:e(r)("button.down")},[u(Ee,{class:"-scale-y-100"})],8,ns),t("button",{class:"chapter_head_button",onClick:S[4]||(S[4]=(...I)=>e(v)&&e(v)(...I)),title:e(r)("button.del")},[u(ze)],8,is)]))}},rs=z(cs,[["__scopeId","data-v-88d7b690"]]),us={__name:"Inner",props:{value:{type:[Number,String],default:void 0},list:{type:[Array,Boolean],default:!1},type:{type:[String],default:""}},setup(s){const f=s,{findData:v}=$e(),$=B(()=>v(f.list||[],f.value)),x=B(()=>f.list===!1?!1:f.value!==""&&!$.value),k=B(()=>({"-showtime":f.type==="showtime","!bg-red-500/50":x.value}));return(T,g)=>{var b;return w(),R("div",{class:V(["inner",k.value])},_(((b=$.value)==null?void 0:b.name)??s.value),3)}}},j=z(us,[["__scopeId","data-v-8cdb2df2"]]),ds=s=>(Se("data-v-569f67ca"),s=s(),ye(),s),ps={class:"chapter log_scene"},hs=ds(()=>t("div",{class:"chapter log_switches xl:!hidden"},null,-1)),_s={__name:"logShowHead",props:{log:{type:[Object],default:()=>({})}},emits:["more"],setup(s,{emit:f}){const v=f,$=he(),{getShowList:x}=$,{t:k}=ne("lang");return(T,g)=>(w(),R(se,null,[t("div",{class:V(["chapter log_td -first",{"bg-secondary/60":s.log.is_selected}])},[u(Ue,{class:"chapter log_check",value:s.log.is_selected,"onUpdate:value":g[0]||(g[0]=b=>s.log.is_selected=b)},null,8,["value"]),u(ke,{class:"chapter log_control",onMore:g[1]||(g[1]=b=>v("more",b)),hasDel:!1,hasAdd:!1}),t("div",ps,[t("span",null,_(e(k)(`showtime.${s.log.speaker}`)),1),t("span",null,_(e(k)(`showtime.${s.log.show_time}`)??s.log.show_time),1),u(j,{value:s.log.show_name,list:e(x)(s.log.show_time),type:"showtime"},null,8,["value","list"])])],2),hs],64))}},vs=z(_s,[["__scopeId","data-v-569f67ca"]]),gs={class:"chapter log_tr_2"},ms=t("div",{class:"chapter log_td -col"},null,-1),fs=t("div",{class:"chapter log_td -col"},null,-1),ws=t("div",{class:"chapter log_td -col"},null,-1),bs={class:"chapter log_td -col"},$s={__name:"logShowBody",props:{log:{type:[Object],default:()=>({})}},setup(s){return(f,v)=>(w(),R("div",gs,[ms,fs,ws,t("div",bs,[u(j,{value:s.log.remark},null,8,["value"])])]))}},Ss=["title"],ys={class:"chapter log_comment"},ks={class:"chapter log_switches"},Cs={__name:"logCommentHead",props:{log:{type:[Object],default:()=>({})}},emits:["more","target"],setup(s,{emit:f}){const v=s,$=f,x=be(),{getCharacter:k}=x,T=pe(),{dialogType:g}=T,{t:b}=ne("lang"),q=B(()=>k(v.log.speaker));return(r,o)=>{const S=Me("visible");return w(),R(se,null,[t("div",{class:V(["chapter log_td -first",{"bg-secondary/60":s.log.is_selected}])},[u(Ue,{class:"chapter log_check",value:s.log.is_selected,"onUpdate:value":o[0]||(o[0]=I=>s.log.is_selected=I)},null,8,["value"]),u(ke,{class:"chapter log_control",onMore:o[2]||(o[2]=I=>$("more",I)),onDel:o[3]||(o[3]=I=>s.log.is_delete=!0),hasAdd:!1},{top:L(()=>[t("button",{class:"control_button",onClick:o[1]||(o[1]=I=>$("target")),title:e(b)("button.target-chapter")},[u(Ke,{class:"text-xl"})],8,Ss)]),_:1}),t("div",{class:V(["chapter log_info",{"flex-row-reverse":q.value.is_hero,"-replay":s.log.is_replay}])},[u(tt,{class:"chapter log_avatar",name:q.value.name??s.log.speaker},null,8,["name"]),t("div",ys,[u(et,{class:"chapter log_dialog",value:s.log.content,type:e(g)(s.log)},null,8,["value","type"])])],2)],2),t("div",ks,[E((w(),X(ue,{class:V(["chapter log_switch",{"text-replay":s.log.is_replay}]),active:s.log.is_replay,title:e(b)("data.replay")},{default:L(()=>[ge("R")]),_:1},8,["active","class","title"])),[[S,s.log.is_replay]]),E((w(),X(ue,{class:V(["chapter log_switch",{"text-unknown":s.log.is_unknown}]),active:s.log.is_unknown,title:e(b)("data.unknown")},{default:L(()=>[ge("U")]),_:1},8,["active","class","title"])),[[S,s.log.is_unknown]]),E((w(),X(ue,{class:V(["chapter log_switch",{"-monolog":s.log.is_monolog}]),active:s.log.is_monolog,title:e(b)("data.monolog")},{default:L(()=>[ge("S")]),_:1},8,["active","class","title"])),[[S,s.log.is_monolog]])])],64)}}},xs=z(Cs,[["__scopeId","data-v-620df50d"]]),Is={class:"chapter log_tr_2"},Rs={class:"chapter log_td -col"},Ts={class:"chapter log_td -col"},Ls={class:"chapter log_td -col"},qs={class:"chapter log_td -col"},Es={__name:"logCommentBody",props:{log:{type:[Object],default:()=>({})}},setup(s){const f=be(),{getCharacter:v}=f,{characterList:$}=H(f),x=he(),{effectList:k,seList:T,voiceList:g}=H(x);return(b,q)=>(w(),R("div",Is,[t("div",Rs,[u(j,{class:"col-span-2",value:s.log.char_1,list:e($)},null,8,["value","list"]),u(j,{value:s.log.char_1_sprite,list:e(v)(s.log.char_1).sprite},null,8,["value","list"]),u(j,{value:s.log.char_1_effect,list:e(k)},null,8,["value","list"])]),t("div",Ts,[u(j,{class:"col-span-2",value:s.log.char_2,list:e($)},null,8,["value","list"]),u(j,{value:s.log.char_2_sprite,list:e(v)(s.log.char_2).sprite},null,8,["value","list"]),u(j,{value:s.log.char_2_effect,list:e(k)},null,8,["value","list"])]),t("div",Ls,[u(j,{value:s.log.se,list:e(T)},null,8,["value","list"]),u(j,{value:s.log.voice,list:e(g)},null,8,["value","list"])]),t("div",qs,[u(j,{value:s.log.remark},null,8,["value"])])]))}},Ds=s=>(Se("data-v-64bac1d1"),s=s(),ye(),s),Ms=["title"],Us={class:"side_list"},Vs={class:"flex"},Bs=["onClick","title"],As={class:"chapter log"},Os={class:"chapter log_tr -lock"},js={class:"mx-1 w-14 self-center"},Hs={class:"chapter log_th xl:ml-0"},Ps=Ds(()=>t("div",{class:"ml-3 w-7 shrink-0 xl:hidden"},null,-1)),Ns={class:"chapter log_tr_2 -lock"},Fs={class:"chapter log_th -col"},Ws={class:"chapter log_th -col"},zs={class:"chapter log_th -col"},Js={class:"chapter log_th -col"},Ks={class:"contents"},Gs=["onDragstart","onDragend"],Qs={__name:"index",setup(s){const f=Pe(),v=Ne(),$=pe(),{newChapter:x}=$,{chapterIndex:k,chapterNames:T,chapterData:g}=H($),b=Ge(),{newLogId:q}=b,{logId:r}=H(b),o=Ce(),{chapterFilter:S}=H(o),{findData:I,findIndex:P,getClientRect:D}=$e(),{dragMove:Y,dropMove:oe}=Fe(),{t:y}=ne("lang"),p=B(()=>g.value.some(l=>l.dragging)),U=B(()=>g.value.filter(l=>l.is_selected&&!l.is_delete).map(l=>l.id)),d=(l,c,i)=>{const C=I(g.value,c),m=g.value.indexOf(C);i&&Y(l,{index:m}),U.value.some(O=>O===c)||(C.is_selected=1),U.value.forEach(O=>{const G=I(g.value,O);G.dragging=i,i||(G.is_selected=0)})},N=(l,c)=>{const i=c===null?0:P(g.value,c)+1;U.value.forEach(C=>{const m=P(g.value,C);oe(g.value,m,i)})},A=ee(!1),Z=ee(0),le=ee(null),J=(l,c)=>{const i=P(g.value,c);Z.value=c!==void 0&&i===-1?null:i,le.value=l,A.value=c===null},ae=({type:l})=>{const c=Z.value,i=g.value[c];l==="delete"?ie(i):l==="edit"?ce(i.id,{}):l==="copy"?K(i,c+1):ce("add",{type:l})},K=(l,c)=>{g.value.splice(c+1,0,{...l,id:q()})},ie=l=>{l.is_delete=!0,U.value.forEach(c=>c.is_delete=!0)},te=ee(!1),F=De({id:0,type:"",index:0}),ce=(l,{type:c})=>{F.id=l,F.type=c??"",F.index=Z.value,te.value=!0},_e=l=>{const c=Z.value===null?g.value.length:F.index+1;g.value.splice(c,0,l)},re=ee(null),a=ee({}),n=()=>{We(()=>{const l=a.value[r.value];if(!l)return;const{height:c,top:i}=D(l);re.value.mainScroll({top:i-c*2,left:0})})},h=l=>{r.value=l,v.push({name:"Preview"})};return Re(k,n),Re(()=>f.name,l=>{l==="Chapters"&&n()}),(l,c)=>(w(),X(Je,{ref_key:"wrap",ref:re},{side_foot:L(()=>[t("button",{class:"chapter_add",onClick:c[0]||(c[0]=(...i)=>e(x)&&e(x)(...i)),title:e(y)("button.new")},[u(e(Le))],8,Ms)]),side:L(()=>[t("ul",Us,[(w(!0),R(se,null,fe(e(T),(i,C)=>(w(),R("li",Vs,[u(Ye,{class:"chapter_mark",active:C===e(k)},null,8,["active"]),t("button",{class:V(["side_item",{"side_item-active":C===e(k)}]),onClick:m=>k.value=C,title:i},_(i),11,Bs)]))),256))])]),main_head:L(()=>[u(rs)]),default:L(()=>[t("div",As,[t("div",Os,[t("div",js,[u(ue,{class:"chapter_plus",title:e(y)("button.new")},{default:L(()=>[u(e(Le),{class:"mt-0.1em"}),u(ke,{class:"absolute left-0 top-0 opacity-0",onMore:c[1]||(c[1]=i=>J(i,null)),hasDel:!1,hasAdd:!1})]),_:1},8,["title"])]),t("div",Hs,_(e(y)("edit.serif"))+"＆"+_(e(y)("showtime.scene"))+"＆"+_(e(y)("showtime.perform")),1),Ps]),t("div",Ns,[t("div",Fs,_(e(y)("data.char_1"))+"．"+_(e(y)("edit.sprite-ign"))+"＆"+_(e(y)("edit.effect")),1),t("div",Ws,_(e(y)("data.char_2"))+"．"+_(e(y)("edit.sprite-ign"))+"＆"+_(e(y)("edit.effect")),1),t("div",zs,_(e(y)("data.se"))+"＆"+_(e(y)("data.voice")),1),t("div",Js,_(e(y)("data.remark")),1)]),u(qe,{class:"chapter log_dragline",onDrop:c[2]||(c[2]=i=>N(i,null)),dragging:p.value},null,8,["dragging"]),(w(!0),R(se,null,fe(e(S),(i,C)=>(w(),R(se,{key:i.id},[E(t("section",Ks,[t("div",{class:V(["chapter log_tr",{"-dragging":i.dragging}]),draggable:!0,onDragstart:m=>d(m,i.id,!0),onDragend:m=>d(m,i.id,!1),onDrag:c[3]||(c[3]=Te(()=>{},["prevent"])),onDrop:c[4]||(c[4]=Te(()=>{},["prevent"])),ref_for:!0,ref:m=>a.value[i.id]=m},[i.is_showtime?(w(),X(vs,{key:0,log:i,onMore:m=>J(m,i.id)},null,8,["log","onMore"])):(w(),X(xs,{key:1,log:i,onMore:m=>J(m,i.id),onTarget:m=>h(i.id)},null,8,["log","onMore","onTarget"]))],42,Gs),i.is_showtime?(w(),X($s,{key:0,log:i},null,8,["log"])):(w(),X(Es,{key:1,log:i},null,8,["log"]))],512),[[W,!i.is_delete]]),E(u(qe,{class:"chapter log_dragline",onDrop:m=>N(m,i.id),dragging:p.value},null,8,["onDrop","dragging"]),[[W,!i.is_delete]])],64))),128))]),u(Qe,{positions:le.value,onClear:J,onUse:ae,onlyAdd:A.value},null,8,["positions","onlyAdd"]),u(Xt),u(Xe,{open:te.value,"onUpdate:open":c[5]||(c[5]=i=>te.value=i),id:F.id,type:F.type,onAdd:_e},null,8,["open","id","type"])]),_:1},512))}},po=z(Qs,[["__scopeId","data-v-64bac1d1"]]);export{po as default};
