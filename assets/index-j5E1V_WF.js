import{o as b,c as T,a as t,_ as G,J as Oe,n as H,K as je,j as _e,s as A,u as ve,b as ge,y as ke,h as P,C as Me,r as se,L as He,i as ue,q as Ue,w as V,d as e,e as i,t as _,v as K,z as D,F as le,m as $e,M as Ce,N as xe,p as Y,A as be,B as Pe,O as Ne,g as Re,E as Le,I as Fe,H as We}from"./index-BGI2Hdby.js";import{I as ze,a as qe,D as Ee}from"./IconDelete-CVM0x2iG.js";import{W as Je}from"./Wrap-D-W0Y8gH.js";import{C as Ie}from"./Control-D6Gdu5yd.js";import{C as Ve,I as Ke,u as Ge,M as Qe,E as Xe}from"./EditPopup-4yOC-anJ.js";import{M as Ye}from"./Mark-DYxc2You.js";import{R as Ze,_ as ye}from"./Radio-BGE2Xa8a.js";import{S as X,D as et}from"./Dialog-5VYCdWEj.js";import{A as tt}from"./Avatar-oyQk526U.js";import"./round-drag-indicator-DK4ZQg3Q.js";/* empty css                                                             */import"./Image-1cvsMD91.js";const st={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ot=t("path",{fill:"currentColor",d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"},null,-1),at=[ot];function lt(s,f){return b(),T("svg",st,[...at])}const nt={name:"ic-round-close",render:lt},it={__name:"Switch",props:{active:{type:[Boolean],default:!1}},setup(s){return(f,m)=>(b(),T("button",{class:H(["switch",{"bg-current":s.active}])},[t("span",{class:H(["-mt-0.1em",{"text-white":s.active}])},[Oe(f.$slots,"default",{},void 0,!0)],2)],2))}},pe=G(it,[["__scopeId","data-v-8bd1e4e9"]]),ct={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},rt=t("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1),ut=[rt];function dt(s,f){return b(),T("svg",ct,[...ut])}const he={name:"ic-round-search",render:dt},pt={name:"MaterialSymbolsFindReplaceRounded"},ht={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},_t=t("path",{fill:"currentColor",d:"M11 6q-1.575 0-2.838.863T6.35 9.125q-.15.375-.487.563t-.738.112t-.638-.387t-.112-.663q.675-2.1 2.475-3.425T11 4q1.475 0 2.763.562T16 6.1V5q0-.425.288-.712T17 4t.713.288T18 5v4q0 .425-.288.713T17 10h-4q-.425 0-.712-.288T12 9t.288-.712T13 8h2q-.725-.9-1.737-1.45T11 6m0 12q-1.475 0-2.762-.562T6 15.9V17q0 .425-.288.713T5 18t-.712-.288T4 17v-4q0-.425.288-.712T5 12h4q.425 0 .713.288T10 13t-.288.713T9 14H7q.725.9 1.738 1.45T11 16q1.55 0 2.788-.825T15.6 13q.175-.4.513-.638t.762-.162q.425.1.625.45t.075.75q-.175.5-.413.938t-.562.862l3.7 3.7q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-3.7-3.7q-.9.675-1.962 1.038T11 18"},null,-1),vt=[_t];function gt(s,f,m,$,R,L){return b(),T("svg",ht,vt)}const Se=G(pt,[["render",gt]]),Te=je("search",()=>{const s=_e(),{initSelected:f}=s,{chapterData:m}=A(s),$=ve(),{getCharacter:R,getSprite:L}=$,{characterList:B}=A($),y=ge(),{getShowList:k}=y,{effectList:W,seList:J}=A(y),{copyObject:v,findData:I}=ke(),w=P(()=>{let o=m.value;const{type:a,result:h}=n.value;return a===0&&(o=ne(h)),a===1&&(o=te(h)),a===2&&(o=de(h)),o}),l=P(()=>w.value.map(o=>o.id)),O=Me({type:0,keyword:{value:"",rep:""},show:{parent:"",child:"",rep:""},items:[{parent:"",child:""}],itemsRep:{parent:"",child:"",rep:""},open:!1}),n=se({}),oe=P(()=>{const o=[];return B.value.forEach(a=>{const h=(a.sprite??[]).map(g=>({id:a.id+"_"+g.id,name:a.name+"："+g.name}));o.push(...h)}),o}),Q=o=>{let a=[];const h=["speaker","char_1","char_2"].includes(o),g=["char_1_sprite","char_2_sprite"].includes(o),S=["char_1_effect","char_2_effect"].includes(o);return h&&(a=B.value),g&&(a=oe.value),S&&(a=W.value),o==="se"&&(a=J.value),a},Z=()=>{O.keyword={value:"",rep:""},O.show={parent:"",child:"",rep:""},O.items=[{parent:"",child:""}],O.itemsRep={parent:"",child:"",value:""},O.type=0,ee()},ae=()=>{const{type:o,keyword:a,show:h,items:g,itemsRep:S}=O;let C={};return o===0&&(C={result:a.value,rep:a.rep}),o===1&&(C={result:v(h),rep:h.rep}),o===2&&(C={result:v(g),rep:v(S)}),{type:o,...C}},ee=()=>{n.value=ae(),f(m.value),O.open=!1},q=()=>{const o=ae();o.value=o;const{type:a,result:h,rep:g}=o;a===0&&me(h,g),a===1&&fe(h,g),a===2&&ie(h,g),f(m.value),Z(),O.open=!1};He(ee);const j=(o,a)=>{const h=k(o)??[],g=I(h,a);return h.length?a!==""&&!g:a!==""},d=(o,a)=>{const h=Q(o)??[],g=I(h,a);return h.length?a!==""&&!g:a!==""},z=(o,a)=>{const h={char_1_sprite:"char_1",char_2_sprite:"char_2"},g=o[h[a]],S=o[a],C=R(g).sprite??[],M=L(g,S),p=C.length?S!==""&&M.id===void 0:S!=="";return{name:h[a],group:g,value:S,isErr:p}},r=o=>o.some(a=>!(a.parent===""&&a.child==="")),N=o=>{let[a,h]=o.split("_");return[a*1,h*1]},E=(o,a,h,g)=>o===""?a:o==="err"?h:g,ne=o=>(o=o??"",o===""?m.value:m.value.filter(a=>a.content.match(o))),te=({parent:o,child:a})=>o===""&&a===""?m.value:m.value.filter(h=>{const{is_showtime:g,show_time:S,show_name:C}=h;if(!g||!(o===""?!0:S===o))return!1;const p=j(S,C);return E(a,!0,p,C===a)}),de=o=>r(o)?m.value.filter(h=>h.is_showtime?!1:o.every(g=>{const{parent:S,child:C}=g;if(["char_1_sprite","char_2_sprite"].includes(S)){const[p,u]=N(C),{group:c,value:U,isErr:x}=z(h,S);return E(C,U!=="",x,c===p&&U===u)}else{const p=h[S],u=d(S,p);return E(C,p!=="",u,p===C)}})):m.value,me=(o,a)=>{o=o??"",o!==""&&l.value.forEach(h=>{const g=I(m.value,h);g.content=g.content.replace(o,a)})},fe=({parent:o,child:a},h)=>{if(o===""&&a==="")return m.value;l.value.forEach(g=>{const S=I(m.value,g),{is_showtime:C,show_time:M,show_name:p}=S;if(!C)return;const u=j(M,p);E(a,!0,u,M===o&&p===a)&&(S.show_name=h)})},ie=(o,{parent:a,child:h,rep:g})=>{r(o)&&l.value.forEach(C=>{const M=I(m.value,C);if(M.is_showtime)return;if(["char_1_sprite","char_2_sprite"].includes(a)){const[u,c]=N(h),[U,x]=N(g),{name:we,group:ce,value:re,isErr:Ae}=z(M,a);E(h,re!=="",Ae,ce===u&&re===c)&&(M[we]=U,M[a]=x)}else{const u=M[a],c=d(a,u);E(h,u!=="",c,u===h)&&(M[a]=g)}})};return{chapterFilter:w,search:O,searchResult:n,getSpriteEmpty:r,getChildOptions:Q,initSearch:Z,submitSearch:ee,submitReplace:q,keywordSearch:ne,showSearch:te,itemsSearch:de}}),Be=s=>(Ce("data-v-444f8fc8"),s=s(),xe(),s),mt={class:"popup_window"},ft={class:"popup_container scrollbar"},wt={class:"mb-8 flex justify-center"},bt={class:"popup_keyword_group"},St=Be(()=>t("span",null,null,-1)),$t=["disabled","title"],yt=["disabled","title"],kt={class:"popup_show_group"},Ct=Be(()=>t("span",null,null,-1)),xt={value:""},It={value:""},Tt={class:"-error",value:"err"},Rt=["disabled","title"],Lt={value:""},qt={class:"-error",value:"err"},Et={class:"col-span-2"},Dt=["disabled","title"],Mt={class:"contents"},Ut={class:"popup_items_group"},Vt={class:"popup_search_group"},Bt=["title"],At={value:""},Ot={value:""},jt=["onClick","title"],Ht={class:"popup_search"},Pt=["disabled","title"],Nt={class:"popup_replace"},Ft={value:""},Wt={value:""},zt={value:""},Jt=["disabled","title"],Kt={class:"popup_footer"},Gt=["title"],Qt={__name:"Search",emits:["goTop"],setup(s,{emit:f}){const m=ve();A(m);const $=ge(),{getEffect:R,getSe:L,getVoice:B,getShowList:y}=$;A($);const k=Te(),{getSpriteEmpty:W,getChildOptions:J,initSearch:v,submitSearch:I,submitReplace:w}=k,{search:l,chapterFilter:O}=A(k),{t:n}=ue("lang"),oe=P(()=>W(l.value.items)),Q=P(()=>[{id:"ui",title:n("showtime.ui")},{id:"bg",title:n("showtime.bg")},{id:"bgm",title:n("showtime.bgm")},{id:"cg",title:n("showtime.cg")},{id:"black",title:n("showtime.black")}]),Z=P(()=>[{id:"speaker",title:n("data.speaker")},{id:"char_1",title:n("data.char_1")},{id:"char_1_sprite",title:n("data.char_1_sprite")},{id:"char_1_effect",title:n("data.char_1_effect")},{id:"char_2",title:n("data.char_2")},{id:"char_2_sprite",title:n("data.char_2_sprite")},{id:"char_2_effect",title:n("data.char_2_effect")},{id:"se",title:n("data.se")},{id:"voice",title:n("data.voice")}]),ae=()=>l.value.items.push({parent:"",child:""}),ee=j=>l.value.items.splice(j,1),q=j=>{const d=j.target.matches(".popup_window, .popup_window *"),z=j.target.matches(".popup_close");!j.target.matches(".popup_remove")&&(!d||z)&&(l.value.open=!1)};return(j,d)=>{const z=Ue("visible");return V((b(),T("section",{class:"popup",onClick:q},[t("div",mt,[t("div",ft,[t("div",wt,[i(Ze,{class:"popup_radio",value:e(l).type,"onUpdate:value":d[0]||(d[0]=r=>e(l).type=r),list:[{id:0,title:e(n)("edit.serif")},{id:1,title:e(n)("showtime.scene")+"＆"+e(n)("showtime.perform")},{id:2,title:e(n)("search.item")}],name:"type"},null,8,["value","list"])]),V(t("div",bt,[St,i(ye,{class:"popup_input col-span-2",value:e(l).keyword.value,"onUpdate:value":d[1]||(d[1]=r=>e(l).keyword.value=r),placeholder:e(n)("search.keyword")},null,8,["value","placeholder"]),t("button",{class:"popup_submit",onClick:d[2]||(d[2]=(...r)=>e(I)&&e(I)(...r)),disabled:e(l).keyword.value==="",title:e(n)("search.search")},[i(e(he))],8,$t),t("span",null,_(e(n)("search.replace-from")),1),i(ye,{class:"popup_input",value:e(l).keyword.rep,"onUpdate:value":d[3]||(d[3]=r=>e(l).keyword.rep=r)},null,8,["value"]),t("span",null,_(e(n)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:d[4]||(d[4]=(...r)=>e(w)&&e(w)(...r)),disabled:e(l).keyword.value==="",title:e(n)("search.replace")},[i(Se,{class:"text-[1.2em]"})],8,yt)],512),[[K,e(l).type===0]]),V(t("div",kt,[Ct,i(X,{class:"popup_select",value:e(l).show.parent,"onUpdate:value":d[5]||(d[5]=r=>e(l).show.parent=r),options:Q.value,onChange:d[6]||(d[6]=r=>{e(l).show.child="",e(l).show.rep=""})},{default:D(()=>[t("option",xt,_(e(n)("search.all")),1)]),_:1},8,["value","options"]),t("span",null,_(e(n)("search.is")),1),i(X,{class:"popup_select",value:e(l).show.child,"onUpdate:value":d[7]||(d[7]=r=>e(l).show.child=r),options:e(y)(e(l).show.parent)},{default:D(()=>[t("option",It,_(e(n)("search.all")),1),t("option",Tt,_(e(n)("search.err")),1)]),_:1},8,["value","options"]),t("button",{class:"popup_submit",onClick:d[8]||(d[8]=(...r)=>e(I)&&e(I)(...r)),disabled:e(l).show.parent===""&&e(l).show.child==="",title:e(n)("search.search")},[i(e(he))],8,Rt),t("span",null,_(e(n)("search.replace-from")),1),i(X,{class:"popup_select",value:e(l).show.rep,"onUpdate:value":d[9]||(d[9]=r=>e(l).show.rep=r),options:e(y)(e(l).show.parent)},{default:D(()=>[t("option",Lt,_(e(n)("search.all")),1),t("option",qt,_(e(n)("search.err")),1)]),_:1},8,["value","options"]),t("span",Et,_(e(n)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:d[10]||(d[10]=(...r)=>e(w)&&e(w)(...r)),disabled:e(l).show.rep==="",title:e(n)("search.replace")},[i(Se,{class:"text-[1.2em]"})],8,Dt)],512),[[K,e(l).type===1]]),V(t("div",Mt,[t("div",Ut,[(b(!0),T(le,null,$e(e(l).items,(r,N)=>(b(),T("div",Vt,[V(t("button",{class:"popup_submit",onClick:ae,title:e(n)("search.add")},_(e(n)("search.add")),9,Bt),[[K,!N]]),V(t("span",{class:"text-right"},_(e(n)("search.and")),513),[[K,N]]),i(X,{class:"popup_select",value:r.parent,"onUpdate:value":E=>r.parent=E,options:Z.value,onChange:E=>r.child=""},{default:D(()=>[t("option",At,_(e(n)("search.all")),1)]),_:2},1032,["value","onUpdate:value","options","onChange"]),t("span",null,_(e(n)("search.is")),1),i(X,{class:"popup_select",value:r.child,"onUpdate:value":E=>r.child=E,options:e(J)(r.parent)},{default:D(()=>[t("option",Ot,_(e(n)("search.all")),1),V(t("option",{class:"-error",value:"err"},_(e(n)("search.err")),513),[[K,r.parent!==""]])]),_:2},1032,["value","onUpdate:value","options"]),V((b(),T("button",{class:"popup_remove",onClick:E=>ee(N),title:e(n)("button.del")},[i(e(nt))],8,jt)),[[z,N]])]))),256)),t("div",Ht,[t("button",{class:"popup_submit",onClick:d[11]||(d[11]=(...r)=>e(I)&&e(I)(...r)),disabled:!oe.value,title:e(n)("search.search")},[i(e(he))],8,Pt)])]),t("div",Nt,[i(X,{class:"popup_select",value:e(l).itemsRep.parent,"onUpdate:value":d[12]||(d[12]=r=>e(l).itemsRep.parent=r),options:Z.value,onChange:d[13]||(d[13]=r=>{e(l).itemsRep.child="",e(l).itemsRep.rep=""})},{default:D(()=>[t("option",Ft,_(e(n)("search.all")),1)]),_:1},8,["value","options"]),t("span",null,_(e(n)("search.is")),1),i(X,{class:"popup_select",value:e(l).itemsRep.child,"onUpdate:value":d[14]||(d[14]=r=>e(l).itemsRep.child=r),options:e(J)(e(l).itemsRep.parent)},{default:D(()=>[t("option",Wt,_(e(n)("search.all")),1),V(t("option",{class:"-error",value:"err"},_(e(n)("search.err")),513),[[K,e(l).itemsRep.parent!==""]])]),_:1},8,["value","options"]),t("span",null,_(e(n)("search.replace-from")),1),i(X,{class:"popup_select",value:e(l).itemsRep.rep,"onUpdate:value":d[15]||(d[15]=r=>e(l).itemsRep.rep=r),options:e(J)(e(l).itemsRep.parent)},{default:D(()=>[t("option",zt,_(e(n)("edit.name")),1)]),_:1},8,["value","options"]),t("span",null,_(e(n)("search.replace-to")),1),t("button",{class:"popup_submit",onClick:d[16]||(d[16]=(...r)=>e(w)&&e(w)(...r)),disabled:e(l).itemsRep.parent===""&&e(l).itemsRep.child===""||e(l).itemsRep.rep==="",title:e(n)("search.replace")},[i(Se,{class:"text-[1.2em]"})],8,Jt)])],512),[[K,e(l).type===2]])]),t("footer",Kt,[t("button",{class:"popup_submit -cancel",onClick:d[17]||(d[17]=(...r)=>e(v)&&e(v)(...r)),title:e(n)("search.cancel")},_(e(n)("search.cancel")),9,Gt)])])])),[[z,e(l).open]])}}},Xt=G(Qt,[["__scopeId","data-v-444f8fc8"]]),Yt={name:"MaterialSymbolsArrowWarmUpRounded"},Zt={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},es=t("path",{fill:"currentColor",d:"M12 13q-.425 0-.712-.288T11 12V5.825L7.1 9.7q-.275.275-.687.288T5.7 9.7q-.275-.275-.275-.7t.275-.7l5.6-5.6q.15-.15.325-.212T12 2.425t.375.063t.325.212l5.6 5.6q.275.275.275.688T18.3 9.7q-.3.3-.712.3t-.713-.3L13 5.825V12q0 .425-.288.713T12 13m0 5q-.425 0-.712-.288T11 17v-1q0-.425.288-.712T12 15t.713.288T13 16v1q0 .425-.288.713T12 18m0 4q-.425 0-.712-.288T11 21t.288-.712T12 20t.713.288T13 21t-.288.713T12 22"},null,-1),ts=[es];function ss(s,f,m,$,R,L){return b(),T("svg",Zt,ts)}const De=G(Yt,[["render",ss]]),os={class:"chapter_head"},as=["title"],ls=["disabled","title"],ns=["disabled","title"],is=["title"],cs={__name:"Head",setup(s){const f=_e(),{deleteChapter:m,moveChapter:$}=f,{chapterIndex:R,chapterLength:L,chapterTarget:B,chapterData:y}=A(f),k=Te(),{search:W,searchResult:J}=A(k),{t:v}=ue("lang");return(I,w)=>(b(),T("header",os,[i(ye,{class:"chapter_head_title",value:e(B).title,"onUpdate:value":w[0]||(w[0]=l=>e(B).title=l),placeholder:e(v)("edit.title-input")},null,8,["value","placeholder"]),t("button",{class:H(["chapter_head_button",{"-active":e(J).result}]),onClick:w[1]||(w[1]=l=>e(W).open=!0),title:e(v)("search.search")},[i(e(he),{class:"!text-xl"})],10,as),t("button",{class:"chapter_head_button",onClick:w[2]||(w[2]=l=>e($)(-1)),disabled:!e(R),title:e(v)("button.up")},[i(De)],8,ls),t("button",{class:"chapter_head_button",onClick:w[3]||(w[3]=l=>e($)(1)),disabled:!e(L)||e(R)===e(L)-1,title:e(v)("button.down")},[i(De,{class:"-scale-y-100"})],8,ns),t("button",{class:"chapter_head_button",onClick:w[4]||(w[4]=(...l)=>e(m)&&e(m)(...l)),title:e(v)("button.del")},[i(ze)],8,is)]))}},rs=G(cs,[["__scopeId","data-v-1fd08f2c"]]),us={__name:"Inner",props:{value:{type:[Number,String],default:void 0},list:{type:[Array,Boolean],default:!1},type:{type:[String],default:""}},setup(s){const f=s,{findData:m}=ke(),$=P(()=>m(f.list||[],f.value)),R=P(()=>f.list===!1?!1:f.value!==""&&!$.value),L=P(()=>({"-showtime":f.type==="showtime","!bg-red-500/50":R.value}));return(B,y)=>{var k;return b(),T("div",{class:H(["inner",L.value])},_(((k=$.value)==null?void 0:k.name)??s.value),3)}}},F=G(us,[["__scopeId","data-v-8cdb2df2"]]),ds=s=>(Ce("data-v-569f67ca"),s=s(),xe(),s),ps={class:"chapter log_scene"},hs=ds(()=>t("div",{class:"chapter log_switches xl:!hidden"},null,-1)),_s={__name:"logShowHead",props:{log:{type:[Object],default:()=>({})}},emits:["more"],setup(s,{emit:f}){const m=f,$=ge(),{getShowList:R}=$,{t:L}=ue("lang");return(B,y)=>(b(),T(le,null,[t("div",{class:H(["chapter log_td -first",{"bg-secondary/60":s.log.is_selected}])},[i(Ve,{class:"chapter log_check",value:s.log.is_selected,"onUpdate:value":y[0]||(y[0]=k=>s.log.is_selected=k)},null,8,["value"]),i(Ie,{class:"chapter log_control",onMore:y[1]||(y[1]=k=>m("more",k)),hasDel:!1,hasAdd:!1}),t("div",ps,[t("span",null,_(e(L)(`showtime.${s.log.speaker}`)),1),t("span",null,_(e(L)(`showtime.${s.log.show_time}`)??s.log.show_time),1),i(F,{value:s.log.show_name,list:e(R)(s.log.show_time),type:"showtime"},null,8,["value","list"])])],2),hs],64))}},vs=G(_s,[["__scopeId","data-v-569f67ca"]]),gs={class:"chapter log_tr_2"},ms=t("div",{class:"chapter log_td -col"},null,-1),fs=t("div",{class:"chapter log_td -col"},null,-1),ws=t("div",{class:"chapter log_td -col"},null,-1),bs={class:"chapter log_td -col"},Ss={__name:"logShowBody",props:{log:{type:[Object],default:()=>({})}},setup(s){return(f,m)=>(b(),T("div",gs,[ms,fs,ws,t("div",bs,[i(F,{value:s.log.remark},null,8,["value"])])]))}},$s=["title"],ys={class:"chapter log_comment"},ks={class:"chapter log_switches"},Cs={__name:"logCommentHead",props:{log:{type:[Object],default:()=>({})}},emits:["more","target"],setup(s,{emit:f}){const m=s,$=f,R=ve(),{getCharacter:L}=R,B=_e(),{dialogType:y}=B,{t:k}=ue("lang"),W=P(()=>L(m.log.speaker));return(J,v)=>{const I=Ue("visible");return b(),T(le,null,[t("div",{class:H(["chapter log_td -first",{"bg-secondary/60":s.log.is_selected}])},[i(Ve,{class:"chapter log_check",value:s.log.is_selected,"onUpdate:value":v[0]||(v[0]=w=>s.log.is_selected=w)},null,8,["value"]),i(Ie,{class:"chapter log_control",onMore:v[2]||(v[2]=w=>$("more",w)),onDel:v[3]||(v[3]=w=>s.log.is_delete=!0),hasAdd:!1},{top:D(()=>[t("button",{class:"control_button",onClick:v[1]||(v[1]=w=>$("target")),title:e(k)("button.target-chapter")},[i(Ke,{class:"text-xl"})],8,$s)]),_:1}),t("div",{class:H(["chapter log_info",{"flex-row-reverse":W.value.is_hero,"-replay":s.log.is_replay}])},[i(tt,{class:"chapter log_avatar",name:W.value.name??s.log.speaker},null,8,["name"]),t("div",ys,[i(et,{class:"chapter log_dialog",value:s.log.content,type:e(y)(s.log)},null,8,["value","type"])])],2)],2),t("div",ks,[V((b(),Y(pe,{class:H(["chapter log_switch",{"text-replay":s.log.is_replay}]),active:s.log.is_replay,title:e(k)("data.replay")},{default:D(()=>[be("R")]),_:1},8,["active","class","title"])),[[I,s.log.is_replay]]),V((b(),Y(pe,{class:H(["chapter log_switch",{"text-unknown":s.log.is_unknown}]),active:s.log.is_unknown,title:e(k)("data.unknown")},{default:D(()=>[be("U")]),_:1},8,["active","class","title"])),[[I,s.log.is_unknown]]),V((b(),Y(pe,{class:H(["chapter log_switch",{"-monolog":s.log.is_monolog}]),active:s.log.is_monolog,title:e(k)("data.monolog")},{default:D(()=>[be("S")]),_:1},8,["active","class","title"])),[[I,s.log.is_monolog]])])],64)}}},xs=G(Cs,[["__scopeId","data-v-620df50d"]]),Is={class:"chapter log_tr_2"},Ts={class:"chapter log_td -col"},Rs={class:"chapter log_td -col"},Ls={class:"chapter log_td -col"},qs={class:"chapter log_td -col"},Es={__name:"logCommentBody",props:{log:{type:[Object],default:()=>({})}},setup(s){const f=ve(),{getCharacter:m}=f,{characterList:$}=A(f),R=ge(),{effectList:L,seList:B,voiceList:y}=A(R);return(k,W)=>(b(),T("div",Is,[t("div",Ts,[i(F,{class:"col-span-2",value:s.log.char_1,list:e($)},null,8,["value","list"]),i(F,{value:s.log.char_1_sprite,list:e(m)(s.log.char_1).sprite},null,8,["value","list"]),i(F,{value:s.log.char_1_effect,list:e(L)},null,8,["value","list"])]),t("div",Rs,[i(F,{class:"col-span-2",value:s.log.char_2,list:e($)},null,8,["value","list"]),i(F,{value:s.log.char_2_sprite,list:e(m)(s.log.char_2).sprite},null,8,["value","list"]),i(F,{value:s.log.char_2_effect,list:e(L)},null,8,["value","list"])]),t("div",Ls,[i(F,{value:s.log.se,list:e(B)},null,8,["value","list"]),i(F,{value:s.log.voice,list:e(y)},null,8,["value","list"])]),t("div",qs,[i(F,{value:s.log.remark},null,8,["value"])])]))}},Ds=s=>(Ce("data-v-fd28e26d"),s=s(),xe(),s),Ms=["title"],Us={class:"side_list"},Vs={class:"flex"},Bs=["onClick","title"],As={class:"chapter log"},Os={class:"chapter log_tr -lock"},js={class:"mx-1 w-14 self-center"},Hs={class:"chapter log_th xl:ml-0"},Ps=Ds(()=>t("div",{class:"ml-3 w-7 shrink-0 xl:hidden"},null,-1)),Ns={class:"chapter log_tr_2 -lock"},Fs={class:"chapter log_th -col"},Ws={class:"chapter log_th -col"},zs={class:"chapter log_th -col"},Js={class:"chapter log_th -col"},Ks={class:"contents"},Gs=["onDragstart","onDragend"],Qs={__name:"index",setup(s){const f=Pe(),m=Ne(),$=_e(),{newChapter:R,deleteChapter:L,moveChapter:B}=$,{chapterIndex:y,chapterNames:k,chapterLength:W,chapterTarget:J,chapterData:v}=A($),I=Ge(),{newLogId:w}=I,{logId:l}=A(I),O=Te(),{chapterFilter:n}=A(O),{findData:oe,findIndex:Q,getClientRect:Z}=ke(),{dragMove:ae,dropMove:ee}=Fe(),{t:q}=ue("lang"),j=P(()=>v.value.some(p=>p.dragging)),d=P(()=>v.value.filter(p=>p.is_selected&&!p.is_delete).map(p=>p.id)),z=(p,u,c)=>{const U=oe(v.value,u),x=v.value.indexOf(U);c&&ae(p,{index:x}),d.value.some(ce=>ce===u)||(U.is_selected=1),d.value.forEach(ce=>{const re=oe(v.value,ce);re.dragging=c,c||(re.is_selected=0)})},r=(p,u)=>{const c=u===null?0:Q(v.value,u)+1;d.value.forEach(U=>{const x=Q(v.value,U);ee(v.value,x,c)})},N=se(!1),E=se(0),ne=se(null),te=(p,u)=>{const c=Q(v.value,u);E.value=u!==void 0&&c===-1?null:c,ne.value=p,N.value=u===null},de=({type:p})=>{const u=E.value,c=v.value[u];p==="delete"?fe(c):p==="edit"?a(c.id,{}):p==="copy"?me(c,u+1):a("add",{type:p})},me=(p,u)=>{v.value.splice(u+1,0,{...p,id:w()})},fe=p=>{p.is_delete=!0,d.value.forEach(u=>u.is_delete=!0)},ie=se(!1),o=Me({id:0,type:"",index:0}),a=(p,{type:u})=>{o.id=p,o.type=u??"",o.index=E.value,ie.value=!0},h=p=>{const u=E.value===null?v.value.length:o.index+1;v.value.splice(u,0,p)},g=se(null),S=se({}),C=()=>{We(()=>{const p=S.value[l.value];if(!p)return;const{height:u,top:c}=Z(p);g.value.mainScroll({top:c-u*2,left:0})})},M=p=>{l.value=p,m.push({name:"Preview"})};return Re(y,C),Re(()=>f.name,p=>{p==="Chapters"&&C()}),(p,u)=>(b(),Y(Je,{ref_key:"wrap",ref:g},{side_foot:D(()=>[t("button",{class:"chapter_add",onClick:u[0]||(u[0]=(...c)=>e(R)&&e(R)(...c)),title:e(q)("button.new")},[i(e(qe))],8,Ms)]),side:D(()=>[t("ul",Us,[(b(!0),T(le,null,$e(e(k),(c,U)=>(b(),T("li",Vs,[i(Ye,{class:"chapter_mark",active:U===e(y)},null,8,["active"]),t("button",{class:H(["side_item",{"side_item-active":U===e(y)}]),onClick:x=>y.value=U,title:c},_(c),11,Bs)]))),256))])]),main_head:D(()=>[i(rs)]),default:D(()=>[t("div",As,[t("div",Os,[t("div",js,[i(pe,{class:"chapter_plus",title:e(q)("button.new")},{default:D(()=>[i(e(qe),{class:"mt-0.1em"}),i(Ie,{class:"absolute left-0 top-0 opacity-0",onMore:u[1]||(u[1]=c=>te(c,null)),hasDel:!1,hasAdd:!1})]),_:1},8,["title"])]),t("div",Hs,_(e(q)("edit.serif"))+"＆"+_(e(q)("showtime.scene"))+"＆"+_(e(q)("showtime.perform")),1),Ps]),t("div",Ns,[t("div",Fs,_(e(q)("data.char_1"))+"．"+_(e(q)("edit.sprite-ign"))+"＆"+_(e(q)("edit.effect")),1),t("div",Ws,_(e(q)("data.char_2"))+"．"+_(e(q)("edit.sprite-ign"))+"＆"+_(e(q)("edit.effect")),1),t("div",zs,_(e(q)("data.se"))+"＆"+_(e(q)("data.voice")),1),t("div",Js,_(e(q)("data.remark")),1)]),i(Ee,{class:"chapter log_dragline",onDrop:u[2]||(u[2]=c=>r(c,null)),dragging:j.value},null,8,["dragging"]),(b(!0),T(le,null,$e(e(n),(c,U)=>(b(),T(le,{key:c.id},[V(t("section",Ks,[t("div",{class:H(["chapter log_tr",{"-dragging":c.dragging}]),draggable:!0,onDragstart:x=>z(x,c.id,!0),onDragend:x=>z(x,c.id,!1),onDrag:u[3]||(u[3]=Le(()=>{},["prevent"])),onDrop:u[4]||(u[4]=Le(()=>{},["prevent"])),ref_for:!0,ref:x=>S.value[c.id]=x},[c.is_showtime?(b(),Y(vs,{key:0,log:c,onMore:x=>te(x,c.id)},null,8,["log","onMore"])):(b(),Y(xs,{key:1,log:c,onMore:x=>te(x,c.id),onTarget:x=>M(c.id)},null,8,["log","onMore","onTarget"]))],42,Gs),c.is_showtime?(b(),Y(Ss,{key:0,log:c},null,8,["log"])):(b(),Y(Es,{key:1,log:c},null,8,["log"]))],512),[[K,!c.is_delete]]),V(i(Ee,{class:"chapter log_dragline",onDrop:x=>r(x,c.id),dragging:j.value},null,8,["onDrop","dragging"]),[[K,!c.is_delete]])],64))),128))]),i(Qe,{positions:ne.value,onClear:te,onUse:de,onlyAdd:N.value},null,8,["positions","onlyAdd"]),i(Xt),i(Xe,{open:ie.value,"onUpdate:open":u[5]||(u[5]=c=>ie.value=c),id:o.id,type:o.type,onAdd:h},null,8,["open","id","type"])]),_:1},512))}},po=G(Qs,[["__scopeId","data-v-fd28e26d"]]);export{po as default};
