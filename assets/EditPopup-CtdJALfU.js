import{_ as Y,o as q,c as J,a as e,x as ce,r as g,h as d,p as ue,w as O,n as K,k as re,F as ge,l as fe,t as X,v as Q,g as R,O as we,E as be,P as ye,I as xe,J as Se,A as Ce,i as ve,s as j,u as _e,b as me,j as ke,K as Ie,f as Ue,e as h,y as G,d as P,C as $e,L as Le,M as Be}from"./index-DBINRWBh.js";/* empty css                                                             */import{S as $}from"./Dialog-D2zKAb-C.js";const Te={name:"MdiTarget"},Me={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},Ee=e("path",{fill:"currentColor",d:"M11 2v2.07A8 8 0 0 0 4.07 11H2v2h2.07A8 8 0 0 0 11 19.93V22h2v-2.07A8 8 0 0 0 19.93 13H22v-2h-2.07A8 8 0 0 0 13 4.07V2m-2 4.08V8h2V6.09c2.5.41 4.5 2.41 4.92 4.91H16v2h1.91c-.41 2.5-2.41 4.5-4.91 4.92V16h-2v1.91C8.5 17.5 6.5 15.5 6.08 13H8v-2H6.09C6.5 8.5 8.5 6.5 11 6.08M12 11a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1"},null,-1),Ge=[Ee];function Oe(c,S,_,r,v,u){return q(),J("svg",Me,Ge)}const Qt=Y(Te,[["render",Oe]]),Re={class:"menu_list"},Ve={class:"contents"},He=["onClick","title"],Ne={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(c,{emit:S}){const _=c,r=S,{getClientRect:v}=ce(),u=g(null),C=[{title:"セリフ",type:"dialog"},{title:"セリフ：主人公",type:"dialog_hero"},{title:"切り替え：UI",type:"scene_ui"},{title:"切り替え：背景",type:"scene_bg"},{title:"切り替え：BGM",type:"scene_bgm"},{title:"演出：CG",type:"perform_cg"},{title:"演出：CG終了",type:"perform_cg_end"},{title:"演出：暗転",type:"perform_black"},{title:"アナウンス",type:"dialog_announce",class:"!text-announce"},{title:"ナレーション",type:"dialog_system",class:"!text-announce"},{title:"コピー",type:"copy",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"編集",type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"削除",type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}],m=d(()=>{const{width:f,height:U}=v(document.documentElement),{width:w,height:b}=v(u.value),{x:M,y,width:V,height:E}=_.positions??{},x=(y??0)+(E??0)/2-(b??0)/2,L=(x<20?20:x)+"px",B=(U??0)-(b??0)-20+"px",z=`min(${L}, ${B})`,F=(M??0)+(w??0)>f,N=(M??0)+(V??0)+2,D=(M??0)-(w??0)-9-2,A=(F?D:N)+"px";return{top:z,left:A}}),k=d(()=>{const{width:f}=v(document.documentElement),{width:U}=v(u.value),{x:w,y:b,width:M,height:y}=_.positions??{},V=(b??0)+(y??0)/2,E=(w??0)+(U??0)>f,x=(w??0)+(M??0)+3,L=(w??0)-3.2,B=E?L:x;return{top:V+"px",left:B+"px",turn:E}}),I=f=>{f.target.matches(".menu, .menu *")||r("clear",null)},H=f=>{r("use",{type:f}),r("clear",null)};return(f,U)=>{const w=ue("visible");return O((q(),J("div",{class:"menu_container",onClick:I},[e("div",{class:K(["menu_triangle",{"-scale-x-100":k.value.turn}]),style:re(k.value)},null,6),e("div",{class:"menu scrollbar overflow-y-auto",style:re(m.value),ref_key:"menu",ref:u},[e("ul",Re,[(q(),J(ge,null,fe(C,b=>e("li",Ve,[O(e("button",{class:K(["menu_item",b.class]),onClick:M=>H(b.type),title:b.title},X(b.title),11,He),[[Q,!(["copy","edit","delete"].includes(b.type)&&c.onlyAdd)]])])),64))])],4)])),[[w,c.positions]])}}},Xt=Y(Ne,[["__scopeId","data-v-e4cfe076"]]),De=["disabled","placeholder"],Ae={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(c,{emit:S}){const _=c,r=S,v=g(null),u=g(""),C=m=>{if(!m.ctrlKey)return;const{selectionStart:k,selectionEnd:I}=v.value;r("selected",{start:k,end:I})};return R(u,m=>r("update:value",m)),R(()=>_.value,m=>u.value=m,{immediate:!0}),(m,k)=>{const I=ue("verify");return O((q(),J("textarea",{class:"scrollbar textarea","onUpdate:modelValue":k[0]||(k[0]=H=>u.value=H),disabled:c.disabled,placeholder:c.disabled?"":c.placeholder,onKeydown:be(C,["q"]),ref_key:"textarea",ref:v},null,40,De)),[[we,u.value,void 0,{lazy:!0,trim:!0}],[I,void 0,void 0,{check:!0}]])}}},de=Y(Ae,[["__scopeId","data-v-c1e57f9a"]]),Pe=["disabled"],je={class:"whitespace-nowrap"},Ke={__name:"Checkbox",props:{value:{type:[Number],default:0},disabled:{type:[Boolean],default:!1},title:{type:[String],default:""},box:{type:[String],default:""}},emits:["update:value"],setup(c,{emit:S}){const _=c,r=S,v=g(0);return R(v,u=>r("update:value",u)),R(()=>_.value,u=>v.value=u,{immediate:!0}),(u,C)=>(q(),J("label",{class:K(["inline-flex items-center",c.disabled?"cursor-auto":"cursor-pointer"])},[O(e("input",{class:K(["checkbox",c.box]),"onUpdate:modelValue":C[0]||(C[0]=m=>v.value=m),disabled:c.disabled,"true-value":1,"false-value":0,type:"checkbox"},null,10,Pe),[[ye,v.value]]),e("span",je,X(c.title),1),xe(u.$slots,"default",{},void 0,!0)],2))}},ze=Y(Ke,[["__scopeId","data-v-b7a95cdd"]]),Fe=Se("log",()=>{const c=Ce(),S=ve(),{convertChapter:_}=S,{chapterData:r}=j(S),v=_e(),{characterHero:u,characterUnknown:C}=j(v),m=me(),{getUI:k,getHistoryList:I}=m,{defaultUI:H,defaultUIForCG:f}=j(m),{findData:U,findIndex:w,getRandomInt:b}=ce(),{newId:M}=ke(),y=g(0),V=g(0),E=d(()=>U(r.value,y.value)??{}),x=d(()=>r.value.filter(s=>!s.is_delete)),L=d(()=>x.value.filter(s=>{const p=!s.is_showtime,l=s.is_perform&&s.show_time==="暗場";return s.is_perform&&s.show_time,p||l})),B=d(()=>{const s=w(x.value,y.value)+1,p=x.value.slice(0,s),l=x.value.slice(s);return l.every(o=>o.is_showtime&&o.show_time!=="暗場")&&p.push(...l),p});R(y,s=>{const p=U(r.value,s)??{};p.is_scene||(V.value=w(L.value,p.id))}),R(V,s=>{var p;return y.value=((p=L.value[s])==null?void 0:p.id)??0}),R(r,()=>{var s;return y.value=((s=L.value[0])==null?void 0:s.id)??0}),Ie(()=>{var s;return y.value=((s=L.value[0])==null?void 0:s.id)??0});const z=d(()=>{const s=I(B.value,"CG");return((s==null?void 0:s.show_name)??"")!==""&&(s==null?void 0:s.show_name)!=="結束"}),F=d(()=>{const s=I(B.value,"UI"),p=(s==null?void 0:s.show_name)??H.value??"",l=f.value;return z.value&&l!==""?l:p}),N=d(()=>k(F.value)),D=d(()=>{const s=N.value,p=E.value,l=u.value.name,a=p.人物,o=s.name_tag_number===2,T=p.is_monolog&&s.name_tag_solo_show,n=a===l&&s.name_tag_hero_right,te=a===p.顯示角色&&s.name_tag_sprite_1_right,he=a===p.立ち絵2&&s.name_tag_sprite_2_right&&s.sprite_number===2;return o&&(T||n||te||he)}),A=d(()=>{const s=E.value,p=s.is_system||s.is_announce||s.is_monolog,l=s.is_monolog&&N.value.name_tag_solo_show;return!p||l}),Z=d(()=>!D.value&&A.value),ee=d(()=>D.value&&A.value),t=g(!1),se=g(!1),oe=g(!1),ne=g(!1),ae=g(!1),le=g(!1),ie=d(()=>({"":t.value}));R(()=>c.name,()=>t.value=!1);const W=()=>M(r.value);return{logId:y,logIndex:V,logData:E,logShowing:x,logContents:L,logHistory:B,logCGMode:z,logUIId:F,logUI:N,isNameRight:D,isNameShow:A,nameTag1Show:Z,nameTag2Show:ee,logPlay:t,logPause:se,logTyping:oe,logBlack:ne,logVoicing:ae,logAnimating:le,playEase:ie,newLogId:W,newLog:(s,p=!1)=>{var T,n,te;let l={name:"",content:""};s==="scene_ui"&&(l={name:"場景(切換)",content:"UI"}),s==="scene_bg"&&(l={name:"場景(切換)",content:"BG"}),s==="scene_bgm"&&(l={name:"場景(切換)",content:"BGM"}),s==="perform_cg"&&(l={name:"演出",content:"CG"}),s==="perform_cg_end"&&(l={name:"演出",content:"CG/結束"}),s==="perform_anime"&&(l={name:"演出",content:"動畫"}),s==="perform_black"&&(l={name:"演出",content:"暗場"}),s==="dialog"&&(l={name:((T=C.value)==null?void 0:T.name)??"",content:""}),s==="dialog_hero"&&(l={name:((n=u.value)==null?void 0:n.name)??"",content:""}),s==="dialog_announce"&&(l={name:"廣播",content:""}),s==="dialog_system"&&(l={name:"系統",content:""});const a={id:W(),人物:l.name??"",顯示角色:"",角色差分:"",差分特效:"",立ち絵2:p?((te=u.value)==null?void 0:te.name)??"":"",十六夜差分:"",和訳:l.content??"",SE:"",Voice:"",備註:""},o=_(a);return{...a,...o}}}}),i=c=>(Le("data-v-91c6f09b"),c=c(),Be(),c),qe={class:"popup_window"},Je={class:"contents"},We={class:"contents"},Qe={class:"popup_label"},Xe=i(()=>e("div",{class:"-col-2"},null,-1)),Ye={class:"contents"},Ze=i(()=>e("span",{class:"popup_label"},"内容",-1)),et={value:""},tt={class:"contents"},st={class:"contents"},ot=i(()=>e("span",{class:"popup_label"},"話し手",-1)),nt={class:"popup_input"},at={class:"contents"},lt=i(()=>e("span",{class:"popup_label"},"話し手",-1)),it={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},ct={class:"popup_group"},ut=i(()=>e("span",{class:"popup_group_title"},"・立ち絵1",-1)),pt={class:"contents"},rt=i(()=>e("span",{class:"popup_label"},"キャラ指定",-1)),dt=i(()=>e("option",{value:""},"無指定",-1)),vt={class:"contents"},_t=i(()=>e("span",{class:"popup_label"},"キャラ差分",-1)),mt=i(()=>e("option",{value:""},"引き継ぎ",-1)),ht={class:"contents"},gt=i(()=>e("span",{class:"popup_label"},"エフェクト",-1)),ft=i(()=>e("option",{value:""},"なし",-1)),wt={class:"popup_group"},bt={class:"popup_group_title"},yt=i(()=>e("span",null,"・立ち絵2",-1)),xt={class:"popup_group_checkbox"},St=i(()=>e("span",null,"デフォルトで主人公",-1)),Ct={class:"contents"},kt=i(()=>e("span",{class:"popup_label"},"キャラ指定",-1)),It=i(()=>e("option",{value:""},"無指定",-1)),Ut={class:"contents"},$t=i(()=>e("span",{class:"popup_label"},"キャラ差分",-1)),Lt=i(()=>e("option",{value:""},"引き継ぎ",-1)),Bt={class:"contents"},Tt=i(()=>e("span",{class:"popup_label"},"エフェクト",-1)),Mt=i(()=>e("option",{value:""},"なし",-1)),Et={class:"contents"},Gt=i(()=>e("span",{class:"popup_label"},"SE",-1)),Ot=i(()=>e("option",{value:""},"なし",-1)),Rt={class:"contents"},Vt=i(()=>e("span",{class:"popup_label"},"ボイス",-1)),Ht=i(()=>e("option",{value:""},"なし",-1)),Nt={class:"contents"},Dt=i(()=>e("span",{class:"popup_label"},"セリフ",-1)),At={class:"-col-3 grid gap-1"},Pt=i(()=>e("span",{class:"text-right text-xs opacity-50"},"セリフにキーワードを指定したい場合は、文字を[ ]で囲んでください。",-1)),jt={class:"contents"},Kt=i(()=>e("span",{class:"popup_label"},"備考",-1)),zt=i(()=>e("button",{class:"popup_submit -cancel",title:"キャンセル"},"キャンセル",-1)),Ft={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(c,{emit:S}){const _=c,r=S,v=Ue(),{defaultHero:u}=j(v),C=_e(),{getCharacter:m}=C,{characterList:k,characterReals:I}=j(C),H=ve(),{chapterData:f}=j(H),U=me(),{blackList:w,getEffect:b,getBackground:M,getCg:y,getBgm:V,getSe:E,getShowList:x}=U,{uiList:L,effectList:B,seList:z,voiceList:F}=j(U),N=Fe(),{newLog:D}=N,{isDev:A,findData:Z}=ce(),ee=g(null),t=g({}),se=d(()=>{var a;return(a=m(t.value.人物))==null?void 0:a.name}),oe=d(()=>[{id:"UI",show:t.value.is_scene},{id:"BG",show:t.value.is_scene},{id:"BGM",show:t.value.is_scene},{id:"CG",show:t.value.is_perform},{id:"暗場",show:t.value.is_perform}]),ne=d(()=>x(t.value.show_time)),ae=d(()=>k.value.filter(a=>!a.disabled||a.unknown)),le=d(()=>W(t.value.顯示角色)),ie=d(()=>W(t.value.立ち絵2)),W=a=>{var o;return((o=m(a))==null?void 0:o.sprite)??[]},pe=()=>{t.value.show_time==="CG"&&t.value.show_name==="結束"||(t.value.show_name="")},s=a=>t.value[a]="",p=()=>{const a={...t.value};if(_.id==="add")r("add",a);else{const T=Z(f.value,_.id);Object.assign(T,a)}r("update:open",!1),(!a.is_showtime||a.show_time==="暗場")&&r("target",a.id)},l=a=>{const o=a.target.matches(".popup_window, .popup_window *"),T=a.target.matches(".-cancel");(!o||T)&&r("update:open",!1)};return R(()=>_.open,a=>{a&&(_.id==="add"?t.value=D(_.type,u.value):t.value={...Z(f.value,_.id)},A&&console.log({...t.value}),ee.value.scrollTo({top:0,left:0}))}),(a,o)=>{const T=ue("visible");return O((q(),J("section",{class:"popup",onClick:l},[e("div",qe,[e("div",{class:"popup_container scrollbar",ref_key:"container",ref:ee},[O(e("div",Je,[e("div",We,[e("span",Qe,X(t.value.人物),1),h($,{class:"popup_select",value:t.value.show_time,"onUpdate:value":o[0]||(o[0]=n=>t.value.show_time=n),options:oe.value,onChange:pe},null,8,["value","options"])]),Xe,e("div",Ye,[Ze,h($,{class:"popup_select -col-3",value:t.value.show_name,"onUpdate:value":o[1]||(o[1]=n=>t.value.show_name=n),options:ne.value},{default:G(()=>[e("option",et,X(t.value.show_time==="暗場"?"フェード":"なし"),1)]),_:1},8,["value","options"])])],512),[[Q,t.value.is_showtime]]),O(e("div",tt,[O(e("div",st,[ot,e("span",nt,X(se.value),1)],512),[[Q,t.value.is_announce||t.value.is_system]]),O(e("div",at,[lt,h($,{class:"popup_select",value:t.value.人物,"onUpdate:value":o[2]||(o[2]=n=>t.value.人物=n),options:ae.value},null,8,["value","options"])],512),[[Q,!(t.value.is_announce||t.value.is_system)]]),e("div",it,[e("button",{class:K(["popup_switch text-replay",{"-active bg-replay":t.value.is_replay}]),onClick:o[3]||(o[3]=n=>t.value.is_replay=!t.value.is_replay),title:"再放送"},"再放送",2),e("button",{class:K(["popup_switch text-unknown",{"-active bg-unknown":t.value.is_unknown}]),onClick:o[4]||(o[4]=n=>t.value.is_unknown=!t.value.is_unknown),title:"未解明"},"未解明",2),e("button",{class:K(["popup_switch -monolog",{"-active":t.value.is_monolog}]),onClick:o[5]||(o[5]=n=>t.value.is_monolog=!t.value.is_monolog),title:"独り言"},"独り言",2)]),e("div",ct,[ut,e("div",pt,[rt,h($,{class:"popup_select",value:t.value.顯示角色,"onUpdate:value":o[6]||(o[6]=n=>t.value.顯示角色=n),options:P(I),onChange:o[7]||(o[7]=n=>s("角色差分"))},{default:G(()=>[dt]),_:1},8,["value","options"])]),e("div",vt,[_t,h($,{class:"popup_select",value:t.value.角色差分,"onUpdate:value":o[8]||(o[8]=n=>t.value.角色差分=n),options:le.value},{default:G(()=>[mt]),_:1},8,["value","options"])]),e("div",ht,[gt,h($,{class:"popup_select",value:t.value.差分特效,"onUpdate:value":o[9]||(o[9]=n=>t.value.差分特效=n),options:P(B)},{default:G(()=>[ft]),_:1},8,["value","options"])])]),e("div",wt,[e("div",bt,[yt,e("label",xt,[h(ze,{value:P(u),"onUpdate:value":o[10]||(o[10]=n=>$e(u)?u.value=n:null)},null,8,["value"]),St])]),e("div",Ct,[kt,h($,{class:"popup_select",value:t.value.立ち絵2,"onUpdate:value":o[11]||(o[11]=n=>t.value.立ち絵2=n),options:P(I),onChange:o[12]||(o[12]=n=>s("十六夜差分"))},{default:G(()=>[It]),_:1},8,["value","options"])]),e("div",Ut,[$t,h($,{class:"popup_select",value:t.value.十六夜差分,"onUpdate:value":o[13]||(o[13]=n=>t.value.十六夜差分=n),options:ie.value},{default:G(()=>[Lt]),_:1},8,["value","options"])]),e("div",Bt,[Tt,h($,{class:"popup_select",value:t.value.主角特效,"onUpdate:value":o[14]||(o[14]=n=>t.value.主角特效=n),options:P(B)},{default:G(()=>[Mt]),_:1},8,["value","options"])])]),e("div",Et,[Gt,h($,{class:"popup_select",value:t.value.SE,"onUpdate:value":o[15]||(o[15]=n=>t.value.SE=n),options:P(z)},{default:G(()=>[Ot]),_:1},8,["value","options"])]),e("div",Rt,[Vt,h($,{class:"popup_select",value:t.value.Voice,"onUpdate:value":o[16]||(o[16]=n=>t.value.Voice=n),options:P(F)},{default:G(()=>[Ht]),_:1},8,["value","options"])]),e("div",Nt,[Dt,e("div",At,[h(de,{class:"popup_input -textarea",value:t.value.和訳,"onUpdate:value":o[17]||(o[17]=n=>t.value.和訳=n)},null,8,["value"]),Pt])])],512),[[Q,!t.value.is_showtime]]),e("div",jt,[Kt,h(de,{class:"popup_input -textarea -col-3",value:t.value.備註,"onUpdate:value":o[18]||(o[18]=n=>t.value.備註=n)},null,8,["value"])])],512),e("footer",{class:"popup_footer"},[e("button",{class:"popup_submit",onClick:p,title:"保存"},"保存"),zt])])])),[[T,c.open]])}}},Yt=Y(Ft,[["__scopeId","data-v-91c6f09b"]]);export{ze as C,Yt as E,Qt as I,Xt as M,Fe as u};
