import{_ as te,o as q,c as J,a as t,q as le,r as U,j as u,l as ie,w as k,n as F,k as ue,F as _e,m as he,t as ee,v as R,g as V,M as me,D as ge,u as pe,s as z,h as re,b as de,e as m,x as H,d as Z,J as fe,K as we,N as ye,z as be,O as xe}from"./index-GgZyHVIS.js";/* empty css                                                             */import{S as L,_ as ae}from"./Dialog-CAEu5fnh.js";const Se={name:"MdiTarget"},Ce={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},ke=t("path",{fill:"currentColor",d:"M11 2v2.07A8 8 0 0 0 4.07 11H2v2h2.07A8 8 0 0 0 11 19.93V22h2v-2.07A8 8 0 0 0 19.93 13H22v-2h-2.07A8 8 0 0 0 13 4.07V2m-2 4.08V8h2V6.09c2.5.41 4.5 2.41 4.92 4.91H16v2h1.91c-.41 2.5-2.41 4.5-4.91 4.92V16h-2v1.91C8.5 17.5 6.5 15.5 6.08 13H8v-2H6.09C6.5 8.5 8.5 6.5 11 6.08M12 11a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1"},null,-1),Ue=[ke];function Ie(c,B,p,v,g,d){return q(),J("svg",Ce,Ue)}const Et=te(Se,[["render",Ie]]),$e={class:"menu_list"},Le={class:"contents"},Be=["onClick","title"],Te={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(c,{emit:B}){const p=c,v=B,{getClientRect:g}=le(),d=U(null),G=[{title:"セリフ",type:"dialog"},{title:"セリフ：主人公",type:"dialog_hero"},{title:"切り替え：UI",type:"scene_ui"},{title:"切り替え：背景",type:"scene_bg"},{title:"切り替え：BGM",type:"scene_bgm"},{title:"演出：CG",type:"perform_cg"},{title:"演出：CG終了",type:"perform_cg_end"},{title:"演出：暗転",type:"perform_black"},{title:"アナウンス",type:"dialog_announce",class:"!text-announce"},{title:"ナレーション",type:"dialog_system",class:"!text-announce"},{title:"コピー",type:"copy",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"編集",type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"削除",type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}],_=u(()=>{const{width:h,height:f}=g(document.documentElement),{width:w,height:r}=g(d.value),{x:y,y:S,width:M,height:$}=p.positions??{},E=(S??0)+($??0)/2-(r??0)/2,C=(E<20?20:E)+"px",O=(f??0)-(r??0)-20+"px",A=`min(${C}, ${O})`,W=(y??0)+(w??0)>h,Q=(y??0)+(M??0)+2,D=(y??0)-(w??0)-9-2,P=(W?D:Q)+"px";return{top:A,left:P}}),x=u(()=>{const{width:h}=g(document.documentElement),{width:f}=g(d.value),{x:w,y:r,width:y,height:S}=p.positions??{},M=(r??0)+(S??0)/2,$=(w??0)+(f??0)>h,E=(w??0)+(y??0)+3,C=(w??0)-3.2,O=$?C:E;return{top:M+"px",left:O+"px",turn:$}}),I=h=>{h.target.matches(".menu, .menu *")||v("clear",null)},T=h=>{v("use",{type:h}),v("clear",null)};return(h,f)=>{const w=ie("visible");return k((q(),J("div",{class:"menu_container",onClick:I},[t("div",{class:F(["menu_triangle",{"-scale-x-100":x.value.turn}]),style:ue(x.value)},null,6),t("div",{class:"menu scrollbar overflow-y-auto",style:ue(_.value),ref_key:"menu",ref:d},[t("ul",$e,[(q(),J(_e,null,he(G,r=>t("li",Le,[k(t("button",{class:F(["menu_item",r.class]),onClick:y=>T(r.type),title:r.title},ee(r.title),11,Be),[[R,!(["copy","edit","delete"].includes(r.type)&&c.onlyAdd)]])])),64))])],4)])),[[w,c.positions]])}}},Ot=te(Te,[["__scopeId","data-v-e4cfe076"]]),Me=["disabled","placeholder"],Ee={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(c,{emit:B}){const p=c,v=B,g=U(null),d=U(""),G=_=>{if(!_.ctrlKey)return;const{selectionStart:x,selectionEnd:I}=g.value;v("selected",{start:x,end:I})};return V(d,_=>v("update:value",_)),V(()=>p.value,_=>d.value=_,{immediate:!0}),(_,x)=>{const I=ie("verify");return k((q(),J("textarea",{class:"scrollbar textarea","onUpdate:modelValue":x[0]||(x[0]=T=>d.value=T),disabled:c.disabled,placeholder:c.disabled?"":c.placeholder,onKeydown:ge(G,["q"]),ref_key:"textarea",ref:g},null,40,Me)),[[me,d.value,void 0,{lazy:!0,trim:!0}],[I,void 0,void 0,{check:!0}]])}}},ce=te(Ee,[["__scopeId","data-v-c1e57f9a"]]),a=c=>(fe("data-v-5d7c4a2d"),c=c(),we(),c),Oe={class:"popup_window"},Ge={class:"popup_container scrollbar"},De={class:"contents"},Ne={class:"contents"},He={class:"popup_label"},Re=a(()=>t("div",{class:"-col-2"},null,-1)),Ve={class:"contents"},Ae=a(()=>t("span",{class:"popup_label"},"内容",-1)),Pe={value:""},je={class:"contents"},ze={class:"contents"},Ke=a(()=>t("span",{class:"popup_label"},"話し手",-1)),Fe={class:"popup_input"},qe={class:"contents"},Je=a(()=>t("span",{class:"popup_label"},"話し手",-1)),We={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},Qe={class:"popup_group"},Xe=a(()=>t("span",{class:"popup_group_title"},"・立ち絵1",-1)),Ye={class:"contents"},Ze=a(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),et=a(()=>t("option",{value:""},"無指定",-1)),tt={class:"contents"},st=a(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),ot=a(()=>t("option",{value:""},"引き継ぎ",-1)),nt={class:"contents"},at=a(()=>t("span",{class:"popup_label"},"エフェクト",-1)),lt=a(()=>t("option",{value:""},"なし",-1)),it={class:"popup_group"},ut=a(()=>t("span",{class:"popup_group_title"},"・立ち絵2",-1)),ct={class:"contents"},pt=a(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),rt=a(()=>t("option",{value:""},"無指定",-1)),dt={class:"contents"},vt=a(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),_t=a(()=>t("option",{value:""},"引き継ぎ",-1)),ht={class:"contents"},mt=a(()=>t("span",{class:"popup_label"},"エフェクト",-1)),gt=a(()=>t("option",{value:""},"なし",-1)),ft={class:"contents"},wt=a(()=>t("span",{class:"popup_label"},"SE",-1)),yt={class:"contents"},bt=a(()=>t("span",{class:"popup_label"},"ボイス",-1)),xt={class:"contents"},St=a(()=>t("span",{class:"popup_label"},"セリフ",-1)),Ct={class:"-col-3 grid gap-1"},kt=a(()=>t("span",{class:"text-right text-xs opacity-50"},"セリフにキーワードを指定したい場合は、文字を[ ]で囲んでください。",-1)),Ut={class:"contents"},It=a(()=>t("span",{class:"popup_label"},"備考",-1)),$t=a(()=>t("button",{class:"popup_submit -cancel"},"キャンセル",-1)),Lt={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(c,{emit:B}){const p=c,v=B,g=pe(),{getCharacter:d}=g,{characterList:G,characterReals:_}=z(g),x=re(),{newLog:I}=x,{chapterData:T}=z(x),h=de(),{blackList:f,getEffect:w,getBackground:r,getCg:y,getBgm:S,getSe:M,getShowList:$}=h,{uiList:E,effectList:C,backgroundList:O,cgList:A,bgmList:W,seList:Q}=z(h),{isDev:D,findData:P}=le(),e=U({}),se=u(()=>{var i;return(i=d(e.value.人物))==null?void 0:i.name}),o=u(()=>[{id:"UI",show:e.value.is_scene},{id:"BG",show:e.value.is_scene},{id:"BGM",show:e.value.is_scene},{id:"CG",show:e.value.is_perform},{id:"暗場",show:e.value.is_perform},{id:"動畫",show:e.value.is_perform}]),l=u(()=>$(e.value.show_time)),b=u(()=>G.value.filter(i=>!i.disabled||i.unknown)),N=u(()=>X(e.value.顯示角色)),j=u(()=>X(e.value.立ち絵2)),X=i=>{var s;return((s=d(i))==null?void 0:s.sprite)??[]},oe=()=>{e.value.show_time==="CG"&&e.value.show_name==="結束"||(e.value.show_name="")},Y=i=>e.value[i]="",ne=()=>{const i={...e.value};if(p.id==="add")v("add",i);else{const K=P(T.value,p.id);Object.assign(K,i)}v("update:open",!1),(!i.is_showtime||i.show_time==="暗場")&&v("target",i.id)},ve=i=>{const s=i.target.matches(".popup_window, .popup_window *"),K=i.target.matches(".-cancel");(!s||K)&&v("update:open",!1)};return V(()=>p.open,i=>{i&&(p.id==="add"?e.value=I(p.type):e.value={...P(T.value,p.id)},D&&console.log({...e.value}))}),(i,s)=>{const K=ie("visible");return k((q(),J("section",{class:"popup",onClick:ve},[t("div",Oe,[t("div",Ge,[k(t("div",De,[t("div",Ne,[t("span",He,ee(e.value.人物),1),m(L,{class:"popup_select",value:e.value.show_time,"onUpdate:value":s[0]||(s[0]=n=>e.value.show_time=n),options:o.value,onChange:oe},null,8,["value","options"])]),Re,t("div",Ve,[Ae,k(m(ae,{class:"popup_input -col-3",value:e.value.show_name,"onUpdate:value":s[1]||(s[1]=n=>e.value.show_name=n)},null,8,["value"]),[[R,e.value.show_time==="BGM"]]),k(m(L,{class:"popup_select -col-3",value:e.value.show_name,"onUpdate:value":s[2]||(s[2]=n=>e.value.show_name=n),options:l.value},{default:H(()=>[t("option",Pe,ee(e.value.show_time==="暗場"?"フェード":"なし"),1)]),_:1},8,["value","options"]),[[R,e.value.show_time!=="BGM"]])])],512),[[R,e.value.is_showtime]]),k(t("div",je,[k(t("div",ze,[Ke,t("span",Fe,ee(se.value),1)],512),[[R,e.value.is_announce||e.value.is_system]]),k(t("div",qe,[Je,m(L,{class:"popup_select",value:e.value.人物,"onUpdate:value":s[3]||(s[3]=n=>e.value.人物=n),options:b.value},null,8,["value","options"])],512),[[R,!(e.value.is_announce||e.value.is_system)]]),t("div",We,[t("button",{class:F(["popup_switch text-replay",{"-active bg-replay":e.value.is_replay}]),onClick:s[4]||(s[4]=n=>e.value.is_replay=!e.value.is_replay),title:"再放送"},"再放送",2),t("button",{class:F(["popup_switch text-unknown",{"-active bg-unknown":e.value.is_unknown}]),onClick:s[5]||(s[5]=n=>e.value.is_unknown=!e.value.is_unknown),title:"未解明"},"未解明",2),t("button",{class:F(["popup_switch -monolog",{"-active":e.value.is_monolog}]),onClick:s[6]||(s[6]=n=>e.value.is_monolog=!e.value.is_monolog),title:"独り言"},"独り言",2)]),t("div",Qe,[Xe,t("div",Ye,[Ze,m(L,{class:"popup_select",value:e.value.顯示角色,"onUpdate:value":s[7]||(s[7]=n=>e.value.顯示角色=n),options:Z(_),onChange:s[8]||(s[8]=n=>Y("角色差分"))},{default:H(()=>[et]),_:1},8,["value","options"])]),t("div",tt,[st,m(L,{class:"popup_select",value:e.value.角色差分,"onUpdate:value":s[9]||(s[9]=n=>e.value.角色差分=n),options:N.value},{default:H(()=>[ot]),_:1},8,["value","options"])]),t("div",nt,[at,m(L,{class:"popup_select",value:e.value.差分特效,"onUpdate:value":s[10]||(s[10]=n=>e.value.差分特效=n),options:Z(C)},{default:H(()=>[lt]),_:1},8,["value","options"])])]),t("div",it,[ut,t("div",ct,[pt,m(L,{class:"popup_select",value:e.value.立ち絵2,"onUpdate:value":s[11]||(s[11]=n=>e.value.立ち絵2=n),options:Z(_),onChange:s[12]||(s[12]=n=>Y("十六夜差分"))},{default:H(()=>[rt]),_:1},8,["value","options"])]),t("div",dt,[vt,m(L,{class:"popup_select",value:e.value.十六夜差分,"onUpdate:value":s[13]||(s[13]=n=>e.value.十六夜差分=n),options:j.value},{default:H(()=>[_t]),_:1},8,["value","options"])]),t("div",ht,[mt,m(L,{class:"popup_select",value:e.value.主角特效,"onUpdate:value":s[14]||(s[14]=n=>e.value.主角特效=n),options:Z(C)},{default:H(()=>[gt]),_:1},8,["value","options"])])]),t("div",ft,[wt,m(ae,{class:"popup_input",value:e.value.SE,"onUpdate:value":s[15]||(s[15]=n=>e.value.SE=n)},null,8,["value"])]),t("div",yt,[bt,m(ae,{class:"popup_input",value:e.value.Voice,"onUpdate:value":s[16]||(s[16]=n=>e.value.Voice=n)},null,8,["value"])]),t("div",xt,[St,t("div",Ct,[m(ce,{class:"popup_input -textarea",value:e.value.和訳,"onUpdate:value":s[17]||(s[17]=n=>e.value.和訳=n)},null,8,["value"]),kt])])],512),[[R,!e.value.is_showtime]]),t("div",Ut,[It,m(ce,{class:"popup_input -textarea -col-3",value:e.value.備註,"onUpdate:value":s[18]||(s[18]=n=>e.value.備註=n)},null,8,["value"])])]),t("footer",{class:"popup_footer"},[t("button",{class:"popup_submit",onClick:ne,title:"保存"},"保存"),$t])])])),[[K,c.open]])}}},Gt=te(Lt,[["__scopeId","data-v-5d7c4a2d"]]),Dt=ye("log",()=>{const c=be(),B=re(),{chapterData:p}=z(B),v=pe(),{characterHero:g}=z(v),d=de(),{getUI:G,getHistoryList:_}=d,{defaultUI:x,defaultUIForCG:I}=z(d),{findData:T,findIndex:h}=le(),f=U(0),w=U(0),r=U({}),y=u(()=>p.value.filter(o=>!o.is_delete)),S=u(()=>y.value.filter(o=>{const l=!o.is_showtime,b=o.is_perform&&o.show_time==="暗場";return l||b})),M=u(()=>{const o=h(y.value,f.value)+1,l=y.value.slice(0,o),b=y.value.slice(o);return b.every(j=>j.is_showtime&&j.show_time!=="暗場")&&l.push(...b),l});V(f,o=>{const l=T(p.value,o)??{};l.is_scene||(r.value=l,w.value=h(S.value,l.id))}),V(w,o=>{var l;return f.value=((l=S.value[o])==null?void 0:l.id)??0}),V(p,()=>{var o;return f.value=((o=S.value[0])==null?void 0:o.id)??0}),xe(()=>{var o;return f.value=((o=S.value[0])==null?void 0:o.id)??0});const $=u(()=>{const o=_(M.value,"CG");return((o==null?void 0:o.show_name)??"")!==""&&(o==null?void 0:o.show_name)!=="結束"}),E=u(()=>{const o=_(M.value,"UI"),l=(o==null?void 0:o.show_name)??x.value??"",b=I.value;return $.value&&b!==""?b:l}),C=u(()=>G(E.value)),O=u(()=>{const o=C.value,l=r.value,b=g.value.name,N=l.人物,j=o.name_tag_number===2,X=l.is_monolog&&o.name_tag_solo_show,oe=N===b&&o.name_tag_hero_right,Y=N===l.顯示角色&&o.name_tag_sprite_1_right,ne=N===l.立ち絵2&&o.name_tag_sprite_2_right&&o.sprite_number===2;return j&&(X||oe||Y||ne)}),A=u(()=>{const o=r.value,l=o.is_system||o.is_announce||o.is_monolog,b=o.is_monolog&&C.value.name_tag_solo_show;return!l||b}),W=u(()=>!O.value&&A.value),Q=u(()=>O.value&&A.value),D=U(!1),P=U(!1),e=U(!1),se=u(()=>({"":D.value}));return V(()=>c.name,()=>D.value=!1),{logId:f,logIndex:w,logData:r,logShowing:y,logContents:S,logHistory:M,logCGMode:$,logUIId:E,logUI:C,isNameRight:O,isNameShow:A,nameTag1Show:W,nameTag2Show:Q,logPlay:D,logTyping:P,logBlack:e,playEase:se}});export{Gt as E,Et as I,Ot as M,Dt as u};
