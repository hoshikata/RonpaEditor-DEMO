import{_ as se,o as Q,c as X,a as t,q as ie,r as E,j as c,l as ce,w as k,n as W,k as pe,F as me,m as he,t as te,v as j,g as z,O as ge,D as fe,I as we,z as be,h as de,s as K,u as ve,b as _e,i as ye,J as Se,e as m,x as P,d as ee,K as xe,L as Ce}from"./index-DU34YnvH.js";/* empty css                                                             */import{S as M,_ as le}from"./Dialog-DtczLKx1.js";const ke={name:"MdiTarget"},Ie={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},Ue=t("path",{fill:"currentColor",d:"M11 2v2.07A8 8 0 0 0 4.07 11H2v2h2.07A8 8 0 0 0 11 19.93V22h2v-2.07A8 8 0 0 0 19.93 13H22v-2h-2.07A8 8 0 0 0 13 4.07V2m-2 4.08V8h2V6.09c2.5.41 4.5 2.41 4.92 4.91H16v2h1.91c-.41 2.5-2.41 4.5-4.91 4.92V16h-2v1.91C8.5 17.5 6.5 15.5 6.08 13H8v-2H6.09C6.5 8.5 8.5 6.5 11 6.08M12 11a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1"},null,-1),$e=[Ue];function Le(u,I,v,p,h,d){return Q(),X("svg",Ie,$e)}const Rt=se(ke,[["render",Le]]),Be={class:"menu_list"},Te={class:"contents"},Ge=["onClick","title"],Me={__name:"Menu",props:{positions:{type:[Object],default:null},onlyAdd:{type:[Boolean],default:!1}},emits:["use","clear"],setup(u,{emit:I}){const v=u,p=I,{getClientRect:h}=ie(),d=E(null),D=[{title:"セリフ",type:"dialog"},{title:"セリフ：主人公",type:"dialog_hero"},{title:"切り替え：UI",type:"scene_ui"},{title:"切り替え：背景",type:"scene_bg"},{title:"切り替え：BGM",type:"scene_bgm"},{title:"演出：CG",type:"perform_cg"},{title:"演出：CG終了",type:"perform_cg_end"},{title:"演出：暗転",type:"perform_black"},{title:"アナウンス",type:"dialog_announce",class:"!text-announce"},{title:"ナレーション",type:"dialog_system",class:"!text-announce"},{title:"コピー",type:"copy",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"編集",type:"edit",class:"!bg-secondary/50 !text-white hover:!bg-secondary/75"},{title:"削除",type:"delete",class:"!bg-red-500/50 !text-white hover:!bg-red-500/75"}],_=c(()=>{const{width:x,height:U}=h(document.documentElement),{width:f,height:w}=h(d.value),{x:$,y:b,width:L,height:B}=v.positions??{},g=(b??0)+(B??0)/2-(w??0)/2,C=(g<20?20:g)+"px",R=(U??0)-(w??0)-20+"px",F=`min(${C}, ${R})`,q=($??0)+(f??0)>x,V=($??0)+(L??0)+2,H=($??0)-(f??0)-9-2,N=(q?H:V)+"px";return{top:F,left:N}}),y=c(()=>{const{width:x}=h(document.documentElement),{width:U}=h(d.value),{x:f,y:w,width:$,height:b}=v.positions??{},L=(w??0)+(b??0)/2,B=(f??0)+(U??0)>x,g=(f??0)+($??0)+3,C=(f??0)-3.2,R=B?C:g;return{top:L+"px",left:R+"px",turn:B}}),S=x=>{x.target.matches(".menu, .menu *")||p("clear",null)},O=x=>{p("use",{type:x}),p("clear",null)};return(x,U)=>{const f=ce("visible");return k((Q(),X("div",{class:"menu_container",onClick:S},[t("div",{class:W(["menu_triangle",{"-scale-x-100":y.value.turn}]),style:pe(y.value)},null,6),t("div",{class:"menu scrollbar overflow-y-auto",style:pe(_.value),ref_key:"menu",ref:d},[t("ul",Be,[(Q(),X(me,null,he(D,w=>t("li",Te,[k(t("button",{class:W(["menu_item",w.class]),onClick:$=>O(w.type),title:w.title},te(w.title),11,Ge),[[j,!(["copy","edit","delete"].includes(w.type)&&u.onlyAdd)]])])),64))])],4)])),[[f,u.positions]])}}},Dt=se(Me,[["__scopeId","data-v-e4cfe076"]]),Ee=["disabled","placeholder"],Oe={__name:"Textarea",props:{value:{type:[String,Number],default:""},disabled:{type:[Boolean],default:!1},placeholder:{type:[String],default:""}},emits:["update:value","selected"],setup(u,{emit:I}){const v=u,p=I,h=E(null),d=E(""),D=_=>{if(!_.ctrlKey)return;const{selectionStart:y,selectionEnd:S}=h.value;p("selected",{start:y,end:S})};return z(d,_=>p("update:value",_)),z(()=>v.value,_=>d.value=_,{immediate:!0}),(_,y)=>{const S=ce("verify");return k((Q(),X("textarea",{class:"scrollbar textarea","onUpdate:modelValue":y[0]||(y[0]=O=>d.value=O),disabled:u.disabled,placeholder:u.disabled?"":u.placeholder,onKeydown:fe(D,["q"]),ref_key:"textarea",ref:h},null,40,Ee)),[[ge,d.value,void 0,{lazy:!0,trim:!0}],[S,void 0,void 0,{check:!0}]])}}},re=se(Oe,[["__scopeId","data-v-c1e57f9a"]]),Re=we("log",()=>{const u=be(),I=de(),{convertChapter:v}=I,{chapterData:p}=K(I),h=ve(),{characterHero:d,characterUnknown:D}=K(h),_=_e(),{getUI:y,getHistoryList:S}=_,{defaultUI:O,defaultUIForCG:x}=K(_),{findData:U,findIndex:f,getRandomInt:w}=ie(),{newId:$}=ye(),b=E(0),L=E(0),B=c(()=>U(p.value,b.value)??{}),g=c(()=>p.value.filter(s=>!s.is_delete)),C=c(()=>g.value.filter(s=>{const n=!s.is_showtime,r=s.is_perform&&s.show_time==="暗場";return n||r})),R=c(()=>{const s=f(g.value,b.value)+1,n=g.value.slice(0,s),r=g.value.slice(s);return r.every(G=>G.is_showtime&&G.show_time!=="暗場")&&n.push(...r),n});z(b,s=>{const n=U(p.value,s)??{};n.is_scene||(L.value=f(C.value,n.id))}),z(L,s=>{var n;return b.value=((n=C.value[s])==null?void 0:n.id)??0}),z(p,()=>{var s;return b.value=((s=C.value[0])==null?void 0:s.id)??0}),Se(()=>{var s;return b.value=((s=C.value[0])==null?void 0:s.id)??0});const F=c(()=>{const s=S(R.value,"CG");return((s==null?void 0:s.show_name)??"")!==""&&(s==null?void 0:s.show_name)!=="結束"}),q=c(()=>{const s=S(R.value,"UI"),n=(s==null?void 0:s.show_name)??O.value??"",r=x.value;return F.value&&r!==""?r:n}),V=c(()=>y(q.value)),H=c(()=>{const s=V.value,n=B.value,r=d.value.name,T=n.人物,G=s.name_tag_number===2,l=n.is_monolog&&s.name_tag_solo_show,o=T===r&&s.name_tag_hero_right,A=T===n.顯示角色&&s.name_tag_sprite_1_right,a=T===n.立ち絵2&&s.name_tag_sprite_2_right&&s.sprite_number===2;return G&&(l||o||A||a)}),N=c(()=>{const s=B.value,n=s.is_system||s.is_announce||s.is_monolog,r=s.is_monolog&&V.value.name_tag_solo_show;return!n||r}),Y=c(()=>!H.value&&N.value),e=c(()=>H.value&&N.value),J=E(!1),oe=E(!1),ne=E(!1),ae=c(()=>({"":J.value}));z(()=>u.name,()=>J.value=!1);const Z=()=>$(p.value);return{logId:b,logIndex:L,logData:B,logShowing:g,logContents:C,logHistory:R,logCGMode:F,logUIId:q,logUI:V,isNameRight:H,isNameShow:N,nameTag1Show:Y,nameTag2Show:e,logPlay:J,logTyping:oe,logBlack:ne,playEase:ae,newLogId:Z,newLog:s=>{var G,l;let n={name:"",content:""};s==="scene_ui"&&(n={name:"場景(切換)",content:"UI"}),s==="scene_bg"&&(n={name:"場景(切換)",content:"BG"}),s==="scene_bgm"&&(n={name:"場景(切換)",content:"BGM"}),s==="perform_cg"&&(n={name:"演出",content:"CG"}),s==="perform_cg_end"&&(n={name:"演出",content:"CG/結束"}),s==="perform_anime"&&(n={name:"演出",content:"動畫"}),s==="perform_black"&&(n={name:"演出",content:"暗場"}),s==="dialog"&&(n={name:((G=D.value)==null?void 0:G.name)??"",content:""}),s==="dialog_hero"&&(n={name:((l=d.value)==null?void 0:l.name)??"",content:""}),s==="dialog_announce"&&(n={name:"廣播",content:""}),s==="dialog_system"&&(n={name:"系統",content:""});const r={id:Z(),人物:n.name??"",顯示角色:"",角色差分:"",差分特效:"",立ち絵2:"",十六夜差分:"",和訳:n.content??"",SE:"",Voice:"",備註:""},T=v(r);return{...r,...T}}}}),i=u=>(xe("data-v-270528eb"),u=u(),Ce(),u),De={class:"popup_window"},Ve={class:"popup_container scrollbar"},He={class:"contents"},Ne={class:"contents"},Ae={class:"popup_label"},Pe=i(()=>t("div",{class:"-col-2"},null,-1)),je={class:"contents"},ze=i(()=>t("span",{class:"popup_label"},"内容",-1)),Ke={value:""},Fe={class:"contents"},qe={class:"contents"},Je=i(()=>t("span",{class:"popup_label"},"話し手",-1)),We={class:"popup_input"},Qe={class:"contents"},Xe=i(()=>t("span",{class:"popup_label"},"話し手",-1)),Ye={class:"col-span-2 flex justify-end gap-3 sm:col-span-1"},Ze={class:"popup_group"},et=i(()=>t("span",{class:"popup_group_title"},"・立ち絵1",-1)),tt={class:"contents"},st=i(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),ot=i(()=>t("option",{value:""},"無指定",-1)),nt={class:"contents"},at=i(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),lt=i(()=>t("option",{value:""},"引き継ぎ",-1)),it={class:"contents"},ct=i(()=>t("span",{class:"popup_label"},"エフェクト",-1)),ut=i(()=>t("option",{value:""},"なし",-1)),pt={class:"popup_group"},rt=i(()=>t("span",{class:"popup_group_title"},"・立ち絵2",-1)),dt={class:"contents"},vt=i(()=>t("span",{class:"popup_label"},"キャラ指定",-1)),_t=i(()=>t("option",{value:""},"無指定",-1)),mt={class:"contents"},ht=i(()=>t("span",{class:"popup_label"},"キャラ差分",-1)),gt=i(()=>t("option",{value:""},"引き継ぎ",-1)),ft={class:"contents"},wt=i(()=>t("span",{class:"popup_label"},"エフェクト",-1)),bt=i(()=>t("option",{value:""},"なし",-1)),yt={class:"contents"},St=i(()=>t("span",{class:"popup_label"},"SE",-1)),xt={class:"contents"},Ct=i(()=>t("span",{class:"popup_label"},"ボイス",-1)),kt={class:"contents"},It=i(()=>t("span",{class:"popup_label"},"セリフ",-1)),Ut={class:"-col-3 grid gap-1"},$t=i(()=>t("span",{class:"text-right text-xs opacity-50"},"セリフにキーワードを指定したい場合は、文字を[ ]で囲んでください。",-1)),Lt={class:"contents"},Bt=i(()=>t("span",{class:"popup_label"},"備考",-1)),Tt=i(()=>t("button",{class:"popup_submit -cancel",title:"キャンセル"},"キャンセル",-1)),Gt={__name:"EditPopup",props:{open:{type:[Boolean],default:!1},id:{type:[Number,String],default:""},type:{type:[String],default:""}},emits:["update:open","add","target"],setup(u,{emit:I}){const v=u,p=I,h=ve(),{getCharacter:d}=h,{characterList:D,characterReals:_}=K(h),y=de(),{chapterData:S}=K(y),O=_e(),{blackList:x,getEffect:U,getBackground:f,getCg:w,getBgm:$,getSe:b,getShowList:L}=O,{uiList:B,effectList:g,backgroundList:C,cgList:R,bgmList:F,seList:q}=K(O),V=Re(),{newLog:H}=V,{isDev:N,findData:Y}=ie(),e=E({}),J=c(()=>{var l;return(l=d(e.value.人物))==null?void 0:l.name}),oe=c(()=>[{id:"UI",show:e.value.is_scene},{id:"BG",show:e.value.is_scene},{id:"BGM",show:e.value.is_scene},{id:"CG",show:e.value.is_perform},{id:"暗場",show:e.value.is_perform},{id:"動畫",show:e.value.is_perform}]),ne=c(()=>L(e.value.show_time)),ae=c(()=>D.value.filter(l=>!l.disabled||l.unknown)),Z=c(()=>s(e.value.顯示角色)),ue=c(()=>s(e.value.立ち絵2)),s=l=>{var o;return((o=d(l))==null?void 0:o.sprite)??[]},n=()=>{e.value.show_time==="CG"&&e.value.show_name==="結束"||(e.value.show_name="")},r=l=>e.value[l]="",T=()=>{const l={...e.value};if(v.id==="add")p("add",l);else{const A=Y(S.value,v.id);Object.assign(A,l)}p("update:open",!1),(!l.is_showtime||l.show_time==="暗場")&&p("target",l.id)},G=l=>{const o=l.target.matches(".popup_window, .popup_window *"),A=l.target.matches(".-cancel");(!o||A)&&p("update:open",!1)};return z(()=>v.open,l=>{l&&(v.id==="add"?e.value=H(v.type):e.value={...Y(S.value,v.id)},N&&console.log({...e.value}))}),(l,o)=>{const A=ce("visible");return k((Q(),X("section",{class:"popup",onClick:G},[t("div",De,[t("div",Ve,[k(t("div",He,[t("div",Ne,[t("span",Ae,te(e.value.人物),1),m(M,{class:"popup_select",value:e.value.show_time,"onUpdate:value":o[0]||(o[0]=a=>e.value.show_time=a),options:oe.value,onChange:n},null,8,["value","options"])]),Pe,t("div",je,[ze,k(m(le,{class:"popup_input -col-3",value:e.value.show_name,"onUpdate:value":o[1]||(o[1]=a=>e.value.show_name=a)},null,8,["value"]),[[j,e.value.show_time==="BGM"]]),k(m(M,{class:"popup_select -col-3",value:e.value.show_name,"onUpdate:value":o[2]||(o[2]=a=>e.value.show_name=a),options:ne.value},{default:P(()=>[t("option",Ke,te(e.value.show_time==="暗場"?"フェード":"なし"),1)]),_:1},8,["value","options"]),[[j,e.value.show_time!=="BGM"]])])],512),[[j,e.value.is_showtime]]),k(t("div",Fe,[k(t("div",qe,[Je,t("span",We,te(J.value),1)],512),[[j,e.value.is_announce||e.value.is_system]]),k(t("div",Qe,[Xe,m(M,{class:"popup_select",value:e.value.人物,"onUpdate:value":o[3]||(o[3]=a=>e.value.人物=a),options:ae.value},null,8,["value","options"])],512),[[j,!(e.value.is_announce||e.value.is_system)]]),t("div",Ye,[t("button",{class:W(["popup_switch text-replay",{"-active bg-replay":e.value.is_replay}]),onClick:o[4]||(o[4]=a=>e.value.is_replay=!e.value.is_replay),title:"再放送"},"再放送",2),t("button",{class:W(["popup_switch text-unknown",{"-active bg-unknown":e.value.is_unknown}]),onClick:o[5]||(o[5]=a=>e.value.is_unknown=!e.value.is_unknown),title:"未解明"},"未解明",2),t("button",{class:W(["popup_switch -monolog",{"-active":e.value.is_monolog}]),onClick:o[6]||(o[6]=a=>e.value.is_monolog=!e.value.is_monolog),title:"独り言"},"独り言",2)]),t("div",Ze,[et,t("div",tt,[st,m(M,{class:"popup_select",value:e.value.顯示角色,"onUpdate:value":o[7]||(o[7]=a=>e.value.顯示角色=a),options:ee(_),onChange:o[8]||(o[8]=a=>r("角色差分"))},{default:P(()=>[ot]),_:1},8,["value","options"])]),t("div",nt,[at,m(M,{class:"popup_select",value:e.value.角色差分,"onUpdate:value":o[9]||(o[9]=a=>e.value.角色差分=a),options:Z.value},{default:P(()=>[lt]),_:1},8,["value","options"])]),t("div",it,[ct,m(M,{class:"popup_select",value:e.value.差分特效,"onUpdate:value":o[10]||(o[10]=a=>e.value.差分特效=a),options:ee(g)},{default:P(()=>[ut]),_:1},8,["value","options"])])]),t("div",pt,[rt,t("div",dt,[vt,m(M,{class:"popup_select",value:e.value.立ち絵2,"onUpdate:value":o[11]||(o[11]=a=>e.value.立ち絵2=a),options:ee(_),onChange:o[12]||(o[12]=a=>r("十六夜差分"))},{default:P(()=>[_t]),_:1},8,["value","options"])]),t("div",mt,[ht,m(M,{class:"popup_select",value:e.value.十六夜差分,"onUpdate:value":o[13]||(o[13]=a=>e.value.十六夜差分=a),options:ue.value},{default:P(()=>[gt]),_:1},8,["value","options"])]),t("div",ft,[wt,m(M,{class:"popup_select",value:e.value.主角特效,"onUpdate:value":o[14]||(o[14]=a=>e.value.主角特效=a),options:ee(g)},{default:P(()=>[bt]),_:1},8,["value","options"])])]),t("div",yt,[St,m(le,{class:"popup_input",value:e.value.SE,"onUpdate:value":o[15]||(o[15]=a=>e.value.SE=a)},null,8,["value"])]),t("div",xt,[Ct,m(le,{class:"popup_input",value:e.value.Voice,"onUpdate:value":o[16]||(o[16]=a=>e.value.Voice=a)},null,8,["value"])]),t("div",kt,[It,t("div",Ut,[m(re,{class:"popup_input -textarea",value:e.value.和訳,"onUpdate:value":o[17]||(o[17]=a=>e.value.和訳=a)},null,8,["value"]),$t])])],512),[[j,!e.value.is_showtime]]),t("div",Lt,[Bt,m(re,{class:"popup_input -textarea -col-3",value:e.value.備註,"onUpdate:value":o[18]||(o[18]=a=>e.value.備註=a)},null,8,["value"])])]),t("footer",{class:"popup_footer"},[t("button",{class:"popup_submit",onClick:T,title:"保存"},"保存"),Tt])])])),[[A,u.open]])}}},Vt=se(Gt,[["__scopeId","data-v-270528eb"]]);export{Vt as E,Rt as I,Dt as M,Re as u};
